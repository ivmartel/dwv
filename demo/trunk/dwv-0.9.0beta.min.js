/*! dwv 0.9.0beta 21-01-2015 */
var dwv=dwv||{},Kinetic=Kinetic||{};dwv.App=function(){function a(){m.generateImageData(o),s.setImageData(o),s.draw()}function b(){m.addEventListener("wlchange",dwv.info.updateWindowingDiv),m.addEventListener("wlchange",dwv.info.updateMiniColorMap),m.addEventListener("wlchange",dwv.info.updatePlotMarkings),m.addEventListener("colorchange",dwv.info.updateMiniColorMap),m.addEventListener("positionchange",dwv.info.updatePositionDiv),v=!0}function c(){m.removeEventListener("wlchange",dwv.info.updateWindowingDiv),m.removeEventListener("wlchange",dwv.info.updateMiniColorMap),m.removeEventListener("wlchange",dwv.info.updatePlotMarkings),m.removeEventListener("colorchange",dwv.info.updateMiniColorMap),m.removeEventListener("positionchange",dwv.info.updatePositionDiv),v=!1}function d(a){var b=!1,c=null,d=null;if("touchstart"===a.type||"touchmove"===a.type?(a.preventDefault(),c=dwv.html.getEventOffset(a),a._xs=c[0].x,a._ys=c[0].y,d=k.getImageLayer().displayToIndex(c[0]),a._x=parseInt(d.x,10),a._y=parseInt(d.y,10),2===c.length&&(a._x1s=c[1].x,a._y1s=c[1].y,d=k.getImageLayer().displayToIndex(c[1]),a._x1=parseInt(d.x,10),a._y1=parseInt(d.y,10)),b=!0):"mousemove"===a.type||"mousedown"===a.type||"mouseup"===a.type||"mouseout"===a.type||"mousewheel"===a.type||"dblclick"===a.type||"DOMMouseScroll"===a.type?(c=dwv.html.getEventOffset(a),a._xs=c[0].x,a._ys=c[0].y,d=k.getImageLayer().displayToIndex(c[0]),a._x=parseInt(d.x,10),a._y=parseInt(d.y,10),b=!0):("keydown"===a.type||"touchend"===a.type)&&(b=!0),b){var e=k.getToolBox().getSelectedTool()[a.type];e&&e(a)}}function e(a){a.stopPropagation(),a.preventDefault();var b=document.getElementById("dropBox");b&&(b.className="hover")}function f(a){a.stopPropagation(),a.preventDefault();var b=document.getElementById("dropBox");b&&(b.className="")}function g(a){a.stopPropagation(),a.preventDefault(),k.loadFiles(a.dataTransfer.files)}function h(a){alert(a.name&&a.message?a.name+": "+a.message+".":"Error: "+a+"."),a.stack&&console.error(a.stack)}function i(a,b){s=new dwv.html.Layer("imageLayer"),s.initialise(a,b),s.fillContext(),s.setStyleDisplay(!0),null!==document.getElementById("drawDiv")&&(u=new Kinetic.Stage({container:"drawDiv",width:a,height:b,listening:!1})),k.resetLayout(),k.resize()}function j(a){if(!m){m=a.view,dwv.gui.appendTagsTable(a.info),n=m.getImage(),l=n,p=l.getSize().getNumberOfColumns(),q=l.getSize().getNumberOfRows(),i(p,q),o=s.getContext().createImageData(p,q),k.addLayerListeners(s.getCanvas()),window.addEventListener("keydown",d,!0),m.addEventListener("wlchange",k.onWLChange),m.addEventListener("colorchange",k.onColorChange),m.addEventListener("slicechange",k.onSliceChange);var c=document.getElementById("dropBox");if(c){c.removeEventListener("dragover",e),c.removeEventListener("dragleave",f),c.removeEventListener("drop",g),dwv.html.removeNode("dropBox");var h=document.getElementById("layerContainer");h.addEventListener("dragover",e),h.addEventListener("dragleave",f),h.addEventListener("drop",g)}document.getElementById("infoLayer")&&(dwv.info.createWindowingDiv(),dwv.info.createPositionDiv(),dwv.info.createMiniColorMap(),dwv.info.createPlot(),b()),w.init(),w.display(!0),k.initWLDisplay()}}var k=this,l=null,m=null,n=null,o=null,p=0,q=0,r=1,s=null,t=[],u=null,v=!1,w=new dwv.tool.ToolBox(this),x=new dwv.tool.UndoStack;this.getVersion=function(){return"v0.9.0beta"},this.getImage=function(){return l},this.getView=function(){return m},this.setImage=function(a){l=a,m.setImage(a)},this.restoreOriginalImage=function(){l=n,m.setImage(n)},this.getImageData=function(){return o},this.getToolBox=function(){return w},this.getImageLayer=function(){return s},this.getDrawLayer=function(){return t[m.getCurrentPosition().k]},this.getDrawStage=function(){return u},this.getUndoStack=function(){return x},this.init=function(){window.onresize=this.resize;var a=document.getElementById("dropBox");if(a){a.addEventListener("dragover",e),a.addEventListener("dragleave",f),a.addEventListener("drop",g);var b=dwv.gui.getWindowSize(),c=2*b.height/3;$("#dropBox").height(c),$("#dropBox").width(c)}if("undefined"==typeof skipLoadUrl){var d=dwv.html.getUriParam();d&&d.length>0&&this.loadURL(d)}else console.log("Not loading url from adress since skipLoadUrl is defined.")},this.reset=function(){w.reset(),u&&(t=[]),l=null,m=null,x=new dwv.tool.UndoStack,dwv.gui.cleanUndoHtml()},this.resetLayout=function(){s&&(s.resetLayout(r),s.draw()),u&&(u.offset({x:0,y:0}),u.scale({x:r,y:r}),u.draw())},this.onKeydown=function(a){90===a.keyCode&&a.ctrlKey?x.undo():89===a.keyCode&&a.ctrlKey&&x.redo()},this.onChangeFiles=function(a){this.loadFiles(a.target.files)},this.loadFiles=function(a){this.reset();var b=new dwv.io.File;b.onload=function(a){var b=!0;if(l&&(l.appendSlice(a.view.getImage()),b=!1),j(a),u){var c=new Kinetic.Layer({listening:!1,hitGraphEnabled:!1,visible:b});t.push(c),u.add(c)}},b.onerror=function(a){h(a)},b.load(a)},this.onChangeURL=function(a){this.loadURL([a.target.value])},this.loadURL=function(a){this.reset();var b=new dwv.io.Url;b.onload=function(a){var b=!0;if(l&&(l.appendSlice(a.view.getImage()),b=!1),j(a),u){var c=new Kinetic.Layer({listening:!1,hitGraphEnabled:!1,visible:b});t.push(c),u.add(c)}},b.onerror=function(a){h(a)},b.load(a)},this.onWLChange=function(){a()},this.onColorChange=function(){a()},this.onSliceChange=function(){if(a(),u){for(var b=0;b<t.length;++b)t[b].visible(!1);var c=t[m.getCurrentPosition().k];c.visible(!0),c.draw()}},this.resize=function(){var a=parseInt(r*p,10),b=dwv.gui.getWindowSize();r=Math.min(b.width/p,b.height/q);var c=parseInt(r*p,10),d=parseInt(r*q,10),e=c/a;if($("#layerContainer").width(c),$("#layerContainer").height(d+1),s){var f=s.getZoom().x*e,g=s.getZoom().y*e;s.setWidth(c),s.setHeight(d),s.zoom(f,g,0,0),s.draw()}if(u){$("#drawDiv").width(c),$("#drawDiv").height(d);var h=u.scale().x*e,i=u.scale().y*e;u.setWidth(c),u.setHeight(d),u.scale({x:h,y:i}),u.draw()}},this.toggleInfoLayerDisplay=function(){dwv.html.toggleDisplay("infoLayer"),v?c():b()},this.initWLDisplay=function(){var a=Object.keys(dwv.tool.presets);dwv.tool.updateWindowingData(dwv.tool.presets[a[0]].center,dwv.tool.presets[a[0]].width),dwv.tool.updatePostionValue(0,0)},this.addLayerListeners=function(a){a.setAttribute("style","pointer-events: auto;"),a.addEventListener("mousedown",d),a.addEventListener("mousemove",d),a.addEventListener("mouseup",d),a.addEventListener("mouseout",d),a.addEventListener("mousewheel",d),a.addEventListener("DOMMouseScroll",d),a.addEventListener("dblclick",d),a.addEventListener("touchstart",d),a.addEventListener("touchmove",d),a.addEventListener("touchend",d)},this.removeLayerListeners=function(a){a.setAttribute("style","pointer-events: none;"),a.removeEventListener("mousedown",d),a.removeEventListener("mousemove",d),a.removeEventListener("mouseup",d),a.removeEventListener("mouseout",d),a.removeEventListener("mousewheel",d),a.removeEventListener("DOMMouseScroll",d),a.removeEventListener("dblclick",d),a.removeEventListener("touchstart",d),a.removeEventListener("touchmove",d),a.removeEventListener("touchend",d)},this.render=function(){a()}};var dwv=dwv||{};dwv.dicom=dwv.dicom||{},dwv.dicom.DataReader=function(a,b){var c=new DataView(a);"undefined"==typeof b&&(b=!0),this.readUint8=function(a){return c.getUint8(a,b)},this.readUint16=function(a){return c.getUint16(a,b)},this.readUint32=function(a){return c.getUint32(a,b)},this.readFloat32=function(a){return c.getFloat32(a,b)},this.readNumber=function(a,c){return 1===c?this.readUint8(a,b):2===c?this.readUint16(a,b):4===c?this.readUint32(a,b):8===c?this.readFloat32(a,b):(console.warn("Non number: '"+this.readString(a,c)+"' of "+c+" bytes."),Number.NaN)},this.readUint8Array=function(a,b){for(var c=new Uint8Array(b),d=0,e=a;a+b>e;++e)c[d++]=this.readUint8(e);return c},this.readUint16Array=function(a,b){for(var c=new Uint16Array(b/2),d=0,e=a;a+b>e;e+=2)c[d++]=this.readUint16(e);return c},this.readHex=function(a){var b=this.readUint16(a).toString(16);return"0x0000".substr(0,6-b.length)+b.toUpperCase()},this.readString=function(a,b){for(var c="",d=a;a+b>d;++d)c+=String.fromCharCode(this.readUint8(d));return c}},dwv.dicom.isJpegTransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.5/)||null!==a.match(/1.2.840.10008.1.2.4.6/)||null!==a.match(/1.2.840.10008.1.2.4.7/)},dwv.dicom.isJpeglsTransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.8/)},dwv.dicom.isJpeg2000TransferSyntax=function(a){return null!==a.match(/1.2.840.10008.1.2.4.9/)},dwv.dicom.DicomParser=function(){this.dicomElements={},this.numberOfItems=0,this.pixelBuffer=[]},dwv.dicom.DicomParser.prototype.getPixelBuffer=function(){return this.pixelBuffer},dwv.dicom.DicomParser.prototype.appendDicomElement=function(a){var b=a.name;"Item"===b&&++this.numberOfItems;for(var c=1;this.dicomElements[b];)b=a.name+(c++).toString();this.dicomElements[b]={group:a.group,element:a.element,vr:a.vr,vl:a.vl,value:a.value}},dwv.dicom.DicomParser.prototype.readTag=function(a,b){var c=a.readHex(b),d=a.readHex(b+2),e="dwv::unknown";return dwv.dicom.dictionary[c]&&dwv.dicom.dictionary[c][d]&&(e=dwv.dicom.dictionary[c][d][2]),{group:c,element:d,name:e}},dwv.dicom.DicomParser.prototype.readDataElement=function(a,b,c){var d,e,f=this.readTag(a,b),g=4,h=0,i=0;"0xFFFE"===f.group?(d="N/A",h=0,e=a.readUint32(b+g),i=4):c?(d="UN",dwv.dicom.dictionary[f.group]&&dwv.dicom.dictionary[f.group][f.element]&&(d=dwv.dicom.dictionary[f.group][f.element][0]),h=0,e=a.readUint32(b+g+h),i=4):(d=a.readString(b+g,2),h=2,"OB"===d||"OF"===d||"SQ"===d||"OW"===d||"UN"===d?(e=a.readUint32(b+g+h+2),i=6):(e=a.readUint16(b+g+h),i=2)),4294967295===e&&(e=0);var j,k=b+g+h+i;if("US"===d||"UL"===d){var l=a.readNumber(k,e);isNaN(l)&&console.warn("Not a number returned for tag: "+f.name),j=[l]}else"OW"===d?j=a.readUint16Array(k,e):"OB"===d||"N/A"===d?j=a.readUint8Array(k,e):"OX"===d?(console.warn("OX value representation for tag: "+f.name+"."),j="undefined"!=typeof this.dicomElements.BitsAllocated&&8===this.dicomElements.BitsAllocated.value[0]?a.readUint8Array(k,e):a.readUint16Array(k,e)):(j=a.readString(k,e),j=j.split("\\"));var m=g+h+i+e;return{tag:f,vr:d,vl:e,data:j,offset:m}},dwv.dicom.DicomParser.prototype.parse=function(a){var b=0,c=!1,d=!1,e=!1,f=new dwv.dicom.DataReader(a),g=new dwv.dicom.DataReader(a);b=128;var h=f.readString(b,4);if("DICM"!==h)throw new Error("Not a valid DICOM file (no magic DICM word found)");b+=4;var i=this.readDataElement(f,b),j=parseInt(i.data,10);b+=i.offset;for(var k=b,l=k+j,m=k;l>m;){if(i=this.readDataElement(f,m,!1),"TransferSyntaxUID"===i.tag.name){var n=dwv.utils.cleanString(i.data[0]);if("1.2.840.10008.1.2"===n)c=!0;else{if("1.2.840.10008.1.2.1.99"===n)throw new Error("Unsupported DICOM transfer syntax (Deflated Explicit VR): "+n);if("1.2.840.10008.1.2.2"===n)g=new dwv.dicom.DataReader(a,!1);else{if(dwv.dicom.isJpegTransferSyntax(n))throw d=!0,new Error("Unsupported DICOM transfer syntax (JPEG): "+n);if(dwv.dicom.isJpeglsTransferSyntax(n))throw new Error("Unsupported DICOM transfer syntax (JPEG-LS): "+n);if(dwv.dicom.isJpeg2000TransferSyntax(n))console.log("JPEG 2000 compressed DICOM data: "+n),e=!0;else{if("1.2.840.10008.1.2.4.100"===n)throw new Error("Unsupported DICOM transfer syntax (MPEG2): "+n);if("1.2.840.10008.1.2.4.5"===n)throw new Error("Unsupported DICOM transfer syntax (RLE): "+n)}}}}this.appendDicomElement({name:i.tag.name,group:i.tag.group,vr:i.vr,vl:i.vl,element:i.tag.element,value:i.data}),m+=i.offset}for(var o=!1,p="";m<a.byteLength;){try{i=this.readDataElement(g,m,c)}catch(q){console.warn("Problem reading at "+m+" / "+a.byteLength+", after "+p+".\n"+q)}if(p=i.tag.name,o)if("Item"===p){if(4===i.data.length)console.log("Skipping Basic Offset Table.");else if(0!==i.data.length){console.log("Concatenating multiple pixel data items, length: "+i.data.length);var r=i.data.length+this.pixelBuffer.length,s=new Uint16Array(r);s.set(this.pixelBuffer,0),s.set(i.data,this.pixelBuffer.length),this.pixelBuffer=s}}else{if("SequenceDelimitationItem"!==p)throw new Error("Unexpected tag in encapsulated pixel data: "+i.tag.name);o=!1}"PixelData"===p&&(0!==i.data.length?this.pixelBuffer=i.data:o=!0),this.appendDicomElement({name:p,group:i.tag.group,vr:i.vr,vl:i.vl,element:i.tag.element,value:i.data}),m+=i.offset}if(d);else if(e){var t=null;try{t=openjpeg(this.pixelBuffer,"j2k")}catch(u){throw new Error("Cannot decode JPEG 2000 (["+u.name+"] "+u.message+")")}this.pixelBuffer=t.data}},dwv.dicom.DicomParser.prototype.createImage=function(){if(!this.dicomElements.Columns)throw new Error("Missing DICOM image number of columns");if(!this.dicomElements.Rows)throw new Error("Missing DICOM image number of rows");var a=new dwv.image.Size(this.dicomElements.Columns.value[0],this.dicomElements.Rows.value[0]),b=1,c=1;this.dicomElements.PixelSpacing?(b=parseFloat(this.dicomElements.PixelSpacing.value[0]),c=parseFloat(this.dicomElements.PixelSpacing.value[1])):this.dicomElements.ImagerPixelSpacing&&(b=parseFloat(this.dicomElements.ImagerPixelSpacing.value[0]),c=parseFloat(this.dicomElements.ImagerPixelSpacing.value[1]));var d=new dwv.image.Spacing(c,b),e=dwv.utils.cleanString(this.dicomElements.TransferSyntaxUID.value[0]),f=dwv.dicom.isJpeg2000TransferSyntax(e),g=null;if(f&&16===this.dicomElements.BitsAllocated.value[0]){var h=a.getSliceSize();g=new Int16Array(h);for(var i=0,j=0;h>j;++j)g[j]=256*this.pixelBuffer[i]+this.pixelBuffer[i+1],i+=2}else{g=new Int16Array(this.pixelBuffer.length);var k=!1;this.dicomElements.PixelRepresentation&&1==this.dicomElements.PixelRepresentation.value[0]&&(k=!0);for(var l=0;l<this.pixelBuffer.length;++l)g[l]=this.pixelBuffer[l],k&&g[l]>=Math.pow(2,15)&&(g[l]-=Math.pow(2,16))}var m=new Array(0,0,0);this.dicomElements.ImagePositionPatient&&(m=[parseFloat(this.dicomElements.ImagePositionPatient.value[0]),parseFloat(this.dicomElements.ImagePositionPatient.value[1]),parseFloat(this.dicomElements.ImagePositionPatient.value[2])]);var n=new dwv.image.Image(a,d,g,[m]);if(this.dicomElements.PhotometricInterpretation){var o=dwv.utils.cleanString(this.dicomElements.PhotometricInterpretation.value[0]).toUpperCase();f&&o.match(/YBR/)&&(o="RGB"),n.setPhotometricInterpretation(o)}if(this.dicomElements.PlanarConfiguration){var p=this.dicomElements.PlanarConfiguration.value[0];f&&(p=1),n.setPlanarConfiguration(p)}this.dicomElements.RescaleSlope&&n.setRescaleSlope(parseFloat(this.dicomElements.RescaleSlope.value[0])),this.dicomElements.RescaleIntercept&&n.setRescaleIntercept(parseFloat(this.dicomElements.RescaleIntercept.value[0]));var q={};this.dicomElements.Modality&&(q.Modality=this.dicomElements.Modality.value[0]),this.dicomElements.StudyInstanceUID&&(q.StudyInstanceUID=this.dicomElements.StudyInstanceUID.value[0]),this.dicomElements.SeriesInstanceUID&&(q.SeriesInstanceUID=this.dicomElements.SeriesInstanceUID.value[0]),this.dicomElements.BitsStored&&(q.BitsStored=parseInt(this.dicomElements.BitsStored.value[0],10)),n.setMeta(q);var r=0;this.dicomElements.PixelRepresentation&&(r=this.dicomElements.PixelRepresentation.value[0]);var s=new dwv.image.View(n,r),t=[];if(this.dicomElements.WindowCenter&&this.dicomElements.WindowWidth)for(var u,v=0;v<this.dicomElements.WindowCenter.value.length;++v){var w=parseFloat(this.dicomElements.WindowWidth.value[v],10);0!==w&&(u=this.dicomElements.WindowCenterWidthExplanation?this.dicomElements.WindowCenterWidthExplanation.value[v]:"Default"+v,t.push({center:parseFloat(this.dicomElements.WindowCenter.value[v],10),width:w,name:u}))}return 0!==t.length?s.setWindowPresets(t):s.setWindowLevelMinMax(),s};var dwv=dwv||{};dwv.dicom=dwv.dicom||{},dwv.dicom.dictionary={"0x0000":{"0x0000":["UL","1","GroupLength"],"0x0001":["UL","1","CommandLengthToEnd"],"0x0002":["UI","1","AffectedSOPClassUID"],"0x0003":["UI","1","RequestedSOPClassUID"],"0x0010":["CS","1","CommandRecognitionCode"],"0x0100":["US","1","CommandField"],"0x0110":["US","1","MessageID"],"0x0120":["US","1","MessageIDBeingRespondedTo"],"0x0200":["AE","1","Initiator"],"0x0300":["AE","1","Receiver"],"0x0400":["AE","1","FindLocation"],"0x0600":["AE","1","MoveDestination"],"0x0700":["US","1","Priority"],"0x0800":["US","1","DataSetType"],"0x0850":["US","1","NumberOfMatches"],"0x0860":["US","1","ResponseSequenceNumber"],"0x0900":["US","1","Status"],"0x0901":["AT","1-n","OffendingElement"],"0x0902":["LO","1","ErrorComment"],"0x0903":["US","1","ErrorID"],"0x0904":["OT","1-n","ErrorInformation"],"0x1000":["UI","1","AffectedSOPInstanceUID"],"0x1001":["UI","1","RequestedSOPInstanceUID"],"0x1002":["US","1","EventTypeID"],"0x1003":["OT","1-n","EventInformation"],"0x1005":["AT","1-n","AttributeIdentifierList"],"0x1007":["AT","1-n","ModificationList"],"0x1008":["US","1","ActionTypeID"],"0x1009":["OT","1-n","ActionInformation"],"0x1013":["UI","1-n","SuccessfulSOPInstanceUIDList"],"0x1014":["UI","1-n","FailedSOPInstanceUIDList"],"0x1015":["UI","1-n","WarningSOPInstanceUIDList"],"0x1020":["US","1","NumberOfRemainingSuboperations"],"0x1021":["US","1","NumberOfCompletedSuboperations"],"0x1022":["US","1","NumberOfFailedSuboperations"],"0x1023":["US","1","NumberOfWarningSuboperations"],"0x1030":["AE","1","MoveOriginatorApplicationEntityTitle"],"0x1031":["US","1","MoveOriginatorMessageID"],"0x4000":["AT","1","DialogReceiver"],"0x4010":["AT","1","TerminalType"],"0x5010":["SH","1","MessageSetID"],"0x5020":["SH","1","EndMessageSet"],"0x5110":["AT","1","DisplayFormat"],"0x5120":["AT","1","PagePositionID"],"0x5130":["CS","1","TextFormatID"],"0x5140":["CS","1","NormalReverse"],"0x5150":["CS","1","AddGrayScale"],"0x5160":["CS","1","Borders"],"0x5170":["IS","1","Copies"],"0x5180":["CS","1","OldMagnificationType"],"0x5190":["CS","1","Erase"],"0x51A0":["CS","1","Print"],"0x51B0":["US","1-n","Overlays"]},"0x0002":{"0x0000":["UL","1","MetaElementGroupLength"],"0x0001":["OB","1","FileMetaInformationVersion"],"0x0002":["UI","1","MediaStorageSOPClassUID"],"0x0003":["UI","1","MediaStorageSOPInstanceUID"],"0x0010":["UI","1","TransferSyntaxUID"],"0x0012":["UI","1","ImplementationClassUID"],"0x0013":["SH","1","ImplementationVersionName"],"0x0016":["AE","1","SourceApplicationEntityTitle"],"0x0100":["UI","1","PrivateInformationCreatorUID"],"0x0102":["OB","1","PrivateInformation"]},"0x0004":{"0x0000":["UL","1","FileSetGroupLength"],"0x1130":["CS","1","FileSetID"],"0x1141":["CS","8","FileSetDescriptorFileID"],"0x1142":["CS","1","FileSetCharacterSet"],"0x1200":["UL","1","RootDirectoryFirstRecord"],"0x1202":["UL","1","RootDirectoryLastRecord"],"0x1212":["US","1","FileSetConsistencyFlag"],"0x1220":["SQ","1","DirectoryRecordSequence"],"0x1400":["UL","1","NextDirectoryRecordOffset"],"0x1410":["US","1","RecordInUseFlag"],"0x1420":["UL","1","LowerLevelDirectoryOffset"],"0x1430":["CS","1","DirectoryRecordType"],"0x1432":["UI","1","PrivateRecordUID"],"0x1500":["CS","8","ReferencedFileID"],"0x1504":["UL","1","DirectoryRecordOffset"],"0x1510":["UI","1","ReferencedSOPClassUIDInFile"],"0x1511":["UI","1","ReferencedSOPInstanceUIDInFile"],"0x1512":["UI","1","ReferencedTransferSyntaxUIDInFile"],"0x1600":["UL","1","NumberOfReferences"]},"0x0008":{"0x0000":["UL","1","IdentifyingGroupLength"],"0x0001":["UL","1","LengthToEnd"],"0x0005":["CS","1","SpecificCharacterSet"],"0x0008":["CS","1-n","ImageType"],"0x000A":["US","1","SequenceItemNumber"],"0x0010":["CS","1","RecognitionCode"],"0x0012":["DA","1","InstanceCreationDate"],"0x0013":["TM","1","InstanceCreationTime"],"0x0014":["UI","1","InstanceCreatorUID"],"0x0016":["UI","1","SOPClassUID"],"0x0018":["UI","1","SOPInstanceUID"],"0x0020":["DA","1","StudyDate"],"0x0021":["DA","1","SeriesDate"],"0x0022":["DA","1","AcquisitionDate"],"0x0023":["DA","1","ImageDate"],"0x0024":["DA","1","OverlayDate"],"0x0025":["DA","1","CurveDate"],"0x002A":["DT","1","AcquisitionDatetime"],"0x0030":["TM","1","StudyTime"],"0x0031":["TM","1","SeriesTime"],"0x0032":["TM","1","AcquisitionTime"],"0x0033":["TM","1","ImageTime"],"0x0034":["TM","1","OverlayTime"],"0x0035":["TM","1","CurveTime"],"0x0040":["US","1","OldDataSetType"],"0x0041":["LT","1","OldDataSetSubtype"],"0x0042":["CS","1","NuclearMedicineSeriesType"],"0x0050":["SH","1","AccessionNumber"],"0x0052":["CS","1","QueryRetrieveLevel"],"0x0054":["AE","1-n","RetrieveAETitle"],"0x0058":["UI","1-n","DataSetFailedSOPInstanceUIDList"],"0x0060":["CS","1","Modality"],"0x0061":["CS","1-n","ModalitiesInStudy"],"0x0064":["CS","1","ConversionType"],"0x0068":["CS","1","PresentationIntentType"],"0x0070":["LO","1","Manufacturer"],"0x0080":["LO","1","InstitutionName"],"0x0081":["ST","1","InstitutionAddress"],"0x0082":["SQ","1","InstitutionCodeSequence"],"0x0090":["PN","1","ReferringPhysicianName"],"0x0092":["ST","1","ReferringPhysicianAddress"],"0x0094":["SH","1-n","ReferringPhysicianTelephoneNumber"],"0x0100":["SH","1","CodeValue"],"0x0102":["SH","1","CodingSchemeDesignator"],"0x0103":["SH","1","CodingSchemeVersion"],"0x0104":["LO","1","CodeMeaning"],"0x0105":["CS","1","MappingResource"],"0x0106":["DT","1","ContextGroupVersion"],"0x0107":["DT","1","ContextGroupLocalVersion"],"0x010B":["CS","1","CodeSetExtensionFlag"],"0x010C":["UI","1","PrivateCodingSchemeCreatorUID"],"0x010D":["UI","1","CodeSetExtensionCreatorUID"],"0x010F":["CS","1","ContextIdentifier"],"0x0201":["SH","1","TimezoneOffsetFromUTC"],"0x1000":["AE","1","NetworkID"],"0x1010":["SH","1","StationName"],"0x1030":["LO","1","StudyDescription"],"0x1032":["SQ","1","ProcedureCodeSequence"],"0x103E":["LO","1","SeriesDescription"],"0x1040":["LO","1","InstitutionalDepartmentName"],"0x1048":["PN","1-n","PhysicianOfRecord"],"0x1050":["PN","1-n","PerformingPhysicianName"],"0x1060":["PN","1-n","PhysicianReadingStudy"],"0x1070":["PN","1-n","OperatorName"],"0x1080":["LO","1-n","AdmittingDiagnosisDescription"],"0x1084":["SQ","1","AdmittingDiagnosisCodeSequence"],"0x1090":["LO","1","ManufacturerModelName"],"0x1100":["SQ","1","ReferencedResultsSequence"],"0x1110":["SQ","1","ReferencedStudySequence"],"0x1111":["SQ","1","ReferencedStudyComponentSequence"],"0x1115":["SQ","1","ReferencedSeriesSequence"],"0x1120":["SQ","1","ReferencedPatientSequence"],"0x1125":["SQ","1","ReferencedVisitSequence"],"0x1130":["SQ","1","ReferencedOverlaySequence"],"0x1140":["SQ","1","ReferencedImageSequence"],"0x1145":["SQ","1","ReferencedCurveSequence"],"0x114A":["SQ","1","ReferencedInstanceSequence"],"0x114B":["LO","1","ReferenceDescription"],"0x1150":["UI","1","ReferencedSOPClassUID"],"0x1155":["UI","1","ReferencedSOPInstanceUID"],"0x115A":["UI","1-n","SOPClassesSupported"],"0x1160":["IS","1","ReferencedFrameNumber"],"0x1195":["UI","1","TransactionUID"],"0x1197":["US","1","FailureReason"],"0x1198":["SQ","1","FailedSOPSequence"],"0x1199":["SQ","1","ReferencedSOPSequence"],"0x2110":["CS","1","LossyImageCompression"],"0x2111":["ST","1","DerivationDescription"],"0x2112":["SQ","1","SourceImageSequence"],"0x2120":["SH","1","StageName"],"0x2122":["IS","1","StageNumber"],"0x2124":["IS","1","NumberOfStages"],"0x2128":["IS","1","ViewNumber"],"0x2129":["IS","1","NumberOfEventTimers"],"0x212A":["IS","1","NumberOfViewsInStage"],"0x2130":["DS","1-n","EventElapsedTime"],"0x2132":["LO","1-n","EventTimerName"],"0x2142":["IS","1","StartTrim"],"0x2143":["IS","1","StopTrim"],"0x2144":["IS","1","RecommendedDisplayFrameRate"],"0x2200":["CS","1","TransducerPosition"],"0x2204":["CS","1","TransducerOrientation"],"0x2208":["CS","1","AnatomicStructure"],"0x2218":["SQ","1","AnatomicRegionSequence"],"0x2220":["SQ","1","AnatomicRegionModifierSequence"],"0x2228":["SQ","1","PrimaryAnatomicStructureSequence"],"0x2229":["SQ","1","AnatomicStructureSpaceOrRegionSequence"],"0x2230":["SQ","1","PrimaryAnatomicStructureModifierSequence"],"0x2240":["SQ","1","TransducerPositionSequence"],"0x2242":["SQ","1","TransducerPositionModifierSequence"],"0x2244":["SQ","1","TransducerOrientationSequence"],"0x2246":["SQ","1","TransducerOrientationModifierSequence"],"0x4000":["LT","1-n","IdentifyingComments"]},"0x0010":{"0x0000":["UL","1","PatientGroupLength"],"0x0010":["PN","1","PatientName"],"0x0020":["LO","1","PatientID"],"0x0021":["LO","1","IssuerOfPatientID"],"0x0030":["DA","1","PatientBirthDate"],"0x0032":["TM","1","PatientBirthTime"],"0x0040":["CS","1","PatientSex"],"0x0050":["SQ","1","PatientInsurancePlanCodeSequence"],"0x1000":["LO","1-n","OtherPatientID"],"0x1001":["PN","1-n","OtherPatientName"],"0x1005":["PN","1","PatientBirthName"],"0x1010":["AS","1","PatientAge"],"0x1020":["DS","1","PatientSize"],"0x1030":["DS","1","PatientWeight"],"0x1040":["LO","1","PatientAddress"],"0x1050":["LT","1-n","InsurancePlanIdentification"],"0x1060":["PN","1","PatientMotherBirthName"],"0x1080":["LO","1","MilitaryRank"],"0x1081":["LO","1","BranchOfService"],"0x1090":["LO","1","MedicalRecordLocator"],"0x2000":["LO","1-n","MedicalAlerts"],"0x2110":["LO","1-n","ContrastAllergies"],"0x2150":["LO","1","CountryOfResidence"],"0x2152":["LO","1","RegionOfResidence"],"0x2154":["SH","1-n","PatientTelephoneNumber"],"0x2160":["SH","1","EthnicGroup"],"0x2180":["SH","1","Occupation"],"0x21A0":["CS","1","SmokingStatus"],"0x21B0":["LT","1","AdditionalPatientHistory"],"0x21C0":["US","1","PregnancyStatus"],"0x21D0":["DA","1","LastMenstrualDate"],"0x21F0":["LO","1","PatientReligiousPreference"],"0x4000":["LT","1","PatientComments"]},"0x0018":{"0x0000":["UL","1","AcquisitionGroupLength"],"0x0010":["LO","1","ContrastBolusAgent"],"0x0012":["SQ","1","ContrastBolusAgentSequence"],"0x0014":["SQ","1","ContrastBolusAdministrationRouteSequence"],"0x0015":["CS","1","BodyPartExamined"],"0x0020":["CS","1-n","ScanningSequence"],"0x0021":["CS","1-n","SequenceVariant"],"0x0022":["CS","1-n","ScanOptions"],"0x0023":["CS","1","MRAcquisitionType"],"0x0024":["SH","1","SequenceName"],"0x0025":["CS","1","AngioFlag"],"0x0026":["SQ","1","InterventionDrugInformationSequence"],"0x0027":["TM","1","InterventionDrugStopTime"],"0x0028":["DS","1","InterventionDrugDose"],"0x0029":["SQ","1","InterventionalDrugSequence"],"0x002A":["SQ","1","AdditionalDrugSequence"],"0x0030":["LO","1-n","Radionuclide"],"0x0031":["LO","1-n","Radiopharmaceutical"],"0x0032":["DS","1","EnergyWindowCenterline"],"0x0033":["DS","1-n","EnergyWindowTotalWidth"],"0x0034":["LO","1","InterventionalDrugName"],"0x0035":["TM","1","InterventionalDrugStartTime"],"0x0036":["SQ","1","InterventionalTherapySequence"],"0x0037":["CS","1","TherapyType"],"0x0038":["CS","1","InterventionalStatus"],"0x0039":["CS","1","TherapyDescription"],"0x0040":["IS","1","CineRate"],"0x0050":["DS","1","SliceThickness"],"0x0060":["DS","1","KVP"],"0x0070":["IS","1","CountsAccumulated"],"0x0071":["CS","1","AcquisitionTerminationCondition"],"0x0072":["DS","1","EffectiveSeriesDuration"],"0x0073":["CS","1","AcquisitionStartCondition"],"0x0074":["IS","1","AcquisitionStartConditionData"],"0x0075":["IS","1","AcquisitionTerminationConditionData"],"0x0080":["DS","1","RepetitionTime"],"0x0081":["DS","1","EchoTime"],"0x0082":["DS","1","InversionTime"],"0x0083":["DS","1","NumberOfAverages"],"0x0084":["DS","1","ImagingFrequency"],"0x0085":["SH","1","ImagedNucleus"],"0x0086":["IS","1-n","EchoNumber"],"0x0087":["DS","1","MagneticFieldStrength"],"0x0088":["DS","1","SpacingBetweenSlices"],"0x0089":["IS","1","NumberOfPhaseEncodingSteps"],"0x0090":["DS","1","DataCollectionDiameter"],"0x0091":["IS","1","EchoTrainLength"],"0x0093":["DS","1","PercentSampling"],"0x0094":["DS","1","PercentPhaseFieldOfView"],"0x0095":["DS","1","PixelBandwidth"],"0x1000":["LO","1","DeviceSerialNumber"],"0x1002":["UI","1","DeviceUID"],"0x1003":["LO","1","DeviceID"],"0x1004":["LO","1","PlateID"],"0x1005":["LO","1","GeneratorID"],"0x1006":["LO","1","GridID"],"0x1007":["LO","1","CassetteID"],"0x1008":["LO","1","GantryID"],"0x1010":["LO","1","SecondaryCaptureDeviceID"],"0x1011":["LO","1","HardcopyCreationDeviceID"],"0x1012":["DA","1","DateOfSecondaryCapture"],"0x1014":["TM","1","TimeOfSecondaryCapture"],"0x1016":["LO","1","SecondaryCaptureDeviceManufacturer"],"0x1017":["LO","1","HardcopyDeviceManufacturer"],"0x1018":["LO","1","SecondaryCaptureDeviceManufacturerModelName"],"0x1019":["LO","1-n","SecondaryCaptureDeviceSoftwareVersion"],"0x101A":["LO","1-n","HardcopyDeviceSoftwareVersion"],"0x101B":["LO","1","HardcopyDeviceManfuacturersModelName"],"0x1020":["LO","1-n","SoftwareVersion"],"0x1022":["SH","1","VideoImageFormatAcquired"],"0x1023":["LO","1","DigitalImageFormatAcquired"],"0x1030":["LO","1","ProtocolName"],"0x1040":["LO","1","ContrastBolusRoute"],"0x1041":["DS","1","ContrastBolusVolume"],"0x1042":["TM","1","ContrastBolusStartTime"],"0x1043":["TM","1","ContrastBolusStopTime"],"0x1044":["DS","1","ContrastBolusTotalDose"],"0x1045":["IS","1-n","SyringeCounts"],"0x1046":["DS","1-n","ContrastFlowRate"],"0x1047":["DS","1-n","ContrastFlowDuration"],"0x1048":["CS","1","ContrastBolusIngredient"],"0x1049":["DS","1","ContrastBolusIngredientConcentration"],"0x1050":["DS","1","SpatialResolution"],"0x1060":["DS","1","TriggerTime"],"0x1061":["LO","1","TriggerSourceOrType"],"0x1062":["IS","1","NominalInterval"],"0x1063":["DS","1","FrameTime"],"0x1064":["LO","1","FramingType"],"0x1065":["DS","1-n","FrameTimeVector"],"0x1066":["DS","1","FrameDelay"],"0x1067":["DS","1","ImageTriggerDelay"],"0x1068":["DS","1","MultiplexGroupTimeOffset"],"0x1069":["DS","1","TriggerTimeOffset"],"0x106A":["CS","1","SynchronizationTrigger"],"0x106C":["US","2","SynchronizationChannel"],"0x106E":["UL","1","TriggerSamplePosition"],"0x1070":["LO","1-n","RadionuclideRoute"],"0x1071":["DS","1-n","RadionuclideVolume"],"0x1072":["TM","1-n","RadionuclideStartTime"],"0x1073":["TM","1-n","RadionuclideStopTime"],"0x1074":["DS","1-n","RadionuclideTotalDose"],"0x1075":["DS","1","RadionuclideHalfLife"],"0x1076":["DS","1","RadionuclidePositronFraction"],"0x1077":["DS","1","RadiopharmaceuticalSpecificActivity"],"0x1080":["CS","1","BeatRejectionFlag"],"0x1081":["IS","1","LowRRValue"],"0x1082":["IS","1","HighRRValue"],"0x1083":["IS","1","IntervalsAcquired"],"0x1084":["IS","1","IntervalsRejected"],"0x1085":["LO","1","PVCRejection"],"0x1086":["IS","1","SkipBeats"],"0x1088":["IS","1","HeartRate"],"0x1090":["IS","1","CardiacNumberOfImages"],"0x1094":["IS","1","TriggerWindow"],"0x1100":["DS","1","ReconstructionDiameter"],"0x1110":["DS","1","DistanceSourceToDetector"],"0x1111":["DS","1","DistanceSourceToPatient"],"0x1114":["DS","1","EstimatedRadiographicMagnificationFactor"],"0x1120":["DS","1","GantryDetectorTilt"],"0x1121":["DS","1","GantryDetectorSlew"],"0x1130":["DS","1","TableHeight"],"0x1131":["DS","1","TableTraverse"],"0x1134":["DS","1","TableMotion"],"0x1135":["DS","1-n","TableVerticalIncrement"],"0x1136":["DS","1-n","TableLateralIncrement"],"0x1137":["DS","1-n","TableLongitudinalIncrement"],"0x1138":["DS","1","TableAngle"],"0x113A":["CS","1","TableType"],"0x1140":["CS","1","RotationDirection"],"0x1141":["DS","1","AngularPosition"],"0x1142":["DS","1-n","RadialPosition"],"0x1143":["DS","1","ScanArc"],"0x1144":["DS","1","AngularStep"],"0x1145":["DS","1","CenterOfRotationOffset"],"0x1146":["DS","1-n","RotationOffset"],"0x1147":["CS","1","FieldOfViewShape"],"0x1149":["IS","2","FieldOfViewDimension"],"0x1150":["IS","1","ExposureTime"],"0x1151":["IS","1","XrayTubeCurrent"],"0x1152":["IS","1","Exposure"],"0x1153":["IS","1","ExposureinuAs"],"0x1154":["DS","1","AveragePulseWidth"],"0x1155":["CS","1","RadiationSetting"],"0x1156":["CS","1","RectificationType"],"0x115A":["CS","1","RadiationMode"],"0x115E":["DS","1","ImageAreaDoseProduct"],"0x1160":["SH","1","FilterType"],"0x1161":["LO","1-n","TypeOfFilters"],"0x1162":["DS","1","IntensifierSize"],"0x1164":["DS","2","ImagerPixelSpacing"],"0x1166":["CS","1","Grid"],"0x1170":["IS","1","GeneratorPower"],"0x1180":["SH","1","CollimatorGridName"],"0x1181":["CS","1","CollimatorType"],"0x1182":["IS","1","FocalDistance"],"0x1183":["DS","1","XFocusCenter"],"0x1184":["DS","1","YFocusCenter"],"0x1190":["DS","1-n","FocalSpot"],"0x1191":["CS","1","AnodeTargetMaterial"],"0x11A0":["DS","1","BodyPartThickness"],"0x11A2":["DS","1","CompressionForce"],"0x1200":["DA","1-n","DateOfLastCalibration"],"0x1201":["TM","1-n","TimeOfLastCalibration"],"0x1210":["SH","1-n","ConvolutionKernel"],"0x1240":["IS","1-n","UpperLowerPixelValues"],"0x1242":["IS","1","ActualFrameDuration"],"0x1243":["IS","1","CountRate"],"0x1244":["US","1","PreferredPlaybackSequencing"],"0x1250":["SH","1","ReceivingCoil"],"0x1251":["SH","1","TransmittingCoil"],"0x1260":["SH","1","PlateType"],"0x1261":["LO","1","PhosphorType"],"0x1300":["IS","1","ScanVelocity"],"0x1301":["CS","1-n","WholeBodyTechnique"],"0x1302":["IS","1","ScanLength"],"0x1310":["US","4","AcquisitionMatrix"],"0x1312":["CS","1","PhaseEncodingDirection"],"0x1314":["DS","1","FlipAngle"],"0x1315":["CS","1","VariableFlipAngleFlag"],"0x1316":["DS","1","SAR"],"0x1318":["DS","1","dBdt"],"0x1400":["LO","1","AcquisitionDeviceProcessingDescription"],"0x1401":["LO","1","AcquisitionDeviceProcessingCode"],"0x1402":["CS","1","CassetteOrientation"],"0x1403":["CS","1","CassetteSize"],"0x1404":["US","1","ExposuresOnPlate"],"0x1405":["IS","1","RelativeXrayExposure"],"0x1450":["DS","1","ColumnAngulation"],"0x1460":["DS","1","TomoLayerHeight"],"0x1470":["DS","1","TomoAngle"],"0x1480":["DS","1","TomoTime"],"0x1490":["CS","1","TomoType"],"0x1491":["CS","1","TomoClass"],"0x1495":["IS","1","NumberofTomosynthesisSourceImages"],"0x1500":["CS","1","PositionerMotion"],"0x1508":["CS","1","PositionerType"],"0x1510":["DS","1","PositionerPrimaryAngle"],"0x1511":["DS","1","PositionerSecondaryAngle"],"0x1520":["DS","1-n","PositionerPrimaryAngleIncrement"],"0x1521":["DS","1-n","PositionerSecondaryAngleIncrement"],"0x1530":["DS","1","DetectorPrimaryAngle"],"0x1531":["DS","1","DetectorSecondaryAngle"],"0x1600":["CS","3","ShutterShape"],"0x1602":["IS","1","ShutterLeftVerticalEdge"],"0x1604":["IS","1","ShutterRightVerticalEdge"],"0x1606":["IS","1","ShutterUpperHorizontalEdge"],"0x1608":["IS","1","ShutterLowerHorizontalEdge"],"0x1610":["IS","1","CenterOfCircularShutter"],"0x1612":["IS","1","RadiusOfCircularShutter"],"0x1620":["IS","1-n","VerticesOfPolygonalShutter"],"0x1622":["US","1","ShutterPresentationValue"],"0x1623":["US","1","ShutterOverlayGroup"],"0x1700":["CS","3","CollimatorShape"],"0x1702":["IS","1","CollimatorLeftVerticalEdge"],"0x1704":["IS","1","CollimatorRightVerticalEdge"],"0x1706":["IS","1","CollimatorUpperHorizontalEdge"],"0x1708":["IS","1","CollimatorLowerHorizontalEdge"],"0x1710":["IS","1","CenterOfCircularCollimator"],"0x1712":["IS","1","RadiusOfCircularCollimator"],"0x1720":["IS","1-n","VerticesOfPolygonalCollimator"],"0x1800":["CS","1","AcquisitionTimeSynchronized"],"0x1801":["SH","1","TimeSource"],"0x1802":["CS","1","TimeDistributionProtocol"],"0x1810":["DT","1","AcquisitionTimestamp"],"0x4000":["LT","1-n","AcquisitionComments"],"0x5000":["SH","1-n","OutputPower"],"0x5010":["LO","3","TransducerData"],"0x5012":["DS","1","FocusDepth"],"0x5020":["LO","1","PreprocessingFunction"],"0x5021":["LO","1","PostprocessingFunction"],"0x5022":["DS","1","MechanicalIndex"],"0x5024":["DS","1","ThermalIndex"],"0x5026":["DS","1","CranialThermalIndex"],"0x5027":["DS","1","SoftTissueThermalIndex"],"0x5028":["DS","1","SoftTissueFocusThermalIndex"],"0x5029":["DS","1","SoftTissueSurfaceThermalIndex"],"0x5030":["DS","1","DynamicRange"],"0x5040":["DS","1","TotalGain"],"0x5050":["IS","1","DepthOfScanField"],"0x5100":["CS","1","PatientPosition"],"0x5101":["CS","1","ViewPosition"],"0x5104":["SQ","1","ProjectionEponymousNameCodeSequence"],"0x5210":["DS","6","ImageTransformationMatrix"],"0x5212":["DS","3","ImageTranslationVector"],"0x6000":["DS","1","Sensitivity"],"0x6011":["SQ","1","SequenceOfUltrasoundRegions"],"0x6012":["US","1","RegionSpatialFormat"],"0x6014":["US","1","RegionDataType"],"0x6016":["UL","1","RegionFlags"],"0x6018":["UL","1","RegionLocationMinX0"],"0x601A":["UL","1","RegionLocationMinY0"],"0x601C":["UL","1","RegionLocationMaxX1"],"0x601E":["UL","1","RegionLocationMaxY1"],"0x6020":["SL","1","ReferencePixelX0"],"0x6022":["SL","1","ReferencePixelY0"],"0x6024":["US","1","PhysicalUnitsXDirection"],"0x6026":["US","1","PhysicalUnitsYDirection"],"0x6028":["FD","1","ReferencePixelPhysicalValueX"],"0x602A":["FD","1","ReferencePixelPhysicalValueY"],"0x602C":["FD","1","PhysicalDeltaX"],"0x602E":["FD","1","PhysicalDeltaY"],"0x6030":["UL","1","TransducerFrequency"],"0x6031":["CS","1","TransducerType"],"0x6032":["UL","1","PulseRepetitionFrequency"],"0x6034":["FD","1","DopplerCorrectionAngle"],"0x6036":["FD","1","SteeringAngle"],"0x6038":["UL","1","DopplerSampleVolumeXPosition"],"0x603A":["UL","1","DopplerSampleVolumeYPosition"],"0x603C":["UL","1","TMLinePositionX0"],"0x603E":["UL","1","TMLinePositionY0"],"0x6040":["UL","1","TMLinePositionX1"],"0x6042":["UL","1","TMLinePositionY1"],"0x6044":["US","1","PixelComponentOrganization"],"0x6046":["UL","1","PixelComponentMask"],"0x6048":["UL","1","PixelComponentRangeStart"],"0x604A":["UL","1","PixelComponentRangeStop"],"0x604C":["US","1","PixelComponentPhysicalUnits"],"0x604E":["US","1","PixelComponentDataType"],"0x6050":["UL","1","NumberOfTableBreakPoints"],"0x6052":["UL","1-n","TableOfXBreakPoints"],"0x6054":["FD","1-n","TableOfYBreakPoints"],"0x6056":["UL","1","NumberOfTableEntries"],"0x6058":["UL","1-n","TableOfPixelValues"],"0x605A":["FL","1-n","TableOfParameterValues"],"0x7000":["CS","1","DetectorConditionsNominalFlag"],"0x7001":["DS","1","DetectorTemperature"],"0x7004":["CS","1","DetectorType"],"0x7005":["CS","1","DetectorConfiguration"],"0x7006":["LT","1","DetectorDescription"],"0x7008":["LT","1","DetectorMode"],"0x700A":["SH","1","DetectorID"],"0x700C":["DA","1","DateofLastDetectorCalibration"],"0x700E":["TM","1","TimeofLastDetectorCalibration"],"0x7010":["IS","1","ExposuresOnDetectorSinceLastCalibration"],"0x7011":["IS","1","ExposuresOnDetectorSinceManufactured"],"0x7012":["DS","1","DetectorTimeSinceLastExposure"],"0x7014":["DS","1","DetectorActiveTime"],"0x7016":["DS","1","DetectorActivationOffsetFromExposure"],"0x701A":["DS","2","DetectorBinning"],"0x7020":["DS","2","DetectorElementPhysicalSize"],"0x7022":["DS","2","DetectorElementSpacing"],"0x7024":["CS","1","DetectorActiveShape"],"0x7026":["DS","1-2","DetectorActiveDimensions"],"0x7028":["DS","2","DetectorActiveOrigin"],"0x7030":["DS","2","FieldofViewOrigin"],"0x7032":["DS","1","FieldofViewRotation"],"0x7034":["CS","1","FieldofViewHorizontalFlip"],"0x7040":["LT","1","GridAbsorbingMaterial"],"0x7041":["LT","1","GridSpacingMaterial"],"0x7042":["DS","1","GridThickness"],"0x7044":["DS","1","GridPitch"],"0x7046":["IS","2","GridAspectRatio"],"0x7048":["DS","1","GridPeriod"],"0x704C":["DS","1","GridFocalDistance"],"0x7050":["LT","1-n","FilterMaterial"],"0x7052":["DS","1-n","FilterThicknessMinimum"],"0x7054":["DS","1-n","FilterThicknessMaximum"],"0x7060":["CS","1","ExposureControlMode"],"0x7062":["LT","1","ExposureControlModeDescription"],"0x7064":["CS","1","ExposureStatus"],"0x7065":["DS","1","PhototimerSetting"]},"0x0020":{"0x0000":["UL","1","ImageGroupLength"],"0x000D":["UI","1","StudyInstanceUID"],"0x000E":["UI","1","SeriesInstanceUID"],"0x0010":["SH","1","StudyID"],"0x0011":["IS","1","SeriesNumber"],"0x0012":["IS","1","AcquisitionNumber"],"0x0013":["IS","1","ImageNumber"],"0x0014":["IS","1","IsotopeNumber"],"0x0015":["IS","1","PhaseNumber"],"0x0016":["IS","1","IntervalNumber"],"0x0017":["IS","1","TimeSlotNumber"],"0x0018":["IS","1","AngleNumber"],"0x0019":["IS","1","ItemNumber"],"0x0020":["CS","2","PatientOrientation"],"0x0022":["IS","1","OverlayNumber"],"0x0024":["IS","1","CurveNumber"],"0x0026":["IS","1","LUTNumber"],"0x0030":["DS","3","ImagePosition"],"0x0032":["DS","3","ImagePositionPatient"],"0x0035":["DS","6","ImageOrientation"],"0x0037":["DS","6","ImageOrientationPatient"],"0x0050":["DS","1","Location"],"0x0052":["UI","1","FrameOfReferenceUID"],"0x0060":["CS","1","Laterality"],"0x0062":["CS","1","ImageLaterality"],"0x0070":["LT","1","ImageGeometryType"],"0x0080":["CS","1-n","MaskingImage"],"0x0100":["IS","1","TemporalPositionIdentifier"],"0x0105":["IS","1","NumberOfTemporalPositions"],"0x0110":["DS","1","TemporalResolution"],"0x0200":["UI","1","SynchronizationFrameofReferenceUID"],"0x1000":["IS","1","SeriesInStudy"],"0x1001":["IS","1","AcquisitionsInSeries"],"0x1002":["IS","1","ImagesInAcquisition"],"0x1003":["IS","1","ImagesInSeries"],"0x1004":["IS","1","AcquisitionsInStudy"],"0x1005":["IS","1","ImagesInStudy"],"0x1020":["CS","1-n","Reference"],"0x1040":["LO","1","PositionReferenceIndicator"],"0x1041":["DS","1","SliceLocation"],"0x1070":["IS","1-n","OtherStudyNumbers"],"0x1200":["IS","1","NumberOfPatientRelatedStudies"],"0x1202":["IS","1","NumberOfPatientRelatedSeries"],"0x1204":["IS","1","NumberOfPatientRelatedImages"],"0x1206":["IS","1","NumberOfStudyRelatedSeries"],"0x1208":["IS","1","NumberOfStudyRelatedImages"],"0x1209":["IS","1","NumberOfSeriesRelatedInstances"],"0x3100":["CS","1-n","SourceImageID"],"0x3401":["CS","1","ModifyingDeviceID"],"0x3402":["CS","1","ModifiedImageID"],"0x3403":["DA","1","ModifiedImageDate"],"0x3404":["LO","1","ModifyingDeviceManufacturer"],"0x3405":["TM","1","ModifiedImageTime"],"0x3406":["LT","1","ModifiedImageDescription"],"0x4000":["LT","1","ImageComments"],"0x5000":["AT","1-n","OriginalImageIdentification"],"0x5002":["CS","1-n","OriginalImageIdentificationNomenclature"]},"0x0028":{"0x0000":["UL","1","ImagePresentationGroupLength"],"0x0002":["US","1","SamplesPerPixel"],"0x0004":["CS","1","PhotometricInterpretation"],"0x0005":["US","1","ImageDimensions"],"0x0006":["US","1","PlanarConfiguration"],"0x0008":["IS","1","NumberOfFrames"],"0x0009":["AT","1","FrameIncrementPointer"],"0x0010":["US","1","Rows"],"0x0011":["US","1","Columns"],"0x0012":["US","1","Planes"],"0x0014":["US","1","UltrasoundColorDataPresent"],"0x0030":["DS","2","PixelSpacing"],"0x0031":["DS","2","ZoomFactor"],"0x0032":["DS","2","ZoomCenter"],"0x0034":["IS","2","PixelAspectRatio"],"0x0040":["CS","1","ImageFormat"],"0x0050":["LT","1-n","ManipulatedImage"],"0x0051":["CS","1","CorrectedImage"],"0x005F":["CS","1","CompressionRecognitionCode"],"0x0060":["CS","1","CompressionCode"],"0x0061":["SH","1","CompressionOriginator"],"0x0062":["SH","1","CompressionLabel"],"0x0063":["SH","1","CompressionDescription"],"0x0065":["CS","1-n","CompressionSequence"],"0x0066":["AT","1-n","CompressionStepPointers"],"0x0068":["US","1","RepeatInterval"],"0x0069":["US","1","BitsGrouped"],"0x0070":["US","1-n","PerimeterTable"],"0x0071":["XS","1","PerimeterValue"],"0x0080":["US","1","PredictorRows"],"0x0081":["US","1","PredictorColumns"],"0x0082":["US","1-n","PredictorConstants"],"0x0090":["CS","1","BlockedPixels"],"0x0091":["US","1","BlockRows"],"0x0092":["US","1","BlockColumns"],"0x0093":["US","1","RowOverlap"],"0x0094":["US","1","ColumnOverlap"],"0x0100":["US","1","BitsAllocated"],"0x0101":["US","1","BitsStored"],"0x0102":["US","1","HighBit"],"0x0103":["US","1","PixelRepresentation"],"0x0104":["XS","1","SmallestValidPixelValue"],"0x0105":["XS","1","LargestValidPixelValue"],"0x0106":["XS","1","SmallestImagePixelValue"],"0x0107":["XS","1","LargestImagePixelValue"],"0x0108":["XS","1","SmallestPixelValueInSeries"],"0x0109":["XS","1","LargestPixelValueInSeries"],"0x0110":["XS","1","SmallestPixelValueInPlane"],"0x0111":["XS","1","LargestPixelValueInPlane"],"0x0120":["XS","1","PixelPaddingValue"],"0x0200":["US","1","ImageLocation"],"0x0300":["CS","1","QualityControlImage"],"0x0301":["CS","1","BurnedInAnnotation"],"0x0400":["CS","1","TransformLabel"],"0x0401":["CS","1","TransformVersionNumber"],"0x0402":["US","1","NumberOfTransformSteps"],"0x0403":["CS","1-n","SequenceOfCompressedData"],"0x0404":["AT","1-n","DetailsOfCoefficients"],"0x0410":["US","1","RowsForNthOrderCoefficients"],"0x0411":["US","1","ColumnsForNthOrderCoefficients"],"0x0412":["CS","1-n","CoefficientCoding"],"0x0413":["AT","1-n","CoefficientCodingPointers"],"0x0700":["CS","1","DCTLabel"],"0x0701":["CS","1-n","DataBlockDescription"],"0x0702":["AT","1-n","DataBlock"],"0x0710":["US","1","NormalizationFactorFormat"],"0x0720":["US","1","ZonalMapNumberFormat"],"0x0721":["AT","1-n","ZonalMapLocation"],"0x0722":["US","1","ZonalMapFormat"],"0x0730":["US","1","AdaptiveMapFormat"],"0x0740":["US","1","CodeNumberFormat"],"0x0800":["CS","1-n","CodeLabel"],"0x0802":["US","1","NumberOfTables"],"0x0803":["AT","1-n","CodeTableLocation"],"0x0804":["US","1","BitsForCodeWord"],"0x0808":["AT","1-n","ImageDataLocation"],"0x1040":["CS","1","PixelIntensityRelationship"],"0x1041":["SS","1","PixelIntensityRelationshipSign"],"0x1050":["DS","1-n","WindowCenter"],"0x1051":["DS","1-n","WindowWidth"],"0x1052":["DS","1","RescaleIntercept"],"0x1053":["DS","1","RescaleSlope"],"0x1054":["LO","1","RescaleType"],"0x1055":["LO","1-n","WindowCenterWidthExplanation"],"0x1080":["CS","1","GrayScale"],"0x1090":["CS","1","RecommendedViewingMode"],"0x1100":["XS","3","GrayLookupTableDescriptor"],"0x1101":["XS","3","RedPaletteColorLookupTableDescriptor"],"0x1102":["XS","3","GreenPaletteColorLookupTableDescriptor"],"0x1103":["XS","3","BluePaletteColorLookupTableDescriptor"],"0x1111":["US","4","LargeRedPaletteColorLookupTableDescriptor"],"0x1112":["US","4","LargeGreenPaletteColorLookupTabe"],"0x1113":["US","4","LargeBluePaletteColorLookupTabl"],"0x1199":["UI","1","PaletteColorLookupTableUID"],"0x1200":["XS","1-n","GrayLookupTableData"],"0x1201":["XS","1-n","RedPaletteColorLookupTableData"],"0x1202":["XS","1-n","GreenPaletteColorLookupTableData"],"0x1203":["XS","1-n","BluePaletteColorLookupTableData"],"0x1211":["OW","1","LargeRedPaletteColorLookupTableData"],"0x1212":["OW","1","LargeGreenPaletteColorLookupTableData"],"0x1213":["OW","1","LargeBluePaletteColorLookupTableData"],"0x1214":["UI","1","LargePaletteColorLookupTableUID"],"0x1221":["OW","1","SegmentedRedPaletteColorLookupTableData"],"0x1222":["OW","1","SegmentedGreenPaletteColorLookupTableData"],"0x1223":["OW","1","SegmentedBluePaletteColorLookupTableData"],"0x1300":["CS","1","ImplantPresent"],"0x2110":["CS","1","LossyImageCompression"],"0x2112":["DS","1-n","LossyImageCompressionRatio"],"0x3000":["SQ","1","ModalityLUTSequence"],"0x3002":["XS","3","LUTDescriptor"],"0x3003":["LO","1","LUTExplanation"],"0x3004":["LO","1","ModalityLUTType"],"0x3006":["XS","1-n","LUTData"],"0x3010":["SQ","1","VOILUTSequence"],"0x3110":["SQ","1","SoftcopyVOILUTSequence"],"0x4000":["LT","1-n","ImagePresentationComments"],"0x5000":["SQ","1","BiPlaneAcquisitionSequence"],"0x6010":["US","1","RepresentativeFrameNumber"],"0x6020":["US","1-n","FrameNumbersOfInterest"],"0x6022":["LO","1-n","FrameOfInterestDescription"],"0x6030":["US","1-n","MaskPointer"],"0x6040":["US","1-n","RWavePointer"],"0x6100":["SQ","1","MaskSubtractionSequence"],"0x6101":["CS","1","MaskOperation"],"0x6102":["US","1-n","ApplicableFrameRange"],"0x6110":["US","1-n","MaskFrameNumbers"],"0x6112":["US","1","ContrastFrameAveraging"],"0x6114":["FL","2","MaskSubPixelShift"],"0x6120":["SS","1","TIDOffset"],"0x6190":["ST","1","MaskOperationExplanation"]},"0x0032":{"0x0000":["UL","1","StudyGroupLength"],"0x000A":["CS","1","StudyStatusID"],"0x000C":["CS","1","StudyPriorityID"],"0x0012":["LO","1","StudyIDIssuer"],"0x0032":["DA","1","StudyVerifiedDate"],"0x0033":["TM","1","StudyVerifiedTime"],"0x0034":["DA","1","StudyReadDate"],"0x0035":["TM","1","StudyReadTime"],"0x1000":["DA","1","ScheduledStudyStartDate"],"0x1001":["TM","1","ScheduledStudyStartTime"],"0x1010":["DA","1","ScheduledStudyStopDate"],"0x1011":["TM","1","ScheduledStudyStopTime"],"0x1020":["LO","1","ScheduledStudyLocation"],"0x1021":["AE","1-n","ScheduledStudyLocationAETitle"],"0x1030":["LO","1","ReasonForStudy"],"0x1032":["PN","1","RequestingPhysician"],"0x1033":["LO","1","RequestingService"],"0x1040":["DA","1","StudyArrivalDate"],"0x1041":["TM","1","StudyArrivalTime"],"0x1050":["DA","1","StudyCompletionDate"],"0x1051":["TM","1","StudyCompletionTime"],"0x1055":["CS","1","StudyComponentStatusID"],"0x1060":["LO","1","RequestedProcedureDescription"],"0x1064":["SQ","1","RequestedProcedureCodeSequence"],"0x1070":["LO","1","RequestedContrastAgent"],"0x4000":["LT","1","StudyComments"]},"0x0038":{"0x0000":["UL","1","VisitGroupLength"],"0x0004":["SQ","1","ReferencedPatientAliasSequence"],"0x0008":["CS","1","VisitStatusID"],"0x0010":["LO","1","AdmissionID"],"0x0011":["LO","1","IssuerOfAdmissionID"],"0x0016":["LO","1","RouteOfAdmissions"],"0x001A":["DA","1","ScheduledAdmissionDate"],"0x001B":["TM","1","ScheduledAdmissionTime"],"0x001C":["DA","1","ScheduledDischargeDate"],"0x001D":["TM","1","ScheduledDischargeTime"],"0x001E":["LO","1","ScheduledPatientInstitutionResidence"],"0x0020":["DA","1","AdmittingDate"],"0x0021":["TM","1","AdmittingTime"],"0x0030":["DA","1","DischargeDate"],"0x0032":["TM","1","DischargeTime"],"0x0040":["LO","1","DischargeDiagnosisDescription"],"0x0044":["SQ","1","DischargeDiagnosisCodeSequence"],"0x0050":["LO","1","SpecialNeeds"],"0x0300":["LO","1","CurrentPatientLocation"],"0x0400":["LO","1","PatientInstitutionResidence"],"0x0500":["LO","1","PatientState"],"0x4000":["LT","1","VisitComments"]},"0x003A":{"0x0004":["CS","1","WaveformOriginality"],"0x0005":["US","1","NumberofChannels"],"0x0010":["UL","1","NumberofSamples"],"0x001A":["DS","1","SamplingFrequency"],"0x0020":["SH","1","MultiplexGroupLabel"],"0x0200":["SQ","1","ChannelDefinitionSequence"],"0x0202":["IS","1","WVChannelNumber"],"0x0203":["SH","1","ChannelLabel"],"0x0205":["CS","1-n","ChannelStatus"],"0x0208":["SQ","1","ChannelSourceSequence"],"0x0209":["SQ","1","ChannelSourceModifiersSequence"],"0x020A":["SQ","1","SourceWaveformSequence"],"0x020C":["LO","1","ChannelDerivationDescription"],"0x0210":["DS","1","ChannelSensitivity"],"0x0211":["SQ","1","ChannelSensitivityUnits"],"0x0212":["DS","1","ChannelSensitivityCorrectionFactor"],"0x0213":["DS","1","ChannelBaseline"],"0x0214":["DS","1","ChannelTimeSkew"],"0x0215":["DS","1","ChannelSampleSkew"],"0x0218":["DS","1","ChannelOffset"],"0x021A":["US","1","WaveformBitsStored"],"0x0220":["DS","1","FilterLowFrequency"],"0x0221":["DS","1","FilterHighFrequency"],"0x0222":["DS","1","NotchFilterFrequency"],"0x0223":["DS","1","NotchFilterBandwidth"]},"0x0040":{"0x0000":["UL","1","ModalityWorklistGroupLength"],"0x0001":["AE","1","ScheduledStationAETitle"],"0x0002":["DA","1","ScheduledProcedureStepStartDate"],"0x0003":["TM","1","ScheduledProcedureStepStartTime"],"0x0004":["DA","1","ScheduledProcedureStepEndDate"],"0x0005":["TM","1","ScheduledProcedureStepEndTime"],"0x0006":["PN","1","ScheduledPerformingPhysicianName"],"0x0007":["LO","1","ScheduledProcedureStepDescription"],"0x0008":["SQ","1","ScheduledProcedureStepCodeSequence"],"0x0009":["SH","1","ScheduledProcedureStepID"],"0x0010":["SH","1","ScheduledStationName"],"0x0011":["SH","1","ScheduledProcedureStepLocation"],"0x0012":["LO","1","ScheduledPreOrderOfMedication"],"0x0020":["CS","1","ScheduledProcedureStepStatus"],"0x0100":["SQ","1-n","ScheduledProcedureStepSequence"],"0x0220":["SQ","1","ReferencedStandaloneSOPInstanceSequence"],"0x0241":["AE","1","PerformedStationAETitle"],"0x0242":["SH","1","PerformedStationName"],"0x0243":["SH","1","PerformedLocation"],"0x0244":["DA","1","PerformedProcedureStepStartDate"],"0x0245":["TM","1","PerformedProcedureStepStartTime"],"0x0250":["DA","1","PerformedProcedureStepEndDate"],"0x0251":["TM","1","PerformedProcedureStepEndTime"],"0x0252":["CS","1","PerformedProcedureStepStatus"],"0x0253":["CS","1","PerformedProcedureStepID"],"0x0254":["LO","1","PerformedProcedureStepDescription"],"0x0255":["LO","1","PerformedProcedureTypeDescription"],"0x0260":["SQ","1","PerformedActionItemSequence"],"0x0270":["SQ","1","ScheduledStepAttributesSequence"],"0x0275":["SQ","1","RequestAttributesSequence"],"0x0280":["ST","1","CommentsOnThePerformedProcedureSteps"],"0x0293":["SQ","1","QuantitySequence"],"0x0294":["DS","1","Quantity"],"0x0295":["SQ","1","MeasuringUnitsSequence"],"0x0296":["SQ","1","BillingItemSequence"],"0x0300":["US","1","TotalTimeOfFluoroscopy"],"0x0301":["US","1","TotalNumberOfExposures"],"0x0302":["US","1","EntranceDose"],"0x0303":["US","1-2","ExposedArea"],"0x0306":["DS","1","DistanceSourceToEntrance"],"0x0307":["DS","1","DistanceSourceToSupport"],"0x0310":["ST","1","CommentsOnRadiationDose"],"0x0312":["DS","1","XRayOutput"],"0x0314":["DS","1","HalfValueLayer"],"0x0316":["DS","1","OrganDose"],"0x0318":["CS","1","OrganExposed"],"0x0320":["SQ","1","BillingProcedureStepSequence"],"0x0321":["SQ","1","FilmConsumptionSequence"],"0x0324":["SQ","1","BillingSuppliesAndDevicesSequence"],"0x0330":["SQ","1","ReferencedProcedureStepSequence"],"0x0340":["SQ","1","PerformedSeriesSequence"],"0x0400":["LT","1","CommentsOnScheduledProcedureStep"],"0x050A":["LO","1","SpecimenAccessionNumber"],"0x0550":["SQ","1","SpecimenSequence"],"0x0551":["LO","1","SpecimenIdentifier"],"0x0555":["SQ","1","AcquisitionContextSequence"],"0x0556":["ST","1","AcquisitionContextDescription"],"0x059A":["SQ","1","SpecimenTypeCodeSequence"],"0x06FA":["LO","1","SlideIdentifier"],"0x071A":["SQ","1","ImageCenterPointCoordinatesSequence"],"0x072A":["DS","1","XOffsetInSlideCoordinateSystem"],"0x073A":["DS","1","YOffsetInSlideCoordinateSystem"],"0x074A":["DS","1","ZOffsetInSlideCoordinateSystem"],"0x08D8":["SQ","1","PixelSpacingSequence"],"0x08DA":["SQ","1","CoordinateSystemAxisCodeSequence"],"0x08EA":["SQ","1","MeasurementUnitsCodeSequence"],"0x1001":["SH","1","RequestedProcedureID"],"0x1002":["LO","1","ReasonForRequestedProcedure"],"0x1003":["SH","1","RequestedProcedurePriority"],"0x1004":["LO","1","PatientTransportArrangements"],"0x1005":["LO","1","RequestedProcedureLocation"],"0x1006":["SH","1","PlacerOrderNumberOfProcedure"],"0x1007":["SH","1","FillerOrderNumberOfProcedure"],"0x1008":["LO","1","ConfidentialityCode"],"0x1009":["SH","1","ReportingPriority"],"0x1010":["PN","1-n","NamesOfIntendedRecipientsOfResults"],"0x1400":["LT","1","RequestedProcedureComments"],"0x2001":["LO","1","ReasonForTheImagingServiceRequest"],"0x2002":["LO","1","ImagingServiceRequestDescription"],"0x2004":["DA","1","IssueDateOfImagingServiceRequest"],"0x2005":["TM","1","IssueTimeOfImagingServiceRequest"],"0x2006":["SH","1","PlacerOrderNumberOfImagingServiceRequest"],"0x2007":["SH","0","FillerOrderNumberOfImagingServiceRequest"],"0x2008":["PN","1","OrderEnteredBy"],"0x2009":["SH","1","OrderEntererLocation"],"0x2010":["SH","1","OrderCallbackPhoneNumber"],"0x2016":["LO","1","PlacerOrderNumberImagingServiceRequest"],"0x2017":["LO","1","FillerOrderNumberImagingServiceRequest"],"0x2400":["LT","1","ImagingServiceRequestComments"],"0x3001":["LT","1","ConfidentialityConstraint"],"0xA010":["CS","1","RelationshipType"],"0xA027":["LO","1","VerifyingOrganization"],"0xA030":["DT","1","VerificationDateTime"],"0xA032":["DT","1","ObservationDateTime"],"0xA040":["CS","1","ValueType"],"0xA043":["SQ","1","ConceptNameCodeSequence"],"0xA050":["CS","1","ContinuityOfContent"],"0xA073":["SQ","1","VerifyingObserverSequence"],"0xA075":["PN","1","VerifyingObserverName"],"0xA088":["SQ","1","VerifyingObserverIdentificationCodeSeque"],"0xA0B0":["US","2-2n","ReferencedWaveformChannels"],"0xA120":["DT","1","DateTime"],"0xA121":["DA","1","Date"],"0xA122":["TM","1","Time"],"0xA123":["PN","1","PersonName"],"0xA124":["UI","1","UID"],"0xA130":["CS","1","TemporalRangeType"],"0xA132":["UL","1-n","ReferencedSamplePositionsU"],"0xA136":["US","1-n","ReferencedFrameNumbers"],"0xA138":["DS","1-n","ReferencedTimeOffsets"],"0xA13A":["DT","1-n","ReferencedDatetime"],"0xA160":["UT","1","TextValue"],"0xA168":["SQ","1","ConceptCodeSequence"],"0xA180":["US","1","AnnotationGroupNumber"],"0xA195":["SQ","1","ConceptNameCodeSequenceModifier"],"0xA300":["SQ","1","MeasuredValueSequence"],"0xA30A":["DS","1-n","NumericValue"],"0xA360":["SQ","1","PredecessorDocumentsSequence"],"0xA370":["SQ","1","ReferencedRequestSequence"],"0xA372":["SQ","1","PerformedProcedureCodeSequence"],"0xA375":["SQ","1","CurrentRequestedProcedureEvidenceSequenSequence"],"0xA385":["SQ","1","PertinentOtherEvidenceSequence"],"0xA491":["CS","1","CompletionFlag"],"0xA492":["LO","1","CompletionFlagDescription"],"0xA493":["CS","1","VerificationFlag"],"0xA504":["SQ","1","ContentTemplateSequence"],"0xA525":["SQ","1","IdenticalDocumentsSequence"],"0xA730":["SQ","1","ContentSequence"],"0xB020":["SQ","1","AnnotationSequence"],"0xDB00":["CS","1","TemplateIdentifier"],"0xDB06":["DT","1","TemplateVersion"],"0xDB07":["DT","1","TemplateLocalVersion"],"0xDB0B":["CS","1","TemplateExtensionFlag"],"0xDB0C":["UI","1","TemplateExtensionOrganizationUID"],"0xDB0D":["UI","1","TemplateExtensionCreatorUID"],"0xDB73":["UL","1-n","ReferencedContentItemIdentifier"]},"0x0050":{"0x0000":["UL","1","XRayAngioDeviceGroupLength"],"0x0004":["CS","1","CalibrationObject"],"0x0010":["SQ","1","DeviceSequence"],"0x0012":["CS","1","DeviceType"],"0x0014":["DS","1","DeviceLength"],"0x0016":["DS","1","DeviceDiameter"],"0x0017":["CS","1","DeviceDiameterUnits"],"0x0018":["DS","1","DeviceVolume"],"0x0019":["DS","1","InterMarkerDistance"],"0x0020":["LO","1","DeviceDescription"],"0x0030":["SQ","1","CodedInterventionalDeviceSequence"]},"0x0054":{"0x0000":["UL","1","NuclearMedicineGroupLength"],"0x0010":["US","1-n","EnergyWindowVector"],"0x0011":["US","1","NumberOfEnergyWindows"],"0x0012":["SQ","1","EnergyWindowInformationSequence"],"0x0013":["SQ","1","EnergyWindowRangeSequence"],"0x0014":["DS","1","EnergyWindowLowerLimit"],"0x0015":["DS","1","EnergyWindowUpperLimit"],"0x0016":["SQ","1","RadiopharmaceuticalInformationSequence"],"0x0017":["IS","1","ResidualSyringeCounts"],"0x0018":["SH","1","EnergyWindowName"],"0x0020":["US","1-n","DetectorVector"],"0x0021":["US","1","NumberOfDetectors"],"0x0022":["SQ","1","DetectorInformationSequence"],"0x0030":["US","1-n","PhaseVector"],"0x0031":["US","1","NumberOfPhases"],"0x0032":["SQ","1","PhaseInformationSequence"],"0x0033":["US","1","NumberOfFramesInPhase"],"0x0036":["IS","1","PhaseDelay"],"0x0038":["IS","1","PauseBetweenFrames"],"0x0050":["US","1-n","RotationVector"],"0x0051":["US","1","NumberOfRotations"],"0x0052":["SQ","1","RotationInformationSequence"],"0x0053":["US","1","NumberOfFramesInRotation"],"0x0060":["US","1-n","RRIntervalVector"],"0x0061":["US","1","NumberOfRRIntervals"],"0x0062":["SQ","1","GatedInformationSequence"],"0x0063":["SQ","1","DataInformationSequence"],"0x0070":["US","1-n","TimeSlotVector"],"0x0071":["US","1","NumberOfTimeSlots"],"0x0072":["SQ","1","TimeSlotInformationSequence"],"0x0073":["DS","1","TimeSlotTime"],"0x0080":["US","1-n","SliceVector"],"0x0081":["US","1","NumberOfSlices"],"0x0090":["US","1-n","AngularViewVector"],"0x0100":["US","1-n","TimeSliceVector"],"0x0101":["US","1","NumberOfTimeSlices"],"0x0200":["DS","1","StartAngle"],"0x0202":["CS","1","TypeOfDetectorMotion"],"0x0210":["IS","1-n","TriggerVector"],"0x0211":["US","1","NumberOfTriggersInPhase"],"0x0220":["SQ","1","ViewCodeSequence"],"0x0222":["SQ","1","ViewAngulationModifierCodeSequence"],"0x0300":["SQ","1","RadionuclideCodeSequence"],"0x0302":["SQ","1","AdministrationRouteCodeSequence"],"0x0304":["SQ","1","RadiopharmaceuticalCodeSequence"],"0x0306":["SQ","1","CalibrationDataSequence"],"0x0308":["US","1","EnergyWindowNumber"],"0x0400":["SH","1","ImageID"],"0x0410":["SQ","1","PatientOrientationCodeSequence"],"0x0412":["SQ","1","PatientOrientationModifierCodeSequence"],"0x0414":["SQ","1","PatientGantryRelationshipCodeSequence"],"0x1000":["CS","2","SeriesType"],"0x1001":["CS","1","Units"],"0x1002":["CS","1","CountsSource"],"0x1004":["CS","1","ReprojectionMethod"],"0x1100":["CS","1","RandomsCorrectionMethod"],"0x1101":["LO","1","AttenuationCorrectionMethod"],"0x1102":["CS","1","DecayCorrection"],"0x1103":["LO","1","ReconstructionMethod"],"0x1104":["LO","1","DetectorLinesOfResponseUsed"],"0x1105":["LO","1","ScatterCorrectionMethod"],"0x1200":["DS","1","AxialAcceptance"],"0x1201":["IS","2","AxialMash"],"0x1202":["IS","1","TransverseMash"],"0x1203":["DS","2","DetectorElementSize"],"0x1210":["DS","1","CoincidenceWindowWidth"],"0x1220":["CS","1-n","SecondaryCountsType"],"0x1300":["DS","1","FrameReferenceTime"],"0x1310":["IS","1","PrimaryPromptsCountsAccumulated"],"0x1311":["IS","1-n","SecondaryCountsAccumulated"],"0x1320":["DS","1","SliceSensitivityFactor"],"0x1321":["DS","1","DecayFactor"],"0x1322":["DS","1","DoseCalibrationFactor"],"0x1323":["DS","1","ScatterFractionFactor"],"0x1324":["DS","1","DeadTimeFactor"],"0x1330":["US","1","ImageIndex"],"0x1400":["CS","1-n","CountsIncluded"],"0x1401":["CS","1","DeadTimeCorrectionFlag"]},"0x0060":{"0x0000":["UL","1","HistogramGroupLength"],"0x3000":["SQ","1","HistogramSequence"],"0x3002":["US","1","HistogramNumberofBins"],"0x3004":["US/SS","1","HistogramFirstBinValue"],"0x3006":["US/SS","1","HistogramLastBinValue"],"0x3008":["US","1","HistogramBinWidth"],"0x3010":["LO","1","HistogramExplanation"],"0x3020":["UL","1-n","HistogramData"]},"0x0070":{"0x0001":["SQ","1","GraphicAnnotationSequence"],"0x0002":["CS","1","GraphicLayer"],"0x0003":["CS","1","BoundingBoxAnnotationUnits"],"0x0004":["CS","1","AnchorPointAnnotationUnits"],"0x0005":["CS","1","GraphicAnnotationUnits"],"0x0006":["ST","1","UnformattedTextValue"],"0x0008":["SQ","1","TextObjectSequence"],"0x0009":["SQ","1","GraphicObjectSequence"],"0x0010":["FL","2","BoundingBoxTopLeftHandCorner"],"0x0011":["FL","2","BoundingBoxBottomRightHandCorner"],"0x0012":["CS","1","BoundingBoxTextHorizontalJustification"],"0x0014":["FL","2","AnchorPoint"],"0x0015":["CS","1","AnchorPointVisibility"],"0x0020":["US","1","GraphicDimensions"],"0x0021":["US","1","NumberOfGraphicPoints"],"0x0022":["FL","2-n","GraphicData"],"0x0023":["CS","1","GraphicType"],"0x0024":["CS","1","GraphicFilled"],"0x0040":["IS","1","ImageRotationFrozenDraftRetired"],"0x0041":["CS","1","ImageHorizontalFlip"],"0x0042":["US","1","ImageRotation"],"0x0050":["US","2","DisplayedAreaTLHCFrozenDraftRetired"],"0x0051":["US","2","DisplayedAreaBRHCFrozenDraftRetired"],"0x0052":["SL","2","DisplayedAreaTopLeftHandCorner"],"0x0053":["SL","2","DisplayedAreaBottomRightHandCorner"],"0x005A":["SQ","1","DisplayedAreaSelectionSequence"],"0x0060":["SQ","1","GraphicLayerSequence"],"0x0062":["IS","1","GraphicLayerOrder"],"0x0066":["US","1","GraphicLayerRecommendedDisplayGrayscaleValue"],"0x0067":["US","3","GraphicLayerRecommendedDisplayRGBValue"],"0x0068":["LO","1","GraphicLayerDescription"],"0x0080":["CS","1","PresentationLabel"],"0x0081":["LO","1","PresentationDescription"],"0x0082":["DA","1","PresentationCreationDate"],"0x0083":["TM","1","PresentationCreationTime"],"0x0084":["PN","1","PresentationCreatorsName"],"0x0100":["CS","1","PresentationSizeMode"],"0x0101":["DS","2","PresentationPixelSpacing"],"0x0102":["IS","2","PresentationPixelAspectRatio"],"0x0103":["FL","1","PresentationPixelMagnificationRatio"]},"0x0088":{"0x0000":["UL","1","StorageGroupLength"],"0x0130":["SH","1","StorageMediaFilesetID"],"0x0140":["UI","1","StorageMediaFilesetUID"],"0x0200":["SQ","1","IconImage"],"0x0904":["LO","1","TopicTitle"],"0x0906":["ST","1","TopicSubject"],"0x0910":["LO","1","TopicAuthor"],"0x0912":["LO","3","TopicKeyWords"]},"0x1000":{"0x0000":["UL","1","CodeTableGroupLength"],"0x0010":["US","3","EscapeTriplet"],"0x0011":["US","3","RunLengthTriplet"],"0x0012":["US","1","HuffmanTableSize"],"0x0013":["US","3","HuffmanTableTriplet"],"0x0014":["US","1","ShiftTableSize"],"0x0015":["US","3","ShiftTableTriplet"]},"0x1010":{"0x0000":["UL","1","ZonalMapGroupLength"],"0x0004":["US","1-n","ZonalMap"]},"0x2000":{"0x0000":["UL","1","FilmSessionGroupLength"],"0x0010":["IS","1","NumberOfCopies"],"0x001E":["SQ","1","PrinterConfigurationSequence"],"0x0020":["CS","1","PrintPriority"],"0x0030":["CS","1","MediumType"],"0x0040":["CS","1","FilmDestination"],"0x0050":["LO","1","FilmSessionLabel"],"0x0060":["IS","1","MemoryAllocation"],"0x0061":["IS","1","MaximumMemoryAllocation"],"0x0062":["CS","1","ColorImagePrintingFlag"],"0x0063":["CS","1","CollationFlag"],"0x0065":["CS","1","AnnotationFlag"],"0x0067":["CS","1","ImageOverlayFlag"],"0x0069":["CS","1","PresentationLUTFlag"],"0x006A":["CS","1","ImageBoxPresentationLUTFlag"],"0x00A0":["US","1","MemoryBitDepth"],"0x00A1":["US","1","PrintingBitDepth"],"0x00A2":["SQ","1","MediaInstalledSequence"],"0x00A4":["SQ","1","OtherMediaAvailableSequence"],"0x00A8":["SQ","1","SupportedImageDisplayFormatsSequence"],"0x0500":["SQ","1","ReferencedFilmBoxSequence"],"0x0510":["SQ","1","ReferencedStoredPrintSequence"]},"0x2010":{"0x0000":["UL","1","FilmBoxGroupLength"],"0x0010":["ST","1","ImageDisplayFormat"],"0x0030":["CS","1","AnnotationDisplayFormatID"],"0x0040":["CS","1","FilmOrientation"],"0x0050":["CS","1","FilmSizeID"],"0x0052":["CS","1","PrinterResolutionID"],"0x0054":["CS","1","DefaultPrinterResolutionID"],"0x0060":["CS","1","MagnificationType"],"0x0080":["CS","1","SmoothingType"],"0x00A6":["CS","1","DefaultMagnificationType"],"0x00A7":["CS","1-n","OtherMagnificationTypesAvailable"],"0x00A8":["CS","1","DefaultSmoothingType"],"0x00A9":["CS","1-n","OtherSmoothingTypesAvailable"],"0x0100":["CS","1","BorderDensity"],"0x0110":["CS","1","EmptyImageDensity"],"0x0120":["US","1","MinDensity"],"0x0130":["US","1","MaxDensity"],"0x0140":["CS","1","Trim"],"0x0150":["ST","1","ConfigurationInformation"],"0x0152":["LT","1","ConfigurationInformationDescription"],"0x0154":["IS","1","MaximumCollatedFilms"],"0x015E":["US","1","Illumination"],"0x0160":["US","1","ReflectedAmbientLight"],"0x0376":["DS","2","PrinterPixelSpacing"],"0x0500":["SQ","1","ReferencedFilmSessionSequence"],"0x0510":["SQ","1","ReferencedImageBoxSequence"],"0x0520":["SQ","1","ReferencedBasicAnnotationBoxSequence"]},"0x2020":{"0x0000":["UL","1","ImageBoxGroupLength"],"0x0010":["US","1","ImageBoxPosition"],"0x0020":["CS","1","Polarity"],"0x0030":["DS","1","RequestedImageSize"],"0x0040":["CS","1","RequestedDecimateCropBehavior"],"0x0050":["CS","1","RequestedResolutionID"],"0x00A0":["CS","1","RequestedImageSizeFlag"],"0x00A2":["CS","1","DecimateCropResult"],"0x0110":["SQ","1","PreformattedGrayscaleImageSequence"],"0x0111":["SQ","1","PreformattedColorImageSequence"],"0x0130":["SQ","1","ReferencedImageOverlayBoxSequence"],"0x0140":["SQ","1","ReferencedVOILUTBoxSequence"]},"0x2030":{"0x0000":["UL","1","AnnotationGroupLength"],"0x0010":["US","1","AnnotationPosition"],"0x0020":["LO","1","TextString"]},"0x2040":{"0x0000":["UL","1","OverlayBoxGroupLength"],"0x0010":["SQ","1","ReferencedOverlayPlaneSequence"],"0x0011":["US","9","ReferencedOverlayPlaneGroups"],"0x0020":["SQ","1","OverlayPixelDataSequence"],"0x0060":["CS","1","OverlayMagnificationType"],"0x0070":["CS","1","OverlaySmoothingType"],"0x0072":["CS","1","OverlayOrImageMagnification"],"0x0074":["US","1","MagnifyToNumberOfColumns"],"0x0080":["CS","1","OverlayForegroundDensity"],"0x0082":["CS","1","OverlayBackgroundDensity"],"0x0090":["CS","1","OverlayMode"],"0x0100":["CS","1","ThresholdDensity"],"0x0500":["SQ","1","ReferencedOverlayImageBoxSequence"]},"0x2050":{"0x0000":["UL","1","PresentationLUTGroupLength"],"0x0010":["SQ","1","PresentationLUTSequence"],"0x0020":["CS","1","PresentationLUTShape"],"0x0500":["SQ","1","ReferencedPresentationLUTSequence"]},"0x2100":{"0x0000":["UL","1","PrintJobGroupLength"],"0x0010":["SH","1","PrintJobID"],"0x0020":["CS","1","ExecutionStatus"],"0x0030":["CS","1","ExecutionStatusInfo"],"0x0040":["DA","1","CreationDate"],"0x0050":["TM","1","CreationTime"],"0x0070":["AE","1","Originator"],"0x0140":["AE","1","DestinationAE"],"0x0160":["SH","1","OwnerID"],"0x0170":["IS","1","NumberOfFilms"],"0x0500":["SQ","1","ReferencedPrintJobSequence"]},"0x2110":{"0x0000":["UL","1","PrinterGroupLength"],"0x0010":["CS","1","PrinterStatus"],"0x0020":["CS","1","PrinterStatusInfo"],"0x0030":["LO","1","PrinterName"],"0x0099":["SH","1","PrintQueueID"]},"0x2120":{"0x0000":["UL","1","QueueGroupLength"],"0x0010":["CS","1","QueueStatus"],"0x0050":["SQ","1","PrintJobDescriptionSequence"],"0x0070":["SQ","1","QueueReferencedPrintJobSequence"]},"0x2130":{"0x0000":["UL","1","PrintContentGroupLength"],"0x0010":["SQ","1","PrintManagementCapabilitiesSequence"],"0x0015":["SQ","1","PrinterCharacteristicsSequence"],"0x0030":["SQ","1","FilmBoxContentSequence"],"0x0040":["SQ","1","ImageBoxContentSequence"],"0x0050":["SQ","1","AnnotationContentSequence"],"0x0060":["SQ","1","ImageOverlayBoxContentSequence"],"0x0080":["SQ","1","PresentationLUTContentSequence"],"0x00A0":["SQ","1","ProposedStudySequence"],"0x00C0":["SQ","1","OriginalImageSequence"]},"0x3002":{"0x0000":["UL","1","RTImageGroupLength"],"0x0002":["SH","1","RTImageLabel"],"0x0003":["LO","1","RTImageName"],"0x0004":["ST","1","RTImageDescription"],"0x000A":["CS","1","ReportedValuesOrigin"],"0x000C":["CS","1","RTImagePlane"],"0x000D":["DS","3","XRayImageReceptorTranslation"],"0x000E":["DS","1","XRayImageReceptorAngle"],"0x0010":["DS","6","RTImageOrientation"],"0x0011":["DS","2","ImagePlanePixelSpacing"],"0x0012":["DS","2","RTImagePosition"],"0x0020":["SH","1","RadiationMachineName"],"0x0022":["DS","1","RadiationMachineSAD"],"0x0024":["DS","1","RadiationMachineSSD"],"0x0026":["DS","1","RTImageSID"],"0x0028":["DS","1","SourceToReferenceObjectDistance"],"0x0029":["IS","1","FractionNumber"],"0x0030":["SQ","1","ExposureSequence"],"0x0032":["DS","1","MetersetExposure"],"0x0034":["DS","4","DiaphragmPosition"]},"0x3004":{"0x0000":["UL","1","RTDoseGroupLength"],"0x0001":["CS","1","DVHType"],"0x0002":["CS","1","DoseUnits"],"0x0004":["CS","1","DoseType"],"0x0006":["LO","1","DoseComment"],"0x0008":["DS","3","NormalizationPoint"],"0x000A":["CS","1","DoseSummationType"],"0x000C":["DS","2-n","GridFrameOffsetVector"],"0x000E":["DS","1","DoseGridScaling"],"0x0010":["SQ","1","RTDoseROISequence"],"0x0012":["DS","1","DoseValue"],"0x0040":["DS","3","DVHNormalizationPoint"],"0x0042":["DS","1","DVHNormalizationDoseValue"],"0x0050":["SQ","1","DVHSequence"],"0x0052":["DS","1","DVHDoseScaling"],"0x0054":["CS","1","DVHVolumeUnits"],"0x0056":["IS","1","DVHNumberOfBins"],"0x0058":["DS","2-2n","DVHData"],"0x0060":["SQ","1","DVHReferencedROISequence"],"0x0062":["CS","1","DVHROIContributionType"],"0x0070":["DS","1","DVHMinimumDose"],"0x0072":["DS","1","DVHMaximumDose"],"0x0074":["DS","1","DVHMeanDose"]},"0x3006":{"0x0000":["UL","1","RTStructureSetGroupLength"],"0x0002":["SH","1","StructureSetLabel"],"0x0004":["LO","1","StructureSetName"],"0x0006":["ST","1","StructureSetDescription"],"0x0008":["DA","1","StructureSetDate"],"0x0009":["TM","1","StructureSetTime"],"0x0010":["SQ","1","ReferencedFrameOfReferenceSequence"],"0x0012":["SQ","1","RTReferencedStudySequence"],"0x0014":["SQ","1","RTReferencedSeriesSequence"],"0x0016":["SQ","1","ContourImageSequence"],"0x0020":["SQ","1","StructureSetROISequence"],"0x0022":["IS","1","ROINumber"],"0x0024":["UI","1","ReferencedFrameOfReferenceUID"],"0x0026":["LO","1","ROIName"],"0x0028":["ST","1","ROIDescription"],"0x002A":["IS","3","ROIDisplayColor"],"0x002C":["DS","1","ROIVolume"],"0x0030":["SQ","1","RTRelatedROISequence"],"0x0033":["CS","1","RTROIRelationship"],"0x0036":["CS","1","ROIGenerationAlgorithm"],"0x0038":["LO","1","ROIGenerationDescription"],"0x0039":["SQ","1","ROIContourSequence"],"0x0040":["SQ","1","ContourSequence"],"0x0042":["CS","1","ContourGeometricType"],"0x0044":["DS","1","ContourSlabThickness"],"0x0045":["DS","3","ContourOffsetVector"],"0x0046":["IS","1","NumberOfContourPoints"],"0x0048":["IS","1","ContourNumber"],"0x0049":["IS","1-n","AttachedContours"],"0x0050":["DS","3-3n","ContourData"],"0x0080":["SQ","1","RTROIObservationsSequence"],"0x0082":["IS","1","ObservationNumber"],"0x0084":["IS","1","ReferencedROINumber"],"0x0085":["SH","1","ROIObservationLabel"],"0x0086":["SQ","1","RTROIIdentificationCodeSequence"],"0x0088":["ST","1","ROIObservationDescription"],"0x00A0":["SQ","1","RelatedRTROIObservationsSequence"],"0x00A4":["CS","1","RTROIInterpretedType"],"0x00A6":["PN","1","ROIInterpreter"],"0x00B0":["SQ","1","ROIPhysicalPropertiesSequence"],"0x00B2":["CS","1","ROIPhysicalProperty"],"0x00B4":["DS","1","ROIPhysicalPropertyValue"],"0x00C0":["SQ","1","FrameOfReferenceRelationshipSequence"],"0x00C2":["UI","1","RelatedFrameOfReferenceUID"],"0x00C4":["CS","1","FrameOfReferenceTransformationType"],"0x00C6":["DS","16","FrameOfReferenceTransformationMatrix"],"0x00C8":["LO","1","FrameOfReferenceTransformationComment"]},"0x3008":{"0x0010":["SQ","1","MeasuredDoseReferenceSequence"],"0x0012":["ST","1","MeasuredDoseDescription"],"0x0014":["CS","1","MeasuredDoseType"],"0x0016":["DS","1","MeasuredDoseValue"],"0x0020":["SQ","1","TreatmentSessionBeamSequence"],"0x0022":["IS","1","CurrentFractionNumber"],"0x0024":["DA","1","TreatmentControlPointDate"],"0x0025":["TM","1","TreatmentControlPointTime"],"0x002A":["CS","1","TreatmentTerminationStatus"],"0x002B":["SH","1","TreatmentTerminationCode"],"0x002C":["CS","1","TreatmentVerificationStatus"],"0x0030":["SQ","1","ReferencedTreatmentRecordSequence"],"0x0032":["DS","1","SpecifiedPrimaryMeterset"],"0x0033":["DS","1","SpecifiedSecondaryMeterset"],"0x0036":["DS","1","DeliveredPrimaryMeterset"],"0x0037":["DS","1","DeliveredSecondaryMeterset"],"0x003A":["DS","1","SpecifiedTreatmentTime"],"0x003B":["DS","1","DeliveredTreatmentTime"],"0x0040":["SQ","1","ControlPointDeliverySequence"],"0x0042":["DS","1","SpecifiedMeterset"],"0x0044":["DS","1","DeliveredMeterset"],"0x0048":["DS","1","DoseRateDelivered"],"0x0050":["SQ","1","TreatmentSummaryCalculatedDoseReferenceSequence"],"0x0052":["DS","1","CumulativeDosetoDoseReference"],"0x0054":["DA","1","FirstTreatmentDate"],"0x0056":["DA","1","MostRecentTreatmentDate"],"0x005A":["IS","1","NumberofFractionsDelivered"],"0x0060":["SQ","1","OverrideSequence"],"0x0062":["AT","1","OverrideParameterPointer"],"0x0064":["IS","1","MeasuredDoseReferenceNumber"],"0x0066":["ST","1","OverrideReason"],"0x0070":["SQ","1","CalculatedDoseReferenceSequence"],"0x0072":["IS","1","CalculatedDoseReferenceNumber"],"0x0074":["ST","1","CalculatedDoseReferenceDescription"],"0x0076":["DS","1","CalculatedDoseReferenceDoseValue"],"0x0078":["DS","1","StartMeterset"],"0x007A":["DS","1","EndMeterset"],"0x0080":["SQ","1","ReferencedMeasuredDoseReferenceSequence"],"0x0082":["IS","1","ReferencedMeasuredDoseReferenceNumber"],"0x0090":["SQ","1","ReferencedCalculatedDoseReferenceSequence"],"0x0092":["IS","1","ReferencedCalculatedDoseReferenceNumber"],"0x00A0":["SQ","1","BeamLimitingDeviceLeafPairsSequence"],"0x00B0":["SQ","1","RecordedWedgeSequence"],"0x00C0":["SQ","1","RecordedCompensatorSequence"],"0x00D0":["SQ","1","RecordedBlockSequence"],"0x00E0":["SQ","1","TreatmentSummaryMeasuredDoseReferenceSequence"],"0x0100":["SQ","1","RecordedSourceSequence"],"0x0105":["LO","1","SourceSerialNumber"],"0x0110":["SQ","1","TreatmentSessionApplicationSetupSequence"],"0x0116":["CS","1","ApplicationSetupCheck"],"0x0120":["SQ","1","RecordedBrachyAccessoryDeviceSequence"],"0x0122":["IS","1","ReferencedBrachyAccessoryDeviceNumber"],"0x0130":["SQ","1","RecordedChannelSequence"],"0x0132":["DS","1","SpecifiedChannelTotalTime"],"0x0134":["DS","1","DeliveredChannelTotalTime"],"0x0136":["IS","1","SpecifiedNumberofPulses"],"0x0138":["IS","1","DeliveredNumberofPulses"],"0x013A":["DS","1","SpecifiedPulseRepetitionInterval"],"0x013C":["DS","1","DeliveredPulseRepetitionInterval"],"0x0140":["SQ","1","RecordedSourceApplicatorSequence"],"0x0142":["IS","1","ReferencedSourceApplicatorNumber"],"0x0150":["SQ","1","RecordedChannelShieldSequence"],"0x0152":["IS","1","ReferencedChannelShieldNumber"],"0x0160":["SQ","1","BrachyControlPointDeliveredSequence"],"0x0162":["DA","1","SafePositionExitDate"],"0x0164":["TM","1","SafePositionExitTime"],"0x0166":["DA","1","SafePositionReturnDate"],"0x0168":["TM","1","SafePositionReturnTime"],"0x0200":["CS","1","CurrentTreatmentStatus"],"0x0202":["ST","1","TreatmentStatusComment"],"0x0220":["SQ","1","FractionGroupSummarySequence"],"0x0223":["IS","1","ReferencedFractionNumber"],"0x0224":["CS","1","FractionGroupType"],"0x0230":["CS","1","BeamStopperPosition"],"0x0240":["SQ","1","FractionStatusSummarySequence"],"0x0250":["DA","1","TreatmentDate"],"0x0251":["TM","1","TreatmentTime"]},"0x300A":{"0x0000":["UL","1","RTPlanGroupLength"],"0x0002":["SH","1","RTPlanLabel"],"0x0003":["LO","1","RTPlanName"],"0x0004":["ST","1","RTPlanDescription"],"0x0006":["DA","1","RTPlanDate"],"0x0007":["TM","1","RTPlanTime"],"0x0009":["LO","1-n","TreatmentProtocols"],"0x000A":["CS","1","TreatmentIntent"],"0x000B":["LO","1-n","TreatmentSites"],"0x000C":["CS","1","RTPlanGeometry"],"0x000E":["ST","1","PrescriptionDescription"],"0x0010":["SQ","1","DoseReferenceSequence"],"0x0012":["IS","1","DoseReferenceNumber"],"0x0014":["CS","1","DoseReferenceStructureType"],"0x0015":["CS","1","NominalBeamEnergyUnit"],"0x0016":["LO","1","DoseReferenceDescription"],"0x0018":["DS","3","DoseReferencePointCoordinates"],"0x001A":["DS","1","NominalPriorDose"],"0x0020":["CS","1","DoseReferenceType"],"0x0021":["DS","1","ConstraintWeight"],"0x0022":["DS","1","DeliveryWarningDose"],"0x0023":["DS","1","DeliveryMaximumDose"],"0x0025":["DS","1","TargetMinimumDose"],"0x0026":["DS","1","TargetPrescriptionDose"],"0x0027":["DS","1","TargetMaximumDose"],"0x0028":["DS","1","TargetUnderdoseVolumeFraction"],"0x002A":["DS","1","OrganAtRiskFullVolumeDose"],"0x002B":["DS","1","OrganAtRiskLimitDose"],"0x002C":["DS","1","OrganAtRiskMaximumDose"],"0x002D":["DS","1","OrganAtRiskOverdoseVolumeFraction"],"0x0040":["SQ","1","ToleranceTableSequence"],"0x0042":["IS","1","ToleranceTableNumber"],"0x0043":["SH","1","ToleranceTableLabel"],"0x0044":["DS","1","GantryAngleTolerance"],"0x0046":["DS","1","BeamLimitingDeviceAngleTolerance"],"0x0048":["SQ","1","BeamLimitingDeviceToleranceSequence"],"0x004A":["DS","1","BeamLimitingDevicePositionTolerance"],"0x004C":["DS","1","PatientSupportAngleTolerance"],"0x004E":["DS","1","TableTopEccentricAngleTolerance"],"0x0051":["DS","1","TableTopVerticalPositionTolerance"],"0x0052":["DS","1","TableTopLongitudinalPositionTolerance"],"0x0053":["DS","1","TableTopLateralPositionTolerance"],"0x0055":["CS","1","RTPlanRelationship"],"0x0070":["SQ","1","FractionGroupSequence"],"0x0071":["IS","1","FractionGroupNumber"],"0x0078":["IS","1","NumberOfFractionsPlanned"],"0x0079":["IS","1","NumberOfFractionsPatternDigistsPerDay"],"0x007A":["IS","1","RepeatFractionCycleLength"],"0x007B":["LT","1","FractionPattern"],"0x0080":["IS","1","NumberOfBeams"],"0x0082":["DS","3","BeamDoseSpecificationPoint"],"0x0084":["DS","1","BeamDose"],"0x0086":["DS","1","BeamMeterset"],"0x00A0":["IS","1","NumberOfBrachyApplicationSetups"],"0x00A2":["DS","3","BrachyApplicationSetupDoseSpecificationPoint"],"0x00A4":["DS","1","BrachyApplicationSetupDose"],"0x00B0":["SQ","1","BeamSequence"],"0x00B2":["SH","1","TreatmentMachineName"],"0x00B3":["CS","1","PrimaryDosimeterUnit"],"0x00B4":["DS","1","SourceAxisDistance"],"0x00B6":["SQ","1","BeamLimitingDeviceSequence"],"0x00B8":["CS","1","RTBeamLimitingDeviceType"],"0x00BA":["DS","1","SourceToBeamLimitingDeviceDistance"],"0x00BC":["IS","1","NumberOfLeafJawPairs"],"0x00BE":["DS","3-n","LeafPositionBoundaries"],"0x00C0":["IS","1","BeamNumber"],"0x00C2":["LO","1","BeamName"],"0x00C3":["ST","1","BeamDescription"],"0x00C4":["CS","1","BeamType"],"0x00C6":["CS","1","RadiationType"],"0x00C8":["IS","1","ReferenceImageNumber"],"0x00CA":["SQ","1","PlannedVerificationImageSequence"],"0x00CC":["LO","1-n","ImagingDeviceSpecificAcquisitionParameters"],"0x00CE":["CS","1","TreatmentDeliveryType"],"0x00D0":["IS","1","NumberOfWedges"],"0x00D1":["SQ","1","WedgeSequence"],"0x00D2":["IS","1","WedgeNumber"],"0x00D3":["CS","1","WedgeType"],"0x00D4":["SH","1","WedgeID"],"0x00D5":["IS","1","WedgeAngle"],"0x00D6":["DS","1","WedgeFactor"],"0x00D8":["DS","1","WedgeOrientation"],"0x00DA":["DS","1","SourceToWedgeTrayDistance"],"0x00E0":["IS","1","NumberOfCompensators"],"0x00E1":["SH","1","MaterialID"],"0x00E2":["DS","1","TotalCompensatorTrayFactor"],"0x00E3":["SQ","1","CompensatorSequence"],"0x00E4":["IS","1","CompensatorNumber"],"0x00E5":["SH","1","CompensatorID"],"0x00E6":["DS","1","SourceToCompensatorTrayDistance"],"0x00E7":["IS","1","CompensatorRows"],"0x00E8":["IS","1","CompensatorColumns"],"0x00E9":["DS","2","CompensatorPixelSpacing"],"0x00EA":["DS","2","CompensatorPosition"],"0x00EB":["DS","1-n","CompensatorTransmissionData"],"0x00EC":["DS","1-n","CompensatorThicknessData"],"0x00ED":["IS","1","NumberOfBoli"],"0x00EE":["CS","1","CompensatorType"],"0x00F0":["IS","1","NumberOfBlocks"],"0x00F2":["DS","1","TotalBlockTrayFactor"],"0x00F4":["SQ","1","BlockSequence"],"0x00F5":["SH","1","BlockTrayID"],"0x00F6":["DS","1","SourceToBlockTrayDistance"],"0x00F8":["CS","1","BlockType"],"0x00FA":["CS","1","BlockDivergence"],"0x00FC":["IS","1","BlockNumber"],"0x00FE":["LO","1","BlockName"],"0x0100":["DS","1","BlockThickness"],"0x0102":["DS","1","BlockTransmission"],"0x0104":["IS","1","BlockNumberOfPoints"],"0x0106":["DS","2-2n","BlockData"],"0x0107":["SQ","1","ApplicatorSequence"],"0x0108":["SH","1","ApplicatorID"],"0x0109":["CS","1","ApplicatorType"],"0x010A":["LO","1","ApplicatorDescription"],"0x010C":["DS","1","CumulativeDoseReferenceCoefficient"],"0x010E":["DS","1","FinalCumulativeMetersetWeight"],"0x0110":["IS","1","NumberOfControlPoints"],"0x0111":["SQ","1","ControlPointSequence"],"0x0112":["IS","1","ControlPointIndex"],"0x0114":["DS","1","NominalBeamEnergy"],"0x0115":["DS","1","DoseRateSet"],"0x0116":["SQ","1","WedgePositionSequence"],"0x0118":["CS","1","WedgePosition"],"0x011A":["SQ","1","BeamLimitingDevicePositionSequence"],"0x011C":["DS","2-2n","LeafJawPositions"],"0x011E":["DS","1","GantryAngle"],"0x011F":["CS","1","GantryRotationDirection"],"0x0120":["DS","1","BeamLimitingDeviceAngle"],"0x0121":["CS","1","BeamLimitingDeviceRotationDirection"],"0x0122":["DS","1","PatientSupportAngle"],"0x0123":["CS","1","PatientSupportRotationDirection"],"0x0124":["DS","1","TableTopEccentricAxisDistance"],"0x0125":["DS","1","TableTopEccentricAngle"],"0x0126":["CS","1","TableTopEccentricRotationDirection"],"0x0128":["DS","1","TableTopVerticalPosition"],"0x0129":["DS","1","TableTopLongitudinalPosition"],"0x012A":["DS","1","TableTopLateralPosition"],"0x012C":["DS","3","IsocenterPosition"],"0x012E":["DS","3","SurfaceEntryPoint"],"0x0130":["DS","1","SourceToSurfaceDistance"],"0x0134":["DS","1","CumulativeMetersetWeight"],"0x0140":["FL","1","TableTopPitchAngle"],"0x0142":["CS","1","TableTopPitchRotationDirection"],"0x0144":["FL","1","TableTopRollAngle"],"0x0146":["CS","1","TableTopRollRotationDirection"],"0x0148":["FL","1","HeadFixationAngle"],"0x014A":["FL","1","GantryPitchAngle"],"0x014C":["CS","1","GantryPitchRotationDirection"],"0x014E":["FL","1","GantryPitchAngleTolerance"],"0x0180":["SQ","1","PatientSetupSequence"],"0x0182":["IS","1","PatientSetupNumber"],"0x0184":["LO","1","PatientAdditionalPosition"],"0x0190":["SQ","1","FixationDeviceSequence"],"0x0192":["CS","1","FixationDeviceType"],"0x0194":["SH","1","FixationDeviceLabel"],"0x0196":["ST","1","FixationDeviceDescription"],"0x0198":["SH","1","FixationDevicePosition"],"0x01A0":["SQ","1","ShieldingDeviceSequence"],"0x01A2":["CS","1","ShieldingDeviceType"],"0x01A4":["SH","1","ShieldingDeviceLabel"],"0x01A6":["ST","1","ShieldingDeviceDescription"],"0x01A8":["SH","1","ShieldingDevicePosition"],"0x01B0":["CS","1","SetupTechnique"],"0x01B2":["ST","1","SetupTechniqueDescription"],"0x01B4":["SQ","1","SetupDeviceSequence"],"0x01B6":["CS","1","SetupDeviceType"],"0x01B8":["SH","1","SetupDeviceLabel"],"0x01BA":["ST","1","SetupDeviceDescription"],"0x01BC":["DS","1","SetupDeviceParameter"],"0x01D0":["ST","1","SetupReferenceDescription"],"0x01D2":["DS","1","TableTopVerticalSetupDisplacement"],"0x01D4":["DS","1","TableTopLongitudinalSetupDisplacement"],"0x01D6":["DS","1","TableTopLateralSetupDisplacement"],"0x0200":["CS","1","BrachyTreatmentTechnique"],"0x0202":["CS","1","BrachyTreatmentType"],"0x0206":["SQ","1","TreatmentMachineSequence"],"0x0210":["SQ","1","SourceSequence"],"0x0212":["IS","1","SourceNumber"],"0x0214":["CS","1","SourceType"],"0x0216":["LO","1","SourceManufacturer"],"0x0218":["DS","1","ActiveSourceDiameter"],"0x021A":["DS","1","ActiveSourceLength"],"0x0222":["DS","1","SourceEncapsulationNominalThickness"],"0x0224":["DS","1","SourceEncapsulationNominalTransmission"],"0x0226":["LO","1","SourceIsotopeName"],"0x0228":["DS","1","SourceIsotopeHalfLife"],"0x022A":["DS","1","ReferenceAirKermaRate"],"0x022C":["DA","1","AirKermaRateReferenceDate"],"0x022E":["TM","1","AirKermaRateReferenceTime"],"0x0230":["SQ","1","ApplicationSetupSequence"],"0x0232":["CS","1","ApplicationSetupType"],"0x0234":["IS","1","ApplicationSetupNumber"],"0x0236":["LO","1","ApplicationSetupName"],"0x0238":["LO","1","ApplicationSetupManufacturer"],"0x0240":["IS","1","TemplateNumber"],"0x0242":["SH","1","TemplateType"],"0x0244":["LO","1","TemplateName"],"0x0250":["DS","1","TotalReferenceAirKerma"],"0x0260":["SQ","1","BrachyAccessoryDeviceSequence"],"0x0262":["IS","1","BrachyAccessoryDeviceNumber"],"0x0263":["SH","1","BrachyAccessoryDeviceID"],"0x0264":["CS","1","BrachyAccessoryDeviceType"],"0x0266":["LO","1","BrachyAccessoryDeviceName"],"0x026A":["DS","1","BrachyAccessoryDeviceNominalThickness"],"0x026C":["DS","1","BrachyAccessoryDeviceNominalTransmission"],"0x0280":["SQ","1","ChannelSequence"],"0x0282":["IS","1","ChannelNumber"],"0x0284":["DS","1","ChannelLength"],"0x0286":["DS","1","ChannelTotalTime"],"0x0288":["CS","1","SourceMovementType"],"0x028A":["IS","1","NumberOfPulses"],"0x028C":["DS","1","PulseRepetitionInterval"],"0x0290":["IS","1","SourceApplicatorNumber"],"0x0291":["SH","1","SourceApplicatorID"],"0x0292":["CS","1","SourceApplicatorType"],"0x0294":["LO","1","SourceApplicatorName"],"0x0296":["DS","1","SourceApplicatorLength"],"0x0298":["LO","1","SourceApplicatorManufacturer"],"0x029C":["DS","1","SourceApplicatorWallNominalThickness"],"0x029E":["DS","1","SourceApplicatorWallNominalTransmission"],"0x02A0":["DS","1","SourceApplicatorStepSize"],"0x02A2":["IS","1","TransferTubeNumber"],"0x02A4":["DS","1","TransferTubeLength"],"0x02B0":["SQ","1","ChannelShieldSequence"],"0x02B2":["IS","1","ChannelShieldNumber"],"0x02B3":["SH","1","ChannelShieldID"],"0x02B4":["LO","1","ChannelShieldName"],"0x02B8":["DS","1","ChannelShieldNominalThickness"],"0x02BA":["DS","1","ChannelShieldNominalTransmission"],"0x02C8":["DS","1","FinalCumulativeTimeWeight"],"0x02D0":["SQ","1","BrachyControlPointSequence"],"0x02D2":["DS","1","ControlPointRelativePosition"],"0x02D4":["DS","3","ControlPointDPosition"],"0x02D6":["DS","1","CumulativeTimeWeight"]},"0x300C":{"0x0000":["UL","1","RTRelationshipGroupLength"],"0x0002":["SQ","1","ReferencedRTPlanSequence"],"0x0004":["SQ","1","ReferencedBeamSequence"],"0x0006":["IS","1","ReferencedBeamNumber"],"0x0007":["IS","1","ReferencedReferenceImageNumber"],"0x0008":["DS","1","StartCumulativeMetersetWeight"],"0x0009":["DS","1","EndCumulativeMetersetWeight"],"0x000A":["SQ","1","ReferencedBrachyApplicationSetupSequence"],"0x000C":["IS","1","ReferencedBrachyApplicationSetupNumber"],"0x000E":["IS","1","ReferencedSourceNumber"],"0x0020":["SQ","1","ReferencedFractionGroupSequence"],"0x0022":["IS","1","ReferencedFractionGroupNumber"],"0x0040":["SQ","1","ReferencedVerificationImageSequence"],"0x0042":["SQ","1","ReferencedReferenceImageSequence"],"0x0050":["SQ","1","ReferencedDoseReferenceSequence"],"0x0051":["IS","1","ReferencedDoseReferenceNumber"],"0x0055":["SQ","1","BrachyReferencedDoseReferenceSequence"],"0x0060":["SQ","1","ReferencedStructureSetSequence"],"0x006A":["IS","1","ReferencedPatientSetupNumber"],"0x0080":["SQ","1","ReferencedDoseSequence"],"0x00A0":["IS","1","ReferencedToleranceTableNumber"],"0x00B0":["SQ","1","ReferencedBolusSequence"],"0x00C0":["IS","1","ReferencedWedgeNumber"],"0x00D0":["IS","1","ReferencedCompensatorNumber"],"0x00E0":["IS","1","ReferencedBlockNumber"],"0x00F0":["IS","1","ReferencedControlPointIndex"]},"0x300E":{"0x0000":["UL","1","RTApprovalGroupLength"],"0x0002":["CS","1","ApprovalStatus"],"0x0004":["DA","1","ReviewDate"],"0x0005":["TM","1","ReviewTime"],"0x0008":["PN","1","ReviewerName"]},"0x4000":{"0x0000":["UL","1","TextGroupLength"],"0x0010":["LT","1-n","TextArbitrary"],"0x4000":["LT","1-n","TextComments"]},"0x4008":{"0x0000":["UL","1","ResultsGroupLength"],"0x0040":["SH","1","ResultsID"],"0x0042":["LO","1","ResultsIDIssuer"],"0x0050":["SQ","1","ReferencedInterpretationSequence"],"0x0100":["DA","1","InterpretationRecordedDate"],"0x0101":["TM","1","InterpretationRecordedTime"],"0x0102":["PN","1","InterpretationRecorder"],"0x0103":["LO","1","ReferenceToRecordedSound"],"0x0108":["DA","1","InterpretationTranscriptionDate"],"0x0109":["TM","1","InterpretationTranscriptionTime"],"0x010A":["PN","1","InterpretationTranscriber"],"0x010B":["ST","1","InterpretationText"],"0x010C":["PN","1","InterpretationAuthor"],"0x0111":["SQ","1","InterpretationApproverSequence"],"0x0112":["DA","1","InterpretationApprovalDate"],"0x0113":["TM","1","InterpretationApprovalTime"],"0x0114":["PN","1","PhysicianApprovingInterpretation"],"0x0115":["LT","1","InterpretationDiagnosisDescription"],"0x0117":["SQ","1","DiagnosisCodeSequence"],"0x0118":["SQ","1","ResultsDistributionListSequence"],"0x0119":["PN","1","DistributionName"],"0x011A":["LO","1","DistributionAddress"],"0x0200":["SH","1","InterpretationID"],"0x0202":["LO","1","InterpretationIDIssuer"],"0x0210":["CS","1","InterpretationTypeID"],"0x0212":["CS","1","InterpretationStatusID"],"0x0300":["ST","1","Impressions"],"0x4000":["ST","1","ResultsComments"]},"0x5000":{"0x0000":["UL","1","CurveGroupLength"],"0x0005":["US","1","CurveDimensions"],"0x0010":["US","1","NumberOfPoints"],"0x0020":["CS","1","TypeOfData"],"0x0022":["LO","1","CurveDescription"],"0x0030":["SH","1-n","AxisUnits"],"0x0040":["SH","1-n","AxisLabels"],"0x0103":["US","1","DataValueRepresentation"],"0x0104":["US","1-n","MinimumCoordinateValue"],"0x0105":["US","1-n","MaximumCoordinateValue"],"0x0106":["SH","1-n","CurveRange"],"0x0110":["US","1","CurveDataDescriptor"],"0x0112":["US","1","CoordinateStartValue"],"0x0114":["US","1","CoordinateStepValue"],"0x2000":["US","1","AudioType"],"0x2002":["US","1","AudioSampleFormat"],"0x2004":["US","1","NumberOfChannels"],"0x2006":["UL","1","NumberOfSamples"],"0x2008":["UL","1","SampleRate"],"0x200A":["UL","1","TotalTime"],"0x200C":["OX","1","AudioSampleData"],"0x200E":["LT","1","AudioComments"],"0x3000":["OX","1","CurveData"]},"0x5400":{"0x0100":["SQ","1","WaveformSequence"],"0x0110":["OW/OB","1","ChannelMinimumValue"],"0x0112":["OW/OB","1","ChannelMaximumValue"],"0x1004":["US","1","WaveformBitsAllocated"],"0x1006":["CS","1","WaveformSampleInterpretation"],"0x100A":["OW/OB","1","WaveformPaddingValue"],"0x1010":["OW/OB","1","WaveformData"]},"0x6000":{"0x0000":["UL","1","OverlayGroupLength"],"0x0010":["US","1","OverlayRows"],"0x0011":["US","1","OverlayColumns"],"0x0012":["US","1","OverlayPlanes"],"0x0015":["IS","1","OverlayNumberOfFrames"],"0x0040":["CS","1","OverlayType"],"0x0050":["SS","2","OverlayOrigin"],"0x0051":["US","1","OverlayImageFrameOrigin"],"0x0052":["US","1","OverlayPlaneOrigin"],"0x0060":["CS","1","OverlayCompressionCode"],"0x0061":["SH","1","OverlayCompressionOriginator"],"0x0062":["SH","1","OverlayCompressionLabel"],"0x0063":["SH","1","OverlayCompressionDescription"],"0x0066":["AT","1-n","OverlayCompressionStepPointers"],"0x0068":["US","1","OverlayRepeatInterval"],"0x0069":["US","1","OverlayBitsGrouped"],"0x0100":["US","1","OverlayBitsAllocated"],"0x0102":["US","1","OverlayBitPosition"],"0x0110":["CS","1","OverlayFormat"],"0x0200":["US","1","OverlayLocation"],"0x0800":["CS","1-n","OverlayCodeLabel"],"0x0802":["US","1","OverlayNumberOfTables"],"0x0803":["AT","1-n","OverlayCodeTableLocation"],"0x0804":["US","1","OverlayBitsForCodeWord"],"0x1100":["US","1","OverlayDescriptorGray"],"0x1101":["US","1","OverlayDescriptorRed"],"0x1102":["US","1","OverlayDescriptorGreen"],"0x1103":["US","1","OverlayDescriptorBlue"],"0x1200":["US","1-n","OverlayGray"],"0x1201":["US","1-n","OverlayRed"],"0x1202":["US","1-n","OverlayGreen"],"0x1203":["US","1-n","OverlayBlue"],"0x1301":["IS","1","ROIArea"],"0x1302":["DS","1","ROIMean"],"0x1303":["DS","1","ROIStandardDeviation"],"0x3000":["OW","1","OverlayData"],"0x4000":["LT","1-n","OverlayComments"]},"0x7F00":{"0x0000":["UL","1","VariablePixelDataGroupLength"],"0x0010":["OX","1","VariablePixelData"],"0x0011":["AT","1","VariableNextDataGroup"],"0x0020":["OW","1-n","VariableCoefficientsSDVN"],"0x0030":["OW","1-n","VariableCoefficientsSDHN"],"0x0040":["OW","1-n","VariableCoefficientsSDDN"]},"0x7FE0":{"0x0000":["UL","1","PixelDataGroupLength"],"0x0010":["OX","1","PixelData"],"0x0020":["OW","1-n","CoefficientsSDVN"],"0x0030":["OW","1-n","CoefficientsSDHN"],"0x0040":["OW","1-n","CoefficientsSDDN"]},"0xFFFC":{"0xFFFC":["OB","1","DataSetTrailingPadding"]},"0xFFFE":{"0xE000":["NONE","1","Item"],"0xE00D":["NONE","1","ItemDelimitationItem"],"0xE0DD":["NONE","1","SequenceDelimitationItem"]}};
var dwv=dwv||{};dwv.browser=dwv.browser||{},dwv.browser.hasFileApi=function(){var a=-1!==navigator.appVersion.indexOf("Safari")&&-1===navigator.appVersion.indexOf("Chrome")&&(-1!==navigator.appVersion.indexOf("5.0.")||-1!==navigator.appVersion.indexOf("5.1."));return a?(console.warn("Assuming FileAPI support for Safari5..."),!0):"FileReader"in window},dwv.browser.hasXmlHttpRequest=function(){return"XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest},dwv.browser.hasTypedArray=function(){return"Uint8Array"in window&&"Uint16Array"in window},dwv.browser.hasClampedArray=function(){return"Uint8ClampedArray"in window},dwv.browser.check=function(){var a="The application cannot be run.",b="";if(!dwv.browser.hasFileApi())throw b="The File APIs are not supported in this browser. ",alert(b+a),new Error(b);if(!dwv.browser.hasXmlHttpRequest())throw b="The XMLHttpRequest is not supported in this browser. ",alert(b+a),new Error(b);if(!dwv.browser.hasTypedArray())throw b="The Typed arrays are not supported in this browser. ",alert(b+a),new Error(b);dwv.browser.hasClampedArray()||console.warn("The Uint8ClampedArray is not supported in this browser. This may impair performance. ")};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.filter=dwv.gui.filter||{},dwv.gui.filter.base=dwv.gui.filter.base||{},dwv.gui.base.appendFilterHtml=function(){var a=dwv.html.createHtmlSelect("filterSelect",dwv.tool.filters);a.onchange=dwv.gui.onChangeFilter;var b=dwv.html.createHiddenElement("li","filterLi");b.setAttribute("class","ui-block-b"),b.appendChild(a),dwv.html.appendElement("toolList",b)},dwv.gui.base.displayFilterHtml=function(a){dwv.html.displayElement("filterLi",a)},dwv.gui.base.initFilterHtml=function(){var a=document.getElementById("filterSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#filterSelect")},dwv.gui.filter.base.appendThresholdHtml=function(){var a=dwv.html.createHiddenElement("li","thresholdLi");a.setAttribute("class","ui-block-c");var b=document.getElementById("toolList");b.appendChild(a),dwv.gui.appendSliderHtml(),$("#toolList").trigger("create")},dwv.gui.filter.base.displayThresholdHtml=function(a){dwv.html.displayElement("thresholdLi",a)},dwv.gui.filter.base.initThresholdHtml=function(){dwv.gui.initSliderHtml()},dwv.gui.filter.base.createFilterApplyButton=function(){var a=document.createElement("button");return a.id="runFilterButton",a.onclick=dwv.gui.onRunFilter,a.setAttribute("style","width:100%; margin-top:0.5em;"),a.setAttribute("class","ui-btn ui-btn-b"),a.appendChild(document.createTextNode("Apply")),a},dwv.gui.filter.base.appendSharpenHtml=function(){var a=dwv.html.createHiddenElement("li","sharpenLi");a.setAttribute("class","ui-block-c"),a.appendChild(dwv.gui.filter.base.createFilterApplyButton()),dwv.html.appendElement("toolList",a)},dwv.gui.filter.base.displaySharpenHtml=function(a){dwv.html.displayElement("sharpenLi",a)},dwv.gui.filter.base.appendSobelHtml=function(){var a=dwv.html.createHiddenElement("li","sobelLi");a.setAttribute("class","ui-block-c"),a.appendChild(dwv.gui.filter.base.createFilterApplyButton()),dwv.html.appendElement("toolList",a)},dwv.gui.filter.base.displaySobelHtml=function(a){dwv.html.displayElement("sobelLi",a)};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.getWindowSize=function(){return{width:$(window).width(),height:$(window).height()-147}},dwv.gui.updateProgress=function(a){if(a.lengthComputable){var b=Math.round(a.loaded/a.total*100);dwv.gui.displayProgress(b)}},dwv.gui.base.displayProgress=function(a){100>a?$.mobile.loading("show",{text:a+"%",textVisible:!0,theme:"b"}):100===a&&$.mobile.loading("hide")},dwv.gui.base.refreshSelect=function(a){$(a).selectmenu&&$(a).selectmenu("refresh")},dwv.gui.setSelected=function(a,b){var c=document.getElementById(a),d=0;for(d in c.options)if(c.options[d].text===b)break;c.selectedIndex=d,dwv.gui.refreshSelect("#"+a)},dwv.gui.base.appendSliderHtml=function(){var a=0,b=1,c=document.createElement("input");c.id="threshold-min",c.type="range",c.max=b,c.min=a,c.value=a;var d=document.createElement("input");d.id="threshold-max",d.type="range",d.max=b,d.min=a,d.value=b;var e=document.createElement("div");e.id="threshold-div",e.setAttribute("data-role","rangeslider"),e.appendChild(c),e.appendChild(d),e.setAttribute("data-mini","true"),document.getElementById("thresholdLi").appendChild(e),$("#threshold-div").on("change",function(){dwv.gui.onChangeMinMax({min:$("#threshold-min").val(),max:$("#threshold-max").val()})}),$("#toolList").trigger("create")},dwv.gui.base.initSliderHtml=function(){var a=app.getImage().getDataRange().min,b=app.getImage().getDataRange().max,c=document.getElementById("threshold-min");c.max=b,c.min=a,c.value=a;var d=document.getElementById("threshold-max");d.max=b,d.min=a,d.value=b,$("#toolList").trigger("create")},dwv.gui.base.appendTagsTable=function(a){var b=document.getElementById("tags");if(null!==b){for(;b.hasChildNodes();)b.removeChild(b.firstChild);a.PixelData&&(a.PixelData.value="...");var c=dwv.html.toTable(a);c.id="tagsTable",c.className="tagsList table-stripe",c.setAttribute("data-role","table"),c.setAttribute("data-mode","columntoggle"),b.appendChild(dwv.html.getHtmlSearchForm(c)),b.appendChild(c),$("#tags").trigger("create")}};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.onChangeWindowLevelPreset=function(){dwv.tool.updateWindowingDataFromName(this.value)},dwv.gui.onChangeColourMap=function(){dwv.tool.updateColourMapFromName(this.value)},dwv.gui.onChangeLoader=function(){"file"===this.value?(dwv.gui.displayUrlLoadHtml(!1),dwv.gui.displayFileLoadHtml(!0)):"url"===this.value&&(dwv.gui.displayFileLoadHtml(!1),dwv.gui.displayUrlLoadHtml(!0))},dwv.gui.onChangeFiles=function(a){app.onChangeFiles(a)},dwv.gui.onChangeURL=function(a){app.onChangeURL(a)},dwv.gui.onChangeTool=function(){app.getToolBox().setSelectedTool(this.value)},dwv.gui.onChangeFilter=function(){app.getToolBox().getSelectedTool().setSelectedFilter(this.value)},dwv.gui.onRunFilter=function(){app.getToolBox().getSelectedTool().getSelectedFilter().run()},dwv.gui.onChangeMinMax=function(a){app.getToolBox().getSelectedTool().getSelectedFilter&&app.getToolBox().getSelectedTool().getSelectedFilter().run(a)},dwv.gui.onChangeShape=function(){app.getToolBox().getSelectedTool().setShapeName(this.value)},dwv.gui.onChangeLineColour=function(){app.getToolBox().getSelectedTool().setLineColour(this.value)},dwv.gui.onZoomReset=function(){app.resetLayout()},dwv.gui.onDisplayReset=function(a){dwv.gui.onZoomReset(a),app.initWLDisplay();var b=document.getElementById("presetSelect");b.selectedIndex=0,dwv.gui.refreshSelect("#presetSelect")},dwv.gui.onUndo=function(){app.getUndoStack().undo()},dwv.gui.onRedo=function(){app.getUndoStack().redo()},dwv.gui.onToggleInfoLayer=function(){app.toggleInfoLayerDisplay()};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.appendVersionHtml=function(){for(var a=document.getElementsByClassName("dwv-version"),b=0;b<a.length;++b)a[b].appendChild(document.createTextNode(app.getVersion()))},dwv.gui.base.appendHelpHtml=function(a){var b="mouse";a&&(b="touch");var c=document.createElement("div"),d=window.location.pathname,e=d.substring(0,d.lastIndexOf("/"));for(var f in dwv.tool.tools){var g=dwv.tool.tools[f],h=document.createElement("h3");h.appendChild(document.createTextNode(g.getHelp().title));var i=document.createElement("div"),j=document.createElement("p");if(j.appendChild(document.createTextNode(g.getHelp().brief)),i.appendChild(j),g.getHelp()[b])for(var k=Object.keys(g.getHelp()[b]),l=0;l<k.length;++l){var m=g.getHelp()[b][k[l]],n=document.createElement("img");n.src=e+"/../../resources/"+k[l]+".png",n.style["float"]="left",n.style.margin="0px 15px 15px 0px";var o=document.createElement("br");o.style.clear="both";var p=document.createElement("p");p.appendChild(n),p.appendChild(document.createTextNode(m)),p.appendChild(o),i.appendChild(p)}if(a){var q=document.createElement("div");q.setAttribute("data-role","collapsible"),q.appendChild(h),q.appendChild(i),c.appendChild(q)}else c.id="accordion",c.appendChild(h),c.appendChild(i)}var r=document.getElementById("help"),s=document.createElement("a");s.href="https://github.com/ivmartel/dwv/wiki",s.title="DWV wiki on github.",s.appendChild(document.createTextNode("DWV"));var t=document.createElement("a"),u=document.URL.indexOf("?input=");t.href=document.URL.substr(0,u+7)+"http%3A%2F%2Fx.babymri.org%2F%3F53320924%26.dcm",t.title="Brain MRI in DWV.",t.target="_top",t.appendChild(document.createTextNode("MRI"));var v=document.createElement("a");v.href="http://www.babymri.org",v.title="babymri.org",v.appendChild(document.createTextNode("babymri.org"));var w=document.createElement("p");w.appendChild(s),w.appendChild(document.createTextNode(" can load DICOM data either from a local file or from an URL. All DICOM tags are available in a searchable table, press the 'tags' or grid button. You can choose to display the image information overlay by pressing the 'info' or i button. For some example data, check this ")),w.appendChild(t),w.appendChild(document.createTextNode(" from the ")),w.appendChild(v),w.appendChild(document.createTextNode(" database.")),r.appendChild(w);var x=document.createElement("p");x.appendChild(document.createTextNode("Each tool defines the possible user interactions. The default tool is the window/level one. Here are the available tools:")),r.appendChild(x),r.appendChild(c)};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.appendCell=function(a,b){var c=a.insertCell(-1),d=b;if(b instanceof Uint8Array){d="";for(var e=0;e<b.length;++e)e>0&&(d+=","),d+=b[e]}c.appendChild(document.createTextNode(d))},dwv.html.appendHCell=function(a,b){var c=document.createElement("th");"Value"!==b&&"Name"!==b&&c.setAttribute("data-priority","1"),c.appendChild(document.createTextNode(b)),a.appendChild(c)},dwv.html.appendRowForArray=function(a,b,c,d,e){for(var f=null,g=0;g<b.length;++g)"number"==typeof b[g]||"string"==typeof b[g]||null===b[g]||void 0===b[g]||c>=d?(f||(f=a.insertRow(-1)),dwv.html.appendCell(f,b[g])):dwv.html.appendRow(a,b[g],c+g,d,e)},dwv.html.appendRowForObject=function(a,b,c,d,e){for(var f=Object.keys(b),g=null,h=0;h<f.length;++h)"number"==typeof b[f[h]]||"string"==typeof b[f[h]]||null===b[f[h]]||void 0===b[f[h]]||c>=d?(g||(g=a.insertRow(-1)),0===h&&e&&dwv.html.appendCell(g,e),dwv.html.appendCell(g,b[f[h]])):dwv.html.appendRow(a,b[f[h]],c+h,d,f[h]);if(2===c){var i=a.createTHead(),j=i.insertRow(-1);e&&dwv.html.appendHCell(j,"Name");for(var k=0;k<f.length;++k)dwv.html.appendHCell(j,dwv.utils.capitaliseFirstLetter(f[k]))}},dwv.html.appendRow=function(a,b,c,d,e){if(b instanceof Array)dwv.html.appendRowForArray(a,b,c+1,d,e);else{if("object"!=typeof b)throw new Error("Unsupported input data type.");dwv.html.appendRowForObject(a,b,c+1,d,e)}},dwv.html.toTable=function(a){var b=document.createElement("table");return dwv.html.appendRow(b,a,0,2),b},dwv.html.getHtmlSearchForm=function(a){var b=document.createElement("form");b.setAttribute("class","filter");var c=document.createElement("input");return c.onkeyup=function(){dwv.html.filterTable(c,a)},b.appendChild(c),b},dwv.html.filterTable=function(a,b){dwv.html.dehighlight(b);for(var c=a.value.toLowerCase().split(" "),d=0,e=0,f=1;f<b.rows.length;++f){e="";for(var g=0;g<c.length;++g)d=b.rows[f].innerHTML.replace(/<[^>]+>/g,"").toLowerCase(),d.indexOf(c[g])<0?e="none":c[g].length&&dwv.html.highlight(c[g],b.rows[f]),b.rows[f].style.display=e}},dwv.html.dehighlight=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c.attributes&&c.attributes["class"]&&"highlighted"===c.attributes["class"].value)return void c.parentNode.parentNode.replaceChild(document.createTextNode(c.parentNode.innerHTML.replace(/<[^>]+>/g,"")),c.parentNode);3!==c.nodeType&&dwv.html.dehighlight(c)}},dwv.html.highlight=function(a,b){for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(3===d.nodeType){var e=d.data,f=e.toLowerCase();if(f.indexOf(a)>=0){var g=document.createElement("span");d.parentNode.replaceChild(g,d);for(var h;-1!==(h=f.indexOf(a));)g.appendChild(document.createTextNode(e.substr(0,h))),g.appendChild(dwv.html.createHighlightNode(document.createTextNode(e.substr(h,a.length)))),e=e.substr(h+a.length),f=f.substr(h+a.length);g.appendChild(document.createTextNode(e))}}else dwv.html.highlight(a,d)}},dwv.html.createHighlightNode=function(a){var b=document.createElement("span");return b.setAttribute("class","highlighted"),b.attributes["class"].value="highlighted",b.appendChild(a),b},dwv.html.cleanNode=function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},dwv.html.removeNode=function(a){var b=document.getElementById(a);if(b){dwv.html.cleanNode(b);var c=b.parentNode;c.removeChild(b)}},dwv.html.createHtmlSelect=function(a,b){var c=document.createElement("select");c.id=a,c.name=a;var d;if(b instanceof Array)for(var e in b)d=document.createElement("option"),d.value=b[e],d.appendChild(document.createTextNode(dwv.utils.capitaliseFirstLetter(b[e]))),c.appendChild(d);else{if("object"!=typeof b)throw new Error("Unsupported input list type.");for(var f in b)d=document.createElement("option"),d.value=f,d.appendChild(document.createTextNode(dwv.utils.capitaliseFirstLetter(f))),c.appendChild(d)}return c},dwv.html.getUriParam=function(a){var b=a||window.location.href,c=dwv.utils.splitQueryString(b);if(0===Object.keys(c).length)return null;var d=c.query;if(!d||!d.input)throw new Error("No input parameter in query URI.");var e=[];return e=d.type&&"manifest"===d.type?dwv.html.decodeManifestUri(d.input,d.nslices):dwv.html.decodeKeyValueUri(d.input,d.dwvReplaceMode)},dwv.html.decodeKeyValueUri=function(a,b){var c=[],d="key";b&&(d=b);var e=decodeURIComponent(a),f=dwv.utils.splitQueryString(e);if(0===Object.keys(f).length)c.push(e);else{for(var g=Object.keys(f.query),h=null,i=0;i<g.length;++i)if(f.query[g[i]]instanceof Array){h=g[i];break}if(h){var j=f.query[h],k=f.base;"file"!==h&&(k+="?");for(var l=!1,m=0;m<g.length;++m)g[m]!==h&&(l&&(k+="&"),k+=g[m]+"="+f.query[g[m]],l=!0);for(var n,o=0;o<j.length;++o)n=k,l&&(n+="&"),"key"===d&&(n+=h+"="),n+=j[o],c.push(n)}else c.push(e)}return c},dwv.html.decodeManifestUri=function(a,b){var c=[],d=function(){console.warn("RequestError while receiving manifest: "+this.status)},e=function(){c=dwv.html.decodeManifest(this.responseXML,b)},f=new XMLHttpRequest;return f.open("GET",decodeURIComponent(a),!1),f.responseType="xml",f.onload=e,f.onerror=d,f.send(null),c},dwv.html.decodeManifest=function(a,b){var c=[],d=a.getElementsByTagName("wado_query"),e=d[0].getAttribute("wadoURL"),f=e+"?requestType=WADO&contentType=application/dicom&",g=a.getElementsByTagName("Patient");g.length>1&&console.warn("More than one patient, loading first one.");var h=g[0].getElementsByTagName("Study");h.length>1&&console.warn("More than one study, loading first one.");var i=h[0].getAttribute("StudyInstanceUID"),j=h[0].getElementsByTagName("Series");j.length>1&&console.warn("More than one series, loading first one.");var k=j[0].getAttribute("SeriesInstanceUID"),l=j[0].getElementsByTagName("Instance"),m=l.length;m>b&&(m=b);for(var n=0;m>n;++n){var o=l[n].getAttribute("SOPInstanceUID"),p=f+"&studyUID="+i+"&seriesUID="+k+"&objectUID="+o;c.push(p)}return c},dwv.html.displayElement=function(a,b){var c=document.getElementById(a);c&&(c.style.display=b?"":"none")},dwv.html.toggleDisplay=function(a){var b=document.getElementById(a);b&&(b.style.display="none"===b.style.display?"":"none")},dwv.html.appendElement=function(a,b){var c=document.getElementById(a);b&&(c.appendChild(b),$("#"+a).trigger("create"))},dwv.html.createHiddenElement=function(a,b){var c=document.createElement(a);return c.id=b,c.style.display="none",c};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.Layer=function(a){var b=null,c=null,d=null;this.getName=function(){return a},this.getCanvas=function(){return b},this.getContext=function(){return d},this.getOffset=function(){return $("#"+a).offset()};var e=null,f={x:0,y:0};this.getOrigin=function(){return f};var g={x:1,y:1};this.getZoom=function(){return g},this.setWidth=function(a){b.width=a},this.setHeight=function(a){b.height=a},this.zoom=function(a,b,c,d){f.x=c-(c-f.x)*(a/g.x),f.y=d-(d-f.y)*(b/g.y),g.x=a,g.y=b},this.translate=function(a,b){f.x+=a*g.x,f.y+=b*g.y},this.setImageData=function(a){e=a,c.getContext("2d").putImageData(e,0,0)},this.resetLayout=function(a){f.x=0,f.y=0,g.x=a,g.y=a},this.displayToIndex=function(a){return{x:(a.x-f.x)/g.x,y:(a.y-f.y)/g.y}},this.draw=function(){d.save(),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,b.width,b.height),d.restore(),d.setTransform(g.x,0,0,g.y,f.x,f.y),d.drawImage(c,0,0)},this.initialise=function(f,g){return(b=document.getElementById(a))?b.getContext?(d=b.getContext("2d"))?(b.width=f,b.height=g,d.clearRect(0,0,b.width,b.height),e=d.getImageData(0,0,b.width,b.height),c=document.createElement("canvas"),c.width=f,void(c.height=g)):void alert("Error: failed to get the 2D context for '"+a+"'."):void alert("Error: no canvas.getContext method for '"+a+"'."):void alert("Error: cannot find the canvas element for '"+a+"'.")},this.fillContext=function(){d.fillRect(0,0,b.width,b.height)},this.clear=function(){d.clearRect(0,0,b.width,b.height),e=d.getImageData(0,0,b.width,b.height),this.resetLayout()},this.merge=function(a){for(var c=a.getContext().getImageData(0,0,b.width,b.height),d=0,h=0,i=0,j=0,k=0,l=0;l<b.height;++l){h=parseInt(f.y+l*g.y,10)*b.width,j=l*b.width;for(var m=0;m<b.width;++m)d=4*(parseInt(f.x+m*g.x,10)+h),i=4*(m+j),k=c.data[d+3],0!==k&&(e.data[i]=c.data[d],e.data[i+1]=c.data[d+1],e.data[i+2]=c.data[d+2],e.data[i+3]=k)}a.clear(),this.draw()},this.setLineColor=function(a){d.fillStyle=a,d.strokeStyle=a},this.setStyleDisplay=function(a){b.style.display=a===!0?"":"none"},this.isVisible=function(){return"none"===b.style.display?!1:!0},this.align=function(a){b.style.top=a.getCanvas().offsetTop,b.style.left=a.getCanvas().offsetLeft}},dwv.html.getEventOffset=function(a){var b=[],c=0,d=0;if(a.targetTouches)for(var e=null,f=0;f<a.targetTouches.length;++f)e=a.targetTouches[f],c=e.pageX-app.getImageLayer().getOffset().left,d=e.pageY-app.getImageLayer().getOffset().top,b.push({x:c,y:d});else c=void 0===a.offsetX?a.layerX:a.offsetX,d=void 0===a.offsetY?a.layerY:a.offsetY,b.push({x:c,y:d});return b};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.appendLoadboxHtml=function(){var a=dwv.html.createHtmlSelect("loaderSelect",dwv.io.loaders);a.onchange=dwv.gui.onChangeLoader;for(var b=document.getElementById("loaderlist");b.hasChildNodes();)b.removeChild(b.firstChild);b.appendChild(a),$("#loaderlist").trigger("create")},dwv.gui.base.appendFileLoadHtml=function(){var a=document.createElement("input");a.onchange=dwv.gui.onChangeFiles,a.type="file",a.multiple=!0,a.id="imagefiles",a.setAttribute("data-clear-btn","true"),a.setAttribute("data-mini","true");var b=document.createElement("div");b.id="imagefilesdiv",b.style.display="none",b.appendChild(a);var c=document.getElementById("loaderlist");c.appendChild(b),$("#loaderlist").trigger("create")},dwv.gui.base.displayFileLoadHtml=function(a){var b=document.getElementById("imagefilesdiv");b.style.display=a?"":"none"},dwv.gui.base.appendUrlLoadHtml=function(){var a=document.createElement("input");a.onchange=dwv.gui.onChangeURL,a.type="url",a.id="imageurl",a.setAttribute("data-clear-btn","true"),a.setAttribute("data-mini","true");var b=document.createElement("div");b.id="imageurldiv",b.style.display="none",b.appendChild(a);var c=document.getElementById("loaderlist");c.appendChild(b),$("#loaderlist").trigger("create")},dwv.gui.base.displayUrlLoadHtml=function(a){var b=document.getElementById("imageurldiv");b.style.display=a?"":"none"};var dwv=dwv||{};dwv.html=dwv.html||{},dwv.html.Style=function(){var a=12,b="normal "+this.fontSize+"px sans-serif",c=this.fontSize+this.fontSize/5,d="#fff",e=0;dwv.html.Style.prototype.getFontSize=function(){return a},dwv.html.Style.prototype.getFontStr=function(){return b},dwv.html.Style.prototype.getLineHeight=function(){return c},dwv.html.Style.prototype.getTextColor=function(){return d},dwv.html.Style.prototype.getLineColor=function(){return e},dwv.html.Style.prototype.setLineColor=function(a){e=a}};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.appendToolboxHtml=function(){var a=dwv.html.createHtmlSelect("toolSelect",dwv.tool.tools);a.onchange=dwv.gui.onChangeTool;var b=document.createElement("li");b.id="toolLi",b.style.display="none",b.appendChild(a),b.setAttribute("class","ui-block-a");for(var c=document.getElementById("toolList");c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(b),$("#toolList").trigger("create")},dwv.gui.base.displayToolboxHtml=function(a){dwv.html.displayElement("toolLi",a)},dwv.gui.base.initToolboxHtml=function(){var a=document.getElementById("toolSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#toolSelect")},dwv.gui.base.appendWindowLevelHtml=function(){var a=dwv.html.createHtmlSelect("presetSelect",dwv.tool.presets);a.onchange=dwv.gui.onChangeWindowLevelPreset;var b=dwv.html.createHtmlSelect("colourMapSelect",dwv.tool.colourMaps);b.onchange=dwv.gui.onChangeColourMap;var c=document.createElement("li");c.id="wlLi",c.style.display="none",c.appendChild(a),c.setAttribute("class","ui-block-b");var d=document.createElement("li");d.id="cmLi",d.style.display="none",d.appendChild(b),d.setAttribute("class","ui-block-c");var e=document.getElementById("toolList");e.appendChild(c),e.appendChild(d),$("#toolList").trigger("create")},dwv.gui.base.displayWindowLevelHtml=function(a){dwv.html.displayElement("wlLi",a),dwv.html.displayElement("cmLi",a)},dwv.gui.base.initWindowLevelHtml=function(){var a=dwv.html.createHtmlSelect("presetSelect",dwv.tool.presets);a.onchange=dwv.gui.onChangeWindowLevelPreset,a.title="Select w/l preset.";var b=document.getElementById("wlLi");dwv.html.cleanNode(b),b.appendChild(a),$("#toolList").trigger("create");var c=document.getElementById("colourMapSelect");c.selectedIndex=0,"MONOCHROME1"===app.getImage().getPhotometricInterpretation()&&(c.selectedIndex=1),dwv.gui.refreshSelect("#colourMapSelect")},dwv.gui.base.appendDrawHtml=function(){var a=dwv.html.createHtmlSelect("shapeSelect",dwv.tool.shapes);a.onchange=dwv.gui.onChangeShape;var b=dwv.html.createHtmlSelect("colourSelect",dwv.tool.colors);b.onchange=dwv.gui.onChangeLineColour;var c=document.createElement("li");c.id="shapeLi",c.style.display="none",c.appendChild(a),c.setAttribute("class","ui-block-c");var d=document.createElement("li");d.id="colourLi",d.style.display="none",d.appendChild(b),d.setAttribute("class","ui-block-b");var e=document.getElementById("toolList");e.appendChild(c),e.appendChild(d),$("#toolList").trigger("create")},dwv.gui.base.displayDrawHtml=function(a){dwv.html.displayElement("colourLi",a),dwv.html.displayElement("shapeLi",a)},dwv.gui.base.initDrawHtml=function(){var a=document.getElementById("shapeSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#shapeSelect");var b=document.getElementById("colourSelect");b.selectedIndex=0,dwv.gui.refreshSelect("#colourSelect")},dwv.gui.base.appendLivewireHtml=function(){var a=dwv.html.createHtmlSelect("lwColourSelect",dwv.tool.colors);a.onchange=dwv.gui.onChangeLineColour;var b=document.createElement("li");b.id="lwColourLi",b.style.display="none",b.setAttribute("class","ui-block-b"),b.appendChild(a);var c=document.getElementById("toolList");c.appendChild(b),$("#toolList").trigger("create")},dwv.gui.base.displayLivewireHtml=function(a){dwv.html.displayElement("lwColourLi",a)},dwv.gui.base.initLivewireHtml=function(){var a=document.getElementById("lwColourSelect");a.selectedIndex=0,dwv.gui.refreshSelect("#lwColourSelect")},dwv.gui.base.appendZoomAndPanHtml=function(){var a=document.createElement("button");a.id="zoomResetButton",a.name="zoomResetButton",a.onclick=dwv.gui.onZoomReset,a.setAttribute("style","width:100%; margin-top:0.5em;"),a.setAttribute("class","ui-btn ui-btn-b");var b=document.createTextNode("Reset");a.appendChild(b);var c=document.createElement("li");c.id="zoomLi",c.style.display="none",c.setAttribute("class","ui-block-c"),c.appendChild(a);var d=document.getElementById("toolList");d.appendChild(c),$("#toolList").trigger("create")},dwv.gui.base.displayZoomAndPanHtml=function(a){dwv.html.displayElement("zoomLi",a)},dwv.gui.base.appendScrollHtml=function(){var a=document.createElement("li");a.id="scrollLi",a.style.display="none",a.setAttribute("class","ui-block-c");var b=document.getElementById("toolList");b.appendChild(a),$("#toolList").trigger("create")},dwv.gui.base.displayScrollHtml=function(a){dwv.html.displayElement("scrollLi",a)};var dwv=dwv||{};dwv.gui=dwv.gui||{},dwv.gui.base=dwv.gui.base||{},dwv.gui.base.appendUndoHtml=function(){var a=document.createElement("p");a.appendChild(document.createTextNode("History:")),a.appendChild(document.createElement("br"));var b=document.createElement("select");b.id="history_list",b.name="history_list",b.multiple="multiple",a.appendChild(b);for(var c=document.getElementById("history");c.hasChildNodes();)c.removeChild(c.firstChild);c.appendChild(a)},dwv.gui.cleanUndoHtml=function(){var a=document.getElementById("history_list");if(a&&0!==a.length)for(var b=a.length-1;b>=0;--b)a.remove(b)},dwv.gui.addCommandToUndoHtml=function(a){var b=document.getElementById("history_list"),c=b.length-(b.selectedIndex+1);if(c>0)for(var d=0;c>d;++d)b.remove(b.length-1);var e=document.createElement("option");e.text=a,e.value=a,b.add(e),b.selectedIndex++},dwv.gui.enableInUndoHtml=function(a){var b,c=document.getElementById("history_list");a?(c.selectedIndex++,b=c.options[c.selectedIndex],b.disabled=!1):(b=c.options[c.selectedIndex],b.disabled=!0,c.selectedIndex--)};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.filter=dwv.image.filter||{},dwv.image.filter.Threshold=function(){var a=0,b=0;this.getMin=function(){return a},this.setMin=function(b){a=b},this.getMax=function(){return b},this.setMax=function(a){b=a},this.getName=function(){return"Threshold"};var c=null;this.setOriginalImage=function(a){c=a},this.getOriginalImage=function(){return c}},dwv.image.filter.Threshold.prototype.update=function(){var a=this,b=app.getImage().getDataRange().min;a.setOriginalImage(app.getImage());var c=function(c){return c<a.getMin()||c>a.getMax()?b:c};return app.getImage().transform(c)},dwv.image.filter.Sharpen=function(){this.getName=function(){return"Sharpen"};var a=null;this.setOriginalImage=function(b){a=b},this.getOriginalImage=function(){return a}},dwv.image.filter.Sharpen.prototype.update=function(){return this.setOriginalImage(app.getImage()),app.getImage().convolute2D([0,-1,0,-1,5,-1,0,-1,0])},dwv.image.filter.Sobel=function(){this.getName=function(){return"Sobel"};var a=null;this.setOriginalImage=function(b){a=b},this.getOriginalImage=function(){return a}},dwv.image.filter.Sobel.prototype.update=function(){this.setOriginalImage(app.getImage());var a=app.getImage().convolute2D([1,0,-1,2,0,-2,1,0,-1]),b=app.getImage().convolute2D([1,2,1,0,0,0,-1,-2,-1]);return a.compose(b,function(a,b){return Math.sqrt(a*a+b*b)})};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.Size=function(a,b,c){this.getNumberOfColumns=function(){return a},this.getNumberOfRows=function(){return b},this.getNumberOfSlices=function(){return c||1}},dwv.image.Size.prototype.getSliceSize=function(){return this.getNumberOfColumns()*this.getNumberOfRows()},dwv.image.Size.prototype.getTotalSize=function(){return this.getSliceSize()*this.getNumberOfSlices()},dwv.image.Size.prototype.equals=function(a){return null!==a&&this.getNumberOfColumns()===a.getNumberOfColumns()&&this.getNumberOfRows()===a.getNumberOfRows()&&this.getNumberOfSlices()===a.getNumberOfSlices()},dwv.image.Size.prototype.isInBounds=function(a,b,c){return 0>a||a>this.getNumberOfColumns()-1||0>b||b>this.getNumberOfRows()-1||0>c||c>this.getNumberOfSlices()-1?!1:!0},dwv.image.Spacing=function(a,b,c){this.getColumnSpacing=function(){return a},this.getRowSpacing=function(){return b},this.getSliceSpacing=function(){return c||1}},dwv.image.Spacing.prototype.equals=function(a){return null!==a&&this.getColumnSpacing()===a.getColumnSpacing()&&this.getRowSpacing()===a.getRowSpacing()&&this.getSliceSpacing()===a.getSliceSpacing()},dwv.image.Image=function(a,b,c,d){var e=1,f=0,g="MONOCHROME2",h=0,i=c.length/a.getTotalSize(),j={},k=new Int16Array(c);"undefined"==typeof d&&(d=[[0,0,0]]);var l=null,m=null;this.getSize=function(){return a},this.getSpacing=function(){return b},this.getBuffer=function(){return c},this.getSlicePositions=function(){return d},this.getRescaleSlope=function(){return e},this.setRescaleSlope=function(a){e=a},this.getRescaleIntercept=function(){return f},this.setRescaleIntercept=function(a){f=a},this.getPhotometricInterpretation=function(){return g},this.setPhotometricInterpretation=function(a){g=a},this.getPlanarConfiguration=function(){return h},this.setPlanarConfiguration=function(a){h=a},this.getNumberOfComponents=function(){return i},this.getMeta=function(){return j},this.setMeta=function(a){j=a},this.getValueAtOffset=function(a){return c[a]},this.clone=function(){var a=new dwv.image.Image(this.getSize(),this.getSpacing(),k,d);return a.setRescaleSlope(this.getRescaleSlope()),a.setRescaleIntercept(this.getRescaleIntercept()),a.setPhotometricInterpretation(this.getPhotometricInterpretation()),a.setPlanarConfiguration(this.getPlanarConfiguration()),a.setMeta(this.getMeta()),a},this.appendSlice=function(b){if(null===b)throw new Error("Cannot append null slice");if(1!==b.getSize().getNumberOfSlices())throw new Error("Cannot append more than one slice");if(a.getNumberOfColumns()!==b.getSize().getNumberOfColumns())throw new Error("Cannot append a slice with different number of columns");if(a.getNumberOfRows()!==b.getSize().getNumberOfRows())throw new Error("Cannot append a slice with different number of rows");if(g!==b.getPhotometricInterpretation())throw new Error("Cannot append a slice with different photometric interpretation");for(var e in j)if(j[e]!==b.getMeta()[e])throw new Error("Cannot append a slice with different "+e);for(var f=0,h=b.getSlicePositions()[0],i=Math.abs(d[0][2]-h[2]),l=0,m=0;m<d.length;++m)l=Math.abs(d[m][2]-h[2]),i>l&&(i=l,f=m);l=d[f][2]-h[2];var n=l>0?f:f+1,o=new dwv.image.Size(a.getNumberOfColumns(),a.getNumberOfRows(),a.getNumberOfSlices()+1),p=1;"RGB"===g&&(p=3);var q=p*a.getSliceSize(),r=new Int16Array(q*o.getNumberOfSlices());if(0===n)r.set(b.getBuffer()),r.set(c,q);else if(n===a.getNumberOfSlices())r.set(c),r.set(b.getBuffer(),a.getNumberOfSlices()*q);else{var s=n*q;r.set(c.subarray(0,s-1)),r.set(b.getBuffer(),s),r.set(c.subarray(s),s+q)}d.splice(n,0,h),a=o,c=r,k=new Int16Array(r)},this.getDataRange=function(){return l||(l=this.calculateDataRange()),l},this.getHistogram=function(){return m||(m=this.calculateHistogram()),m}},dwv.image.Image.prototype.getValue=function(a,b,c){return this.getValueAtOffset(a+b*this.getSize().getNumberOfColumns()+c*this.getSize().getSliceSize())},dwv.image.Image.prototype.getRescaledValueAtOffset=function(a){return this.getValueAtOffset(a)*this.getRescaleSlope()+this.getRescaleIntercept()},dwv.image.Image.prototype.getRescaledValue=function(a,b,c){return this.getValue(a,b,c)*this.getRescaleSlope()+this.getRescaleIntercept()},dwv.image.Image.prototype.calculateDataRange=function(){for(var a=this.getValueAtOffset(0),b=a,c=0,d=0;d<this.getSize().getTotalSize();++d)c=this.getValueAtOffset(d),c>b&&(b=c),a>c&&(a=c);return{min:a,max:b}},dwv.image.Image.prototype.getRescaledDataRange=function(){var a=this.getDataRange();return{min:a.min*this.getRescaleSlope()+this.getRescaleIntercept(),max:a.max*this.getRescaleSlope()+this.getRescaleIntercept()}},dwv.image.Image.prototype.calculateHistogram=function(){for(var a=[],b=[],c=0,d=this.getSize().getTotalSize(),e=0;d>e;++e)c=this.getRescaledValueAtOffset(e),a[c]=(a[c]||0)+1;for(var f=this.getRescaledDataRange().min,g=this.getRescaledDataRange().max,h=f;g>=h;++h)b.push([h,a[h]||0]);
return b},dwv.image.Image.prototype.convolute2D=function(a){if(9!==a.length)throw new Error("The convolution matrix does not have a length of 9; it has "+a.length);var b=this.clone(),c=b.getBuffer(),d=this.getSize().getNumberOfColumns(),e=this.getSize().getNumberOfRows(),f=this.getSize().getNumberOfSlices(),g=this.getNumberOfComponents(),h=1,i=1;3===g&&(0===this.getPlanarConfiguration()?h=3:i=this.getSize().getTotalSize());var j=[];j[0]=(-d-1)*h,j[1]=-d*h,j[2]=(-d+1)*h,j[3]=-h,j[4]=0,j[5]=1*h,j[6]=(d-1)*h,j[7]=d*h,j[8]=(d+1)*h;var k=[];k[0]=j[4],k[1]=j[4],k[2]=j[5],k[3]=j[4],k[4]=j[4],k[5]=j[5],k[6]=j[7],k[7]=j[7],k[8]=j[8];var l=[];l[0]=j[1],l[1]=j[1],l[2]=j[2],l[3]=j[4],l[4]=j[4],l[5]=j[5],l[6]=j[7],l[7]=j[7],l[8]=j[8];var m=[];m[0]=j[1],m[1]=j[1],m[2]=j[2],m[3]=j[4],m[4]=j[4],m[5]=j[5],m[6]=j[4],m[7]=j[4],m[8]=j[5];var n=[];n[0]=j[3],n[1]=j[4],n[2]=j[5],n[3]=j[3],n[4]=j[4],n[5]=j[5],n[6]=j[6],n[7]=j[7],n[8]=j[8];var o=[];o[0]=j[0],o[1]=j[1],o[2]=j[2],o[3]=j[3],o[4]=j[4],o[5]=j[5],o[6]=j[3],o[7]=j[4],o[8]=j[5];var p=[];p[0]=j[3],p[1]=j[4],p[2]=j[4],p[3]=j[3],p[4]=j[4],p[5]=j[4],p[6]=j[6],p[7]=j[7],p[8]=j[7];var q=[];q[0]=j[0],q[1]=j[1],q[2]=j[1],q[3]=j[3],q[4]=j[4],q[5]=j[4],q[6]=j[6],q[7]=j[7],q[8]=j[7];var r=[];r[0]=j[0],r[1]=j[1],r[2]=j[1],r[3]=j[3],r[4]=j[4],r[5]=j[4],r[6]=j[3],r[7]=j[4],r[8]=j[4];for(var s=0,t=0,u=[],v=0;g>v;v++){s=v*i;for(var w=0;f>w;w++)for(var x=0;e>x;x++)for(var y=0;d>y;y++){u=j,0===y&&0===x?u=k:0===y&&x===e-1?u=m:y===d-1&&0===x?u=p:y===d-1&&x===e-1?u=r:0===y&&x!==e-1&&0!==x?u=l:y===d-1&&x!==e-1&&0!==x?u=q:0!==y&&y!==d-1&&0===x?u=n:0!==y&&y!==d-1&&x===e-1&&(u=o),t=0;for(var z=0;9>z;++z)t+=this.getValueAtOffset(s+u[z])*a[z];c[s]=t,s+=h}}return b},dwv.image.Image.prototype.transform=function(a){for(var b=this.clone(),c=b.getBuffer(),d=0;d<c.length;++d)c[d]=a(b.getValueAtOffset(d));return b},dwv.image.Image.prototype.compose=function(a,b){for(var c=this.clone(),d=c.getBuffer(),e=0;e<d.length;++e)d[e]=Math.floor(b(this.getValueAtOffset(e),a.getValueAtOffset(e)));return c},dwv.image.Image.prototype.quantifyLine=function(a){var b=a.getWorldLength(this.getSpacing().getColumnSpacing(),this.getSpacing().getRowSpacing());return{length:b}},dwv.image.Image.prototype.quantifyRect=function(a){for(var b=a.getWorldSurface(this.getSpacing().getColumnSpacing(),this.getSpacing().getRowSpacing()),c=[],d=parseInt(a.getBegin().getY(),10),e=parseInt(a.getEnd().getY(),10),f=parseInt(a.getBegin().getX(),10),g=parseInt(a.getEnd().getX(),10),h=d;e>h;++h)for(var i=f;g>i;++i)c.push(this.getValue(i,h,0));var j=dwv.math.getStats(c);return{surface:b,min:j.min,max:j.max,mean:j.mean,stdDev:j.stdDev}},dwv.image.Image.prototype.quantifyEllipse=function(a){var b=a.getWorldSurface(this.getSpacing().getColumnSpacing(),this.getSpacing().getRowSpacing());return{surface:b}};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.lut=dwv.image.lut||{},dwv.image.lut.Rescale=function(a,b){var c=null;"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=0),this.getSlope=function(){return a},this.getIntercept=function(){return b},this.initialise=function(d){var e=Math.pow(2,d);c=new Float32Array(e);for(var f=0;e>f;++f)c[f]=f*a+b},this.getLength=function(){return c.length},this.getValue=function(a){return c[a]}},dwv.image.lut.Window=function(a,b){var c=null;c=dwv.browser.hasClampedArray()?new Uint8ClampedArray(a.getLength()):new Uint8Array(a.getLength());var d=null,e=null;this.getCenter=function(){return d},this.getWidth=function(){return e},this.isSigned=function(){return b},this.setCenterAndWidth=function(f,g){d=f,e=g;var h=c.length,i=f-.5;b&&(i+=a.getSlope()*(h/2));var j=g-1,k=0;if(dwv.browser.hasClampedArray())for(var l=0;h>l;++l)k=255*((a.getValue(l)-i)/j+.5),c[l]=parseInt(k,10);else for(var m=255,n=0,o=0;h>o;++o)k=255*((a.getValue(o)-i)/j+.5),k=parseInt(k,10),c[o]=n>=k?n:k>m?m:k},this.getLength=function(){return c.length},this.getValue=function(a){var d=b?c.length/2:0;return c[a+d]}},dwv.image.lut.range_max=256,dwv.image.lut.buildLut=function(a){for(var b=[],c=0;c<dwv.image.lut.range_max;++c)b.push(a(c));return b},dwv.image.lut.max=function(){return dwv.image.lut.range_max-1},dwv.image.lut.maxFirstThird=function(a){return a<dwv.image.lut.range_max/3?dwv.image.lut.range_max-1:0},dwv.image.lut.maxSecondThird=function(a){var b=dwv.image.lut.range_max/3;return a>=b&&2*b>a?dwv.image.lut.range_max-1:0},dwv.image.lut.maxThirdThird=function(a){return a>=2*dwv.image.lut.range_max/3?dwv.image.lut.range_max-1:0},dwv.image.lut.toMaxFirstThird=function(a){var b=3*a;return b>dwv.image.lut.range_max-1?dwv.image.lut.range_max-1:b},dwv.image.lut.toMaxSecondThird=function(a){var b=dwv.image.lut.range_max/3,c=0;return a>=b&&(c=3*(a-b),c>dwv.image.lut.range_max-1)?dwv.image.lut.range_max-1:c},dwv.image.lut.toMaxThirdThird=function(a){var b=dwv.image.lut.range_max/3,c=0;return a>=2*b&&(c=3*(a-2*b),c>dwv.image.lut.range_max-1)?dwv.image.lut.range_max-1:c},dwv.image.lut.zero=function(){return 0},dwv.image.lut.id=function(a){return a},dwv.image.lut.invId=function(a){return dwv.image.lut.range_max-1-a},dwv.image.lut.plain={red:dwv.image.lut.buildLut(dwv.image.lut.id),green:dwv.image.lut.buildLut(dwv.image.lut.id),blue:dwv.image.lut.buildLut(dwv.image.lut.id)},dwv.image.lut.invPlain={red:dwv.image.lut.buildLut(dwv.image.lut.invId),green:dwv.image.lut.buildLut(dwv.image.lut.invId),blue:dwv.image.lut.buildLut(dwv.image.lut.invId)},dwv.image.lut.rainbow={blue:[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3],red:[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]},dwv.image.lut.hot={red:dwv.image.lut.buildLut(dwv.image.lut.toMaxFirstThird),green:dwv.image.lut.buildLut(dwv.image.lut.toMaxSecondThird),blue:dwv.image.lut.buildLut(dwv.image.lut.toMaxThirdThird)},dwv.image.lut.test={red:dwv.image.lut.buildLut(dwv.image.lut.id),green:dwv.image.lut.buildLut(dwv.image.lut.zero),blue:dwv.image.lut.buildLut(dwv.image.lut.zero)};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.getDataFromImage=function(a){var b=document.getElementById("imageLayer");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);for(var d=c.getImageData(0,0,a.width,a.height),e=[],f=0,g=0;g<d.data.length;g+=4)e[f]=d.data[g],e[f+1]=d.data[g+1],e[f+2]=d.data[g+2],f+=3;var h=new dwv.image.Size(a.width,a.height),i=new dwv.image.Spacing(1,1),j=a.index?a.index:0,k=new dwv.image.Image(h,i,e,[[0,0,j]]);k.setPhotometricInterpretation("RGB");var l={};l.BitsStored=8,k.setMeta(l);var m=new dwv.image.View(k);m.setWindowLevelMinMax();var n={};return a.file&&(n.fileName={value:a.file.name},n.fileType={value:a.file.type},n.fileLastModifiedDate={value:a.file.lastModifiedDate}),n.imageWidth={value:a.width},n.imageHeight={value:a.height},{view:m,info:n}},dwv.image.getDataFromDicomBuffer=function(a){var b=new dwv.dicom.DicomParser;b.parse(a);var c=b.createImage();return{view:c,info:b.dicomElements}};var dwv=dwv||{};dwv.image=dwv.image||{},dwv.image.View=function(a,b){var c=new dwv.image.lut.Rescale(a.getRescaleSlope(),a.getRescaleIntercept());c.initialise(a.getMeta().BitsStored);var d=new dwv.image.lut.Window(c,b),e=null,f=dwv.image.lut.plain,g={i:0,j:0,k:0};this.getImage=function(){return a},this.setImage=function(b){a=b},this.getRescaleLut=function(){return c},this.setRescaleLut=function(a){c=a},this.getWindowLut=function(){return d},this.setWindowLut=function(a){d=a},this.getWindowPresets=function(){return e},this.setWindowPresets=function(a){e=a,this.setWindowLevel(a[0].center,a[0].width)},this.getColorMap=function(){return f},this.setColorMap=function(a){f=a,"MONOCHROME1"===this.getImage().getPhotometricInterpretation()&&(f=dwv.image.lut.invPlain),this.fireEvent({type:"colorchange",wc:this.getWindowLut().getCenter(),ww:this.getWindowLut().getWidth()})},this.isSigned=function(){return b},this.getCurrentPosition=function(){return g},this.setCurrentPosition=function(b){if(!a.getSize().isInBounds(b.i,b.j,b.k))return!1;var c=g;return g=b,this.fireEvent(null!==app.getImage().getPhotometricInterpretation().match(/MONOCHROME/)?{type:"positionchange",i:b.i,j:b.j,k:b.k,value:a.getRescaledValue(b.i,b.j,b.k)}:{type:"positionchange",i:b.i,j:b.j,k:b.k}),c.k!==g.k&&this.fireEvent({type:"slicechange"}),!0};var h={};this.getListeners=function(){return h},this.setListeners=function(a){h=a}},dwv.image.View.prototype.setWindowLevel=function(a,b){b>=1&&(this.getWindowLut().setCenterAndWidth(a,b),this.fireEvent({type:"wlchange",wc:a,ww:b}))},dwv.image.View.prototype.setWindowLevelMinMax=function(){var a=this.getImage().getRescaledDataRange(),b=a.min,c=a.max,d=c-b,e=b+d/2;this.setWindowLevel(e,d)},dwv.image.View.prototype.goFirstSlice=function(){return this.setCurrentPosition({i:this.getCurrentPosition().i,j:this.getCurrentPosition().j,k:0})},dwv.image.View.prototype.incrementSliceNb=function(){return this.setCurrentPosition({i:this.getCurrentPosition().i,j:this.getCurrentPosition().j,k:this.getCurrentPosition().k+1})},dwv.image.View.prototype.decrementSliceNb=function(){return this.setCurrentPosition({i:this.getCurrentPosition().i,j:this.getCurrentPosition().j,k:this.getCurrentPosition().k-1})},dwv.image.View.prototype.clone=function(){var a=new dwv.image.View(this.getImage());return a.setRescaleLut(this.getRescaleLut()),a.setWindowLut(this.getWindowLut()),a.setListeners(this.getListeners()),a},dwv.image.View.prototype.generateImageData=function(a){var b=this.getCurrentPosition().k,c=this.getImage(),d=0,e=c.getPhotometricInterpretation(),f=c.getPlanarConfiguration(),g=this.getWindowLut(),h=this.getColorMap(),i=0,j=0,k=0;switch(e){case"MONOCHROME1":case"MONOCHROME2":j=c.getSize().getSliceSize(),k=(b||0)*j;for(var l=k+j,m=k;l>m;++m)d=parseInt(g.getValue(c.getValueAtOffset(m)),10),a.data[i]=h.red[d],a.data[i+1]=h.green[d],a.data[i+2]=h.blue[d],a.data[i+3]=255,i+=4;break;case"RGB":if(0!==f&&1!==f)throw new Error("Unsupported planar configuration: "+f);j=c.getSize().getSliceSize(),k=3*(b||0)*j;var n=k,o=k+1,p=k+2,q=3;1===f&&(n=k,o=k+j,p=k+2*j,q=1);for(var r=0,s=0,t=0,u=0;u<c.getSize().getSliceSize();++u)r=parseInt(g.getValue(c.getValueAtOffset(n)),10),s=parseInt(g.getValue(c.getValueAtOffset(o)),10),t=parseInt(g.getValue(c.getValueAtOffset(p)),10),a.data[i]=r,a.data[i+1]=s,a.data[i+2]=t,a.data[i+3]=255,i+=4,n+=q,o+=q,p+=q;break;default:throw new Error("Unsupported photometric interpretation: "+e)}},dwv.image.View.prototype.addEventListener=function(a,b){var c=this.getListeners();c[a]||(c[a]=[]),c[a].push(b)},dwv.image.View.prototype.removeEventListener=function(a,b){var c=this.getListeners();if(c[a])for(var d=0;d<c[a].length;++d)c[a][d]===b&&c[a].splice(d,1)},dwv.image.View.prototype.fireEvent=function(a){var b=this.getListeners();if(b[a.type])for(var c=0;c<b[a.type].length;++c)b[a.type][c](a)};var dwv=dwv||{};dwv.io=dwv.io||{},dwv.io.File=function(){this.onload=null,this.onerror=null},dwv.io.File.prototype.load=function(a){for(var b=this.onload,c=this.onerror,d=function(a){c({name:"RequestError",message:"An error occurred while reading the image file: "+a.getMessage()})},e=function(a){c({name:"RequestError",message:"An error occurred while reading the DICOM file: "+a.getMessage()})},f=function(a){try{var d=dwv.image.getDataFromDicomBuffer(a.target.result);b(d)}catch(e){c(e)}var f={lengthComputable:!0,loaded:1,total:1};dwv.gui.updateProgress(f)},g=function(){try{var a=dwv.image.getDataFromImage(this);b(a)}catch(d){c(d)}},h=function(a){var b=new Image;b.src=a.target.result,b.file=this.file,b.index=this.index,b.onload=g},i=0;i<a.length;++i){var j=a[i],k=new FileReader;j.type.match("image.*")?(k.file=j,k.index=i,k.onload=h,k.onprogress=dwv.gui.updateProgress,k.onerror=d,k.readAsDataURL(j)):(k.onload=f,k.onprogress=dwv.gui.updateProgress,k.onerror=e,k.readAsArrayBuffer(j))}};var dwv=dwv||{};dwv.io=dwv.io||{},dwv.io.Url=function(){this.onload=null,this.onerror=null},dwv.io.Url.prototype.load=function(a){for(var b=this.onload,c=this.onerror,d=function(){c({name:"RequestError",message:"An error occurred while retrieving the file: (http) "+this.status})},e=function(a){try{var d=dwv.image.getDataFromDicomBuffer(a);b(d)}catch(e){c(e)}},f=function(){try{var a=dwv.image.getDataFromImage(this);b(a)}catch(d){c(d)}},g=function(){var a=new DataView(this.response),b=4292411360===a.getUint32(0),c=2303741511===a.getUint32(0),d=1195984440===a.getUint32(0);if(b||c||d){for(var g=new Uint8Array(this.response),h="",i=0;i<g.byteLength;++i)h+=String.fromCharCode(g[i]);var j="unknown";b?j="jpeg":c?j="png":d&&(j="gif");var k=new Image;k.src="data:image/"+j+";base64,"+window.btoa(h),k.onload=f}else e(this.response)},h=0;h<a.length;++h){var i=a[h],j=new XMLHttpRequest;j.open("GET",i,!0),j.responseType="arraybuffer",j.onload=g,j.onerror=d,j.onprogress=dwv.gui.updateProgress,j.send(null)}};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.BucketQueue=function(a,b){this.bucketCount=1<<a,this.mask=this.bucketCount-1,this.size=0,this.loc=0,this.cost="undefined"!=typeof b?b:function(a){return a},this.buckets=this.buildArray(this.bucketCount)},dwv.math.BucketQueue.prototype.push=function(a){var b=this.getBucket(a);a.next=this.buckets[b],this.buckets[b]=a,this.size++},dwv.math.BucketQueue.prototype.pop=function(){if(0===this.size)throw new Error("Cannot pop, bucketQueue is empty.");for(;null===this.buckets[this.loc];)this.loc=(this.loc+1)%this.bucketCount;var a=this.buckets[this.loc];return this.buckets[this.loc]=a.next,a.next=null,this.size--,a},dwv.math.BucketQueue.prototype.remove=function(a){if(!a)return!1;for(var b=this.getBucket(a),c=this.buckets[b];null!==c&&!a.equals(c.next);)c=c.next;return null===c?!1:(c.next=c.next.next,this.size--,!0)},dwv.math.BucketQueue.prototype.isEmpty=function(){return 0===this.size},dwv.math.BucketQueue.prototype.getBucket=function(a){return this.cost(a)&this.mask},dwv.math.BucketQueue.prototype.buildArray=function(a){for(var b=new Array(a),c=0;c<b.length;c++)b[c]=null;return b};var dwv=dwv||{};dwv.math=dwv.math||{};var __twothirdpi=2/(3*Math.PI);dwv.math.computeGreyscale=function(a,b,c){for(var d=[],e=0;c>e;e++){d[e]=[];for(var f=0;b>f;f++){var g=4*(e*b+f);d[e][f]=(a[g]+a[g+1]+a[g+2])/765}}return d.dx=function(a,b){return a+1===this[b].length&&a--,this[b][a+1]-this[b][a]},d.dy=function(a,b){return b+1===this.length&&b--,this[b][a]-this[b+1][a]},d.gradMagnitude=function(a,b){var c=this.dx(a,b),d=this.dy(a,b);return Math.sqrt(c*c+d*d)},d.laplace=function(a,b){var c=-16*this[b][a];return c+=this[b-2][a],c+=this[b-1][a-1]+2*this[b-1][a]+this[b-1][a+1],c+=this[b][a-2]+2*this[b][a-1]+2*this[b][a+1]+this[b][a+2],c+=this[b+1][a-1]+2*this[b+1][a]+this[b+1][a+1],c+=this[b+2][a]},d},dwv.math.computeGradient=function(a){var b=[],c=0,d=0,e=0;for(e=0;e<a.length-1;e++){for(b[e]=[],d=0;d<a[e].length-1;d++)b[e][d]=a.gradMagnitude(d,e),c=Math.max(b[e][d],c);b[e][a[e].length-1]=b[e][a.length-2]}b[a.length-1]=[];for(var f=0;f<b[0].length;f++)b[a.length-1][f]=b[a.length-2][f];for(e=0;e<b.length;e++)for(d=0;d<b[e].length;d++)b[e][d]=1-b[e][d]/c;return b},dwv.math.computeLaplace=function(a){var b=[];b[0]=[],b[1]=[];for(var c=1;c<a.length;c++)b[0][c]=1,b[1][c]=1;for(var d=2;d<a.length-2;d++){b[d]=[],b[d][0]=1,b[d][1]=1;for(var e=2;e<a[d].length-2;e++)b[d][e]=a.laplace(e,d)>.33?0:1;b[d][a[d].length-2]=1,b[d][a[d].length-1]=1}b[a.length-2]=[],b[a.length-1]=[];for(var f=1;f<a.length;f++)b[a.length-2][f]=1,b[a.length-1][f]=1;return b},dwv.math.computeGradX=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length-1;d++)b[c][d]=a.dx(d,c);b[c][a[c].length-1]=b[c][a[c].length-2]}return b},dwv.math.computeGradY=function(a){for(var b=[],c=0;c<a.length-1;c++){b[c]=[];for(var d=0;d<a[c].length;d++)b[c][d]=a.dy(d,c)}b[a.length-1]=[];for(var e=0;e<a[0].length;e++)b[a.length-1][e]=b[a.length-2][e];return b},dwv.math.gradUnitVector=function(a,b,c,d,e){var f=a[d][c],g=b[d][c],h=Math.sqrt(f*f+g*g);h=Math.max(h,1e-100),e.x=f/h,e.y=g/h},dwv.math.gradDirection=function(a,b,c,d,e,f){var g=new dwv.math.FastPoint2D(-1,-1),h=new dwv.math.FastPoint2D(-1,-1);dwv.math.gradUnitVector(a,b,c,d,g),dwv.math.gradUnitVector(a,b,e,f,h);var i=g.y*(e-c)-g.x*(f-d),j=h.y*(e-c)-h.x*(f-d);return 0>i&&(i=-i,j=-j),c!==e&&d!==f&&(i*=Math.SQRT1_2,j*=Math.SQRT1_2),__twothirdpi*(Math.acos(i)+Math.acos(j))},dwv.math.computeSides=function(a,b,c,d){var e={};e.inside=[],e.outside=[];for(var f=new dwv.math.FastPoint2D(-1,-1),g=0;g<b.length;g++){e.inside[g]=[],e.outside[g]=[];for(var h=0;h<b[g].length;h++){dwv.math.gradUnitVector(b,c,h,g,f);var i=Math.round(h+a*f.y),j=Math.round(g-a*f.x),k=Math.round(h-a*f.y),l=Math.round(g+a*f.x);i=Math.max(Math.min(i,b[g].length-1),0),k=Math.max(Math.min(k,b[g].length-1),0),j=Math.max(Math.min(j,b.length-1),0),l=Math.max(Math.min(l,b.length-1),0),e.inside[g][h]=d[j][i],e.outside[g][h]=d[l][k]}}return e},dwv.math.gaussianBlur=function(a,b){b[0]=.4*a[0]+.5*a[1]+.1*a[1],b[1]=.25*a[0]+.4*a[1]+.25*a[2]+.1*a[3];for(var c=2;c<a.length-2;c++)b[c]=.05*a[c-2]+.25*a[c-1]+.4*a[c]+.25*a[c+1]+.05*a[c+2];var d=a.length;b[d-2]=.25*a[d-1]+.4*a[d-2]+.25*a[d-3]+.1*a[d-4],b[d-1]=.4*a[d-1]+.5*a[d-2]+.1*a[d-3]},dwv.math.Scissors=function(){this.width=-1,this.height=-1,this.curPoint=null,this.searchGranBits=8,this.searchGran=1<<this.earchGranBits,this.pointsPerPost=500,this.greyscale=null,this.laplace=null,this.gradient=null,this.gradX=null,this.gradY=null,this.parents=null,this.working=!1,this.trained=!1,this.trainingPoints=null,this.edgeWidth=2,this.trainingLength=32,this.edgeGran=256,this.edgeTraining=null,this.gradPointsNeeded=32,this.gradGran=1024,this.gradTraining=null,this.insideGran=256,this.insideTraining=null,this.outsideGran=256,this.outsideTraining=null},dwv.math.Scissors.prototype.getTrainingIdx=function(a,b){return Math.round((a-1)*b)},dwv.math.Scissors.prototype.getTrainedEdge=function(a){return this.edgeTraining[this.getTrainingIdx(this.edgeGran,a)]},dwv.math.Scissors.prototype.getTrainedGrad=function(a){return this.gradTraining[this.getTrainingIdx(this.gradGran,a)]},dwv.math.Scissors.prototype.getTrainedInside=function(a){return this.insideTraining[this.getTrainingIdx(this.insideGran,a)]},dwv.math.Scissors.prototype.getTrainedOutside=function(a){return this.outsideTraining[this.getTrainingIdx(this.outsideGran,a)]},dwv.math.Scissors.prototype.setWorking=function(a){this.working=a},dwv.math.Scissors.prototype.setDimensions=function(a,b){this.width=a,this.height=b},dwv.math.Scissors.prototype.setData=function(a){if(-1===this.width||-1===this.height)throw new Error("Dimensions have not been set.");this.greyscale=dwv.math.computeGreyscale(a,this.width,this.height),this.laplace=dwv.math.computeLaplace(this.greyscale),this.gradient=dwv.math.computeGradient(this.greyscale),this.gradX=dwv.math.computeGradX(this.greyscale),this.gradY=dwv.math.computeGradY(this.greyscale);var b=dwv.math.computeSides(this.edgeWidth,this.gradX,this.gradY,this.greyscale);this.inside=b.inside,this.outside=b.outside,this.edgeTraining=[],this.gradTraining=[],this.insideTraining=[],this.outsideTraining=[]},dwv.math.Scissors.prototype.findTrainingPoints=function(a){var b=[];if(null!==this.parents)for(var c=0;c<this.trainingLength&&a;c++)b.push(a),a=this.parents[a.y][a.x];return b},dwv.math.Scissors.prototype.resetTraining=function(){this.trained=!1},dwv.math.Scissors.prototype.doTraining=function(a){if(this.trainingPoints=this.findTrainingPoints(a),!(this.trainingPoints.length<8)){var b=[];this.calculateTraining(b,this.edgeGran,this.greyscale,this.edgeTraining),this.calculateTraining(b,this.gradGran,this.gradient,this.gradTraining),this.calculateTraining(b,this.insideGran,this.inside,this.insideTraining),this.calculateTraining(b,this.outsideGran,this.outside,this.outsideTraining),this.trainingPoints.length<this.gradPointsNeeded&&this.addInStaticGrad(this.trainingPoints.length,this.gradPointsNeeded),this.trained=!0}},dwv.math.Scissors.prototype.calculateTraining=function(a,b,c,d){var e=0;for(a.length=b,e=0;b>e;e++)a[e]=0;var f=1;for(e=0;e<this.trainingPoints.length;e++){var g=this.trainingPoints[e],h=this.getTrainingIdx(b,c[g.y][g.x]);a[h]+=1,f=Math.max(f,a[h])}for(e=0;b>e;e++)a[e]=1-a[e]/f;dwv.math.gaussianBlur(a,d)},dwv.math.Scissors.prototype.addInStaticGrad=function(a,b){for(var c=0;c<this.gradGran;c++)this.gradTraining[c]=Math.min(this.gradTraining[c],1-c*(b-a)/(b*this.gradGran))},dwv.math.Scissors.prototype.gradDirection=function(a,b,c,d){return dwv.math.gradDirection(this.gradX,this.gradY,a,b,c,d)},dwv.math.Scissors.prototype.dist=function(a,b,c,d){var e=this.gradient[d][c];(a===c||b===d)&&(e*=Math.SQRT1_2);var f=this.laplace[d][c],g=this.gradDirection(a,b,c,d);if(this.trained){var h=this.getTrainedGrad(e),i=this.getTrainedEdge(this.greyscale[b][a]),j=this.getTrainedInside(this.inside[b][a]),k=this.getTrainedOutside(this.outside[b][a]);return.3*h+.3*f+.1*(g+i+j+k)}return.43*e+.43*f+.11*g},dwv.math.Scissors.prototype.adj=function(a){for(var b=[],c=Math.max(a.x-1,0),d=Math.max(a.y-1,0),e=Math.min(a.x+1,this.greyscale[0].length-1),f=Math.min(a.y+1,this.greyscale.length-1),g=0,h=d;f>=h;h++)for(var i=c;e>=i;i++)(i!==a.x||h!==a.y)&&(b[g++]=new dwv.math.FastPoint2D(i,h));return b},dwv.math.Scissors.prototype.setPoint=function(a){this.setWorking(!0),this.curPoint=a;var b=0,c=0;for(this.visited=[],c=0;c<this.height;c++)for(this.visited[c]=[],b=0;b<this.width;b++)this.visited[c][b]=!1;for(this.parents=[],c=0;c<this.height;c++)this.parents[c]=[];for(this.cost=[],c=0;c<this.height;c++)for(this.cost[c]=[],b=0;b<this.width;b++)this.cost[c][b]=Number.MAX_VALUE;this.pq=new dwv.math.BucketQueue(this.searchGranBits,function(a){return Math.round(this.searchGran*this.costArr[a.y][a.x])}),this.pq.searchGran=this.searchGran,this.pq.costArr=this.cost,this.pq.push(a),this.cost[a.y][a.x]=0},dwv.math.Scissors.prototype.doWork=function(){if(this.working){this.timeout=null;for(var a=0,b=[];!this.pq.isEmpty()&&a<this.pointsPerPost;){var c=this.pq.pop();b.push(c),b.push(this.parents[c.y][c.x]),this.visited[c.y][c.x]=!0;for(var d=this.adj(c),e=0;e<d.length;e++){var f=d[e],g=this.cost[c.y][c.x]+this.dist(c.x,c.y,f.x,f.y);g<this.cost[f.y][f.x]&&(this.cost[f.y][f.x]!==Number.MAX_VALUE&&this.pq.remove(f),this.cost[f.y][f.x]=g,this.parents[f.y][f.x]=c,this.pq.push(f))}a++}return b}};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.Point2D=function(a,b){this.getX=function(){return a},this.getY=function(){return b}},dwv.math.Point2D.prototype.equals=function(a){return a?this.getX()===a.getX()&&this.getY()===a.getY():!1},dwv.math.Point2D.prototype.toString=function(){return"("+this.getX()+", "+this.getY()+")"},dwv.math.FastPoint2D=function(a,b){this.x=a,this.y=b},dwv.math.FastPoint2D.prototype.equals=function(a){return a?this.x===a.x&&this.y===a.y:!1},dwv.math.FastPoint2D.prototype.toString=function(){return"("+this.x+", "+this.y+")"},dwv.math.Circle=function(a,b){var c=Math.PI*b*b;this.getCenter=function(){return a},this.getRadius=function(){return b},this.getSurface=function(){return c},this.getWorldSurface=function(a,b){return c*a*b}},dwv.math.Ellipse=function(a,b,c){var d=Math.PI*b*c;this.getCenter=function(){return a},this.getA=function(){return b},this.getB=function(){return c},this.getSurface=function(){return d},this.getWorldSurface=function(a,b){return d*a*b}},dwv.math.Line=function(a,b){var c=Math.sqrt(Math.abs(b.getX()-a.getX())*Math.abs(b.getX()-a.getX())+Math.abs(b.getY()-a.getY())*Math.abs(b.getY()-a.getY()));this.getBegin=function(){return a},this.getEnd=function(){return b},this.getLength=function(){return c},this.getWorldLength=function(c,d){var e=Math.abs(b.getX()-a.getX())*c,f=Math.abs(b.getY()-a.getY())*d;return Math.sqrt(e*e+f*f)},this.getMidpoint=function(){return new dwv.math.Point2D(parseInt((a.getX()+b.getX())/2,10),parseInt((a.getY()+b.getY())/2,10))},this.getSlope=function(){return(b.getY()-a.getY())/(b.getX()-a.getX())}},dwv.math.getAngle=function(a,b){var c=a.getSlope(),d=b.getSlope(),e=180*Math.atan(Math.abs((c-d)/(1+c*d)))/Math.PI;return e},dwv.math.Rectangle=function(a,b){if(b.getX()<a.getX()){var c=a.getX();a=new dwv.math.Point2D(b.getX(),a.getY()),b=new dwv.math.Point2D(c,b.getY())}if(b.getY()<a.getY()){var d=a.getY();a=new dwv.math.Point2D(a.getX(),b.getY()),b=new dwv.math.Point2D(b.getX(),d)}var e=Math.abs(b.getX()-a.getX())*Math.abs(b.getY()-a.getY());this.getBegin=function(){return a},this.getEnd=function(){return b},this.getRealWidth=function(){return b.getX()-a.getX()},this.getRealHeight=function(){return b.getY()-a.getY()},this.getWidth=function(){return Math.abs(this.getRealWidth())},this.getHeight=function(){return Math.abs(this.getRealHeight())},this.getSurface=function(){return e},this.getWorldSurface=function(a,b){return e*a*b}},dwv.math.ROI=function(){var a=[];this.getPoint=function(b){return a[b]},this.getLength=function(){return a.length},this.addPoint=function(b){a.push(b)},this.addPoints=function(b){a=a.concat(b)}},dwv.math.Path=function(a,b){this.pointArray=a?a.slice():[],this.controlPointIndexArray=b?b.slice():[]},dwv.math.Path.prototype.getPoint=function(a){return this.pointArray[a]},dwv.math.Path.prototype.isControlPoint=function(a){var b=this.pointArray.indexOf(a);if(-1!==b)return-1!==this.controlPointIndexArray.indexOf(b);throw new Error("Error: isControlPoint called with not in list point.")},dwv.math.Path.prototype.getLength=function(){return this.pointArray.length},dwv.math.Path.prototype.addPoint=function(a){this.pointArray.push(a)},dwv.math.Path.prototype.addControlPoint=function(a){var b=this.pointArray.indexOf(a);if(-1===b)throw new Error("Error: addControlPoint called with no point in list point.");this.controlPointIndexArray.push(b)},dwv.math.Path.prototype.addPoints=function(a){this.pointArray=this.pointArray.concat(a)},dwv.math.Path.prototype.appenPath=function(a){var b=this.pointArray.length;this.pointArray=this.pointArray.concat(a.pointArray);for(var c=[],d=0;d<a.controlPointIndexArray.length;++d)c[d]=a.controlPointIndexArray[d]+b;this.controlPointIndexArray=this.controlPointIndexArray.concat(c)};var dwv=dwv||{};dwv.math=dwv.math||{},dwv.math.getStats=function(a){for(var b=a[0],c=b,d=0,e=0,f=0,g=0,h=0,i=0,j=0;j<a.length;++j)i=a[j],b>i?b=i:i>c&&(c=i),e+=i,f+=i*i;return d=e/a.length,h=f/a.length-d*d,g=Math.sqrt(h),{min:b,max:c,mean:d,stdDev:g}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.DrawShapeCommand=function(a,b,c){this.getName=function(){return"Draw-"+b},this.execute=function(){var b=a.getParent();c.add(b),c.draw()},this.undo=function(){var b=a.getParent();b.remove(),c.draw()}},dwv.tool.MoveShapeCommand=function(a,b,c,d){this.getName=function(){return"Move-"+b},this.execute=function(){var b=a.getParent();b.getChildren().each(function(a){a.x(a.x()+c.x),a.y(a.y()+c.y)}),d.draw()},this.undo=function(){var b=a.getParent();b.getChildren().each(function(a){a.x(a.x()-c.x),a.y(a.y()-c.y)}),d.draw()}},dwv.tool.ChangeShapeCommand=function(a,b,c,d,e,f,g){this.getName=function(){return"Change-"+b},this.execute=function(){c(a,e,g),f.draw()},this.undo=function(){c(a,d,g),f.draw()}},dwv.tool.DeleteShapeCommand=function(a,b,c){this.getName=function(){return"Delete-"+b},this.execute=function(){var b=a.getParent();b.remove(),c.draw()},this.undo=function(){var b=a.getParent();c.add(b),c.draw()}},dwv.tool.colors=["Yellow","Red","White","Green","Blue","Lime","Fuchsia","Black"],dwv.tool.Draw=function(a){function b(a){a.off("mouseover"),a.off("mouseout"),a.draggable(!1),a.off("dragstart"),a.off("dragmove"),a.off("dragend")}function c(b){var c=a.getDrawStage();return{x:c.offset().x+b.x/c.scale().x,y:c.offset().y+b.y/c.scale().y}}var d=this,e=!1,f=!0,g=null,h=null,i=null,j=[],k=null;this.style=new dwv.html.Style,this.shapeName=0;var l=[],m=null,n=new dwv.tool.ShapeEditor,o=new Kinetic.Group,p=new Kinetic.Line({points:[-10,-10,10,10],stroke:"red"}),q=new Kinetic.Line({points:[10,-10,-10,10],stroke:"red"});o.add(p),o.add(q);var r=null;this.mousedown=function(b){var c=a.getDrawStage(),d=c.getIntersection({x:b._xs,y:b._ys});if(d){var f=d.getParent(),g=f.find(".shape")[0];g&&g!==n.getShape()&&(n.disable(),n.setShape(g),n.setImage(a.getImage()),n.enable())}else n.disable(),n.setShape(null),n.setImage(null),e=!0,k=new Kinetic.Group,l=[],m=new dwv.math.Point2D(b._x,b._y),l.push(m)},this.mousemove=function(b){if(e&&(Math.abs(b._x-m.getX())>0||Math.abs(b._y-m.getY())>0)){m=new dwv.math.Point2D(b._x,b._y),f||l.pop(),l.push(m);var c=new dwv.tool.shapes[d.shapeName];l.length<c.getNPoints()&&(clearTimeout(this.timer),this.timer=setTimeout(function(){l.push(m)},c.getTimeout())),h&&!f&&(h.destroy(),i.destroy()),f&&(f=!1);var j=c.create(l,d.style,a.getImage());h=j.shape,i=j.text,h.listening(!1),r.hitGraphEnabled(!1),k.add(h),k.add(i),g=new dwv.tool.DrawShapeCommand(h,d.shapeName,r),g.execute()}},this.mouseup=function(){if(e&&l.length>1){h&&(h.destroy(),i.destroy());var b=new dwv.tool.shapes[d.shapeName],c=b.create(l,d.style,a.getImage());h=c.shape,i=c.text,r.hitGraphEnabled(!0),k.add(h),k.add(i),g=new dwv.tool.DrawShapeCommand(h,d.shapeName,r),g.execute(),a.getUndoStack().add(g),d.setShapeOn(h,i),j.push({shape:h,text:i})}e=!1,f=!0},this.mouseout=function(a){d.mouseup(a)},this.touchstart=function(a){d.mousedown(a)},this.touchmove=function(a){d.mousemove(a)},this.touchend=function(a){d.mouseup(a)},this.keydown=function(b){a.onKeydown(b)},this.display=function(c){dwv.gui.displayDrawHtml(c),n.disable(),n.setShape(null),n.setImage(null),document.body.style.cursor="default",a.getDrawStage().listening(c),r=a.getDrawLayer(),r.listening(c),r.hitGraphEnabled(c),c?(a.addLayerListeners(a.getDrawStage().getContent()),j.forEach(function(a){d.setShapeOn(a.shape,a.text)})):(a.removeLayerListeners(a.getDrawStage().getContent()),j.forEach(function(a){b(a.shape)})),r.draw()},this.setShapeOn=function(b,d){b.on("mouseover",function(){document.body.style.cursor="pointer"}),b.on("mouseout",function(){document.body.style.cursor="default"
}),b.draggable(!0);var e=null,f=null,g="shape";b instanceof Kinetic.Line?g=2==b.points.length?"line":3==b.points.length?"protractor":"roi":b instanceof Kinetic.Rect?g="rectangle":b instanceof Kinetic.Ellipse&&(g="ellipse");var h,i,j=b.stroke();b.on("dragstart",function(b){var f=dwv.html.getEventOffset(b.evt)[0];e=c(f),h=d.x(),i=d.y();var g=a.getDrawStage(),j=g.scale(),k={x:1/j.x,y:1/j.y};o.x(g.offset().x+256/j.x),o.y(g.offset().y+20/j.y),o.scale(k),r.add(o),n.setAnchorsActive(!1),r.draw()}),b.on("dragmove",function(a){var g=dwv.html.getEventOffset(a.evt)[0],k=c(g);f=k,Math.abs(k.x-o.x())<10&&Math.abs(k.y-o.y())<10?(o.getChildren().each(function(a){a.stroke("orange")}),b.stroke("red")):(o.getChildren().each(function(a){a.stroke("red")}),b.stroke(j));var l={x:k.x-e.x,y:k.y-e.y},m={x:h+l.x,y:i+l.y};d.position(m),n.resetAnchors(),r.draw()}),b.on("dragend",function(){var c=f;if(Math.abs(c.x-o.x())<10&&Math.abs(c.y-o.y())<10){var d={x:c.x-e.x,y:c.y-e.y},h=this.getParent();h.getChildren().each(function(a){a.x(a.x()-d.x),a.y(a.y()-d.y)}),b.stroke(j),n.disable(),n.setShape(null),n.setImage(null),document.body.style.cursor="default";var i=new dwv.tool.DeleteShapeCommand(this,g,r);i.execute(),a.getUndoStack().add(i)}else{var k={x:c.x-e.x,y:c.y-e.y};if(0!==k.x||0!==k.y){var l=new dwv.tool.MoveShapeCommand(this,g,k,r);a.getUndoStack().add(l)}n.setAnchorsActive(!0),n.resetAnchors()}o.remove(),r.draw()})}},dwv.tool.Draw.prototype.getHelp=function(){return{title:"Draw",brief:"Allows to draw shapes on the image. Choose the shape and its color from the drop down menus. Once created, shapes can be edited by selecting them. Anchors will appear and allow specific shape edition. Drag the shape on the top red cross to delete it. All actions are undoable. ",mouse:{mouse_drag:"A single mouse drag draws the desired shape."},touch:{touch_drag:"A single touch drag draws the desired shape."}}},dwv.tool.Draw.prototype.setLineColour=function(a){this.style.setLineColor(a)},dwv.tool.Draw.prototype.setShapeName=function(a){if(!this.hasShape(a))throw new Error("Unknown shape: '"+a+"'");this.shapeName=a},dwv.tool.Draw.prototype.hasShape=function(a){return dwv.tool.shapes[a]},dwv.tool.Draw.prototype.init=function(){var a=0;for(var b in dwv.tool.shapes){a=b;break}this.setShapeName(a),this.setLineColour(dwv.tool.colors[0]),dwv.gui.initDrawHtml()};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.ShapeEditor=function(){function a(a){if(i&&i.getParent()){var b=i.getParent().find(".anchor");b.each(a)}}function b(b){a(function(a){a.visible(b)})}function c(){a(function(a){a.remove()})}function d(){if(i&&i.getLayer()){var a=i.getParent();if(i instanceof Kinetic.Line){var b=i.points();if(4===b.length||6===b.length){var c=b[0]+i.x(),d=b[1]+i.y(),f=b[2]+i.x(),g=b[3]+i.y();if(e(a,c,d,"begin"),4===b.length)l=dwv.tool.UpdateLine,e(a,f,g,"end");else{l=dwv.tool.UpdateProtractor,e(a,f,g,"mid");var h=b[4]+i.x(),j=b[5]+i.y();e(a,h,j,"end")}}else{l=dwv.tool.UpdateRoi;for(var k=0,m=0,n=0;n<b.length;n+=2)k=b[n]+i.x(),m=b[n+1]+i.y(),e(a,k,m,n)}}else if(i instanceof Kinetic.Rect){l=dwv.tool.UpdateRect;var o=i.x(),p=i.y(),q=i.width(),r=i.height();e(a,o,p,"topLeft"),e(a,o+q,p,"topRight"),e(a,o+q,p+r,"bottomRight"),e(a,o,p+r,"bottomLeft")}else if(i instanceof Kinetic.Ellipse){l=dwv.tool.UpdateEllipse;var s=i.x(),t=i.y(),u=i.radius();e(a,s-u.x,t-u.y,"topLeft"),e(a,s+u.x,t-u.y,"topRight"),e(a,s+u.x,t+u.y,"bottomRight"),e(a,s-u.x,t+u.y,"bottomLeft")}i.getLayer().add(a)}}function e(a,b,c,d){var e=new Kinetic.Circle({x:b,y:c,stroke:"#999",fillRed:100,fillBlue:100,fillGreen:100,fillAlpha:.7,strokeWidth:2,radius:6,name:"anchor",id:d,dragOnTop:!1,draggable:!0,visible:!1});g(e),a.add(e)}function f(a){var b=a.getParent(),c=a.id(),d=a.x(),e=a.y(),f={};return f.getParent=function(){return b},f.id=function(){return c},f.x=function(){return d},f.y=function(){return e},f}function g(a){var b=null,c="shape";i instanceof Kinetic.Line?c=2==i.points.length?"line":3==i.points.length?"protractor":"roi":i instanceof Kinetic.Rect?c="rectangle":i instanceof Kinetic.Ellipse&&(c="ellipse"),a.on("dragstart",function(){b=f(this)}),a.on("dragmove",function(){l&&l(i,this,j),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")}),a.on("dragend",function(){var a=f(this),d=new dwv.tool.ChangeShapeCommand(i,c,l,b,a,this.getLayer(),j);d.execute(),app.getUndoStack().add(d),b=a}),a.on("mousedown touchstart",function(){this.moveToTop()}),a.on("mouseover",function(){document.body.style.cursor="pointer",this.stroke("#ddd"),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")}),a.on("mouseout",function(){document.body.style.cursor="default",this.stroke("#999"),this.getLayer()?this.getLayer().draw():console.warn("No layer to draw the anchor!")})}function h(a){a.off("dragstart"),a.off("dragmove"),a.off("dragend"),a.off("mousedown touchstart"),a.off("mouseover"),a.off("mouseout")}var i=null,j=null,k=!1,l=null;this.setShape=function(a){i=a,i&&(c(),d())},this.setImage=function(a){j=a},this.getShape=function(){return i},this.isActive=function(){return k},this.enable=function(){k=!0,i&&(b(!0),i.getLayer()&&i.getLayer().draw())},this.disable=function(){k=!1,i&&(b(!1),i.getLayer()&&i.getLayer().draw())},this.resetAnchors=function(){c(),d(),b(!0)},this.setAnchorsActive=function(b){var c=null;c=b?function(a){g(a)}:function(a){h(a)},a(c)}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.EllipseFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.EllipseFactory.prototype.create=function(a,b,c){var d=Math.abs(a[0].getX()-a[1].getX()),e=Math.abs(a[0].getY()-a[1].getY()),f=new dwv.math.Ellipse(a[0],d,e),g=new Kinetic.Ellipse({x:f.getCenter().getX(),y:f.getCenter().getY(),radius:{x:f.getA(),y:f.getB()},stroke:b.getLineColor(),strokeWidth:2,name:"shape"}),h=c.quantifyEllipse(f),i=h.surface/100,j=i.toPrecision(4)+" cm2",k=new Kinetic.Text({x:f.getCenter().getX(),y:f.getCenter().getY(),text:j,fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"});return{shape:g,text:k}},dwv.tool.UpdateEllipse=function(a,b,c){var d=b.getParent(),e=d.getChildren(function(a){return"topLeft"===a.id()})[0],f=d.getChildren(function(a){return"topRight"===a.id()})[0],g=d.getChildren(function(a){return"bottomRight"===a.id()})[0],h=d.getChildren(function(a){return"bottomLeft"===a.id()})[0];switch(b.id()){case"topLeft":e.x(b.x()),e.y(b.y()),f.y(b.y()),h.x(b.x());break;case"topRight":f.x(b.x()),f.y(b.y()),e.y(b.y()),g.x(b.x());break;case"bottomRight":g.x(b.x()),g.y(b.y()),h.y(b.y()),f.x(b.x());break;case"bottomLeft":h.x(b.x()),h.y(b.y()),g.y(b.y()),e.x(b.x());break;default:console.error("Unhandled anchor id: "+b.id())}var i=(f.x()-e.x())/2,j=(g.y()-f.y())/2,k={x:e.x()+i,y:f.y()+j};a.position(k);var l={x:Math.abs(i),y:Math.abs(j)};l&&a.radius(l);var m=d.getChildren(function(a){return"text"===a.name()})[0];if(m){var n=new dwv.math.Ellipse(k,i,j),o=c.quantifyEllipse(n),p=o.surface/100,q=p.toPrecision(4)+" cm2",r={x:k.x,y:k.y};m.position(r),m.text(q)}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.Filter=function(){this.selectedFilter=0,this.defaultFilterName=0,this.displayed=!1},dwv.tool.Filter.prototype.getHelp=function(){return{title:"Filter",brief:"A few simple image filters are available: a Threshold filter to limit the image intensities between a chosen minimum and maximum, a Sharpen filter to convolute the image with a sharpen matrix, a Sobel filter to get the gradient of the image in both directions."}},dwv.tool.Filter.prototype.display=function(a){dwv.gui.displayFilterHtml(a),this.displayed=a,this.selectedFilter.display(a)},dwv.tool.Filter.prototype.getSelectedFilter=function(){return this.selectedFilter},dwv.tool.Filter.prototype.setSelectedFilter=function(a){if(!this.hasFilter(a))throw new Error("Unknown filter: '"+a+"'");this.displayed&&this.selectedFilter.display(!1),this.selectedFilter=dwv.tool.filters[a],this.displayed&&this.selectedFilter.display(!0)},dwv.tool.Filter.prototype.hasFilter=function(a){return dwv.tool.filters[a]},dwv.tool.Filter.prototype.init=function(){for(var a in dwv.tool.filters){this.defaultFilterName=a;break}this.setSelectedFilter(this.defaultFilterName);for(a in dwv.tool.filters)dwv.tool.filters[a].init();dwv.gui.initFilterHtml()},dwv.tool.Filter.prototype.keydown=function(a){app.onKeydown(a)},dwv.tool.filter=dwv.tool.filter||{},dwv.tool.filter.Threshold=function(){},dwv.tool.filter.Threshold.prototype.display=function(a){dwv.gui.filter.displayThresholdHtml(a)},dwv.tool.filter.Threshold.prototype.init=function(){dwv.gui.filter.initThresholdHtml()},dwv.tool.filter.Threshold.prototype.run=function(a){var b=new dwv.image.filter.Threshold;b.setMin(a.min),b.setMax(a.max);var c=new dwv.tool.RunFilterCommand(b,app);c.execute(),app.getUndoStack().add(c)},dwv.tool.filter.Sharpen=function(){},dwv.tool.filter.Sharpen.prototype.display=function(a){dwv.gui.filter.displaySharpenHtml(a)},dwv.tool.filter.Sharpen.prototype.init=function(){},dwv.tool.filter.Sharpen.prototype.run=function(){var a=new dwv.image.filter.Sharpen,b=new dwv.tool.RunFilterCommand(a,app);b.execute(),app.getUndoStack().add(b)},dwv.tool.filter.Sobel=function(){},dwv.tool.filter.Sobel.prototype.display=function(a){dwv.gui.filter.displaySobelHtml(a)},dwv.tool.filter.Sobel.prototype.init=function(){},dwv.tool.filter.Sobel.prototype.run=function(){var a=new dwv.image.filter.Sobel,b=new dwv.tool.RunFilterCommand(a,app);b.execute(),app.getUndoStack().add(b)},dwv.tool.RunFilterCommand=function(a,b){this.getName=function(){return"Filter-"+a.getName()},this.execute=function(){b.setImage(a.update()),b.render()},this.undo=function(){b.setImage(a.getOriginalImage()),b.render()}};var dwv=dwv||{};dwv.info=dwv.info||{},dwv.info.createWindowingDiv=function(){var a=document.getElementById("infotr");dwv.html.removeNode("ulinfotr");var b=document.createElement("ul");b.id="ulinfotr";var c=document.createElement("li");c.id="liwcinfotr",b.appendChild(c);var d=document.createElement("li");d.id="liwwinfotr",b.appendChild(d),a.appendChild(b)},dwv.info.updateWindowingDiv=function(a){var b=document.getElementById("liwcinfotr");dwv.html.cleanNode(b),b.appendChild(document.createTextNode("WindowCenter = "+a.wc));var c=document.getElementById("liwwinfotr");dwv.html.cleanNode(c),c.appendChild(document.createTextNode("WindowWidth = "+a.ww))},dwv.info.createPositionDiv=function(){var a=document.getElementById("infotl");dwv.html.removeNode("ulinfotl");var b=document.createElement("ul");b.id="ulinfotl";var c=document.createElement("li");c.id="liposinfotl",b.appendChild(c);var d=document.createElement("li");d.id="livalueinfotl",b.appendChild(d),a.appendChild(b)},dwv.info.updatePositionDiv=function(a){var b=document.getElementById("liposinfotl");if(dwv.html.cleanNode(b),b.appendChild(document.createTextNode("Pos = "+a.i+", "+a.j+", "+a.k)),"undefined"!=typeof a.value){var c=document.getElementById("livalueinfotl");dwv.html.cleanNode(c),c.appendChild(document.createTextNode("Value = "+a.value))}},dwv.info.createMiniColorMap=function(){var a=document.getElementById("infobr");dwv.html.removeNode("canvasinfobr");var b=document.createElement("canvas");b.id="canvasinfobr",b.width=98,b.height=10,a.appendChild(b)},dwv.info.updateMiniColorMap=function(a){for(var b,c=a.wc,d=a.ww,e=document.getElementById("canvasinfobr"),f=e.getContext("2d"),g=app.getView().getColorMap(),h=f.getImageData(0,0,e.width,e.height),i=0,j=app.getImage().getRescaledDataRange().min,k=app.getImage().getRescaledDataRange().max-j,l=k/e.width,m=0,n=255,o=0,p=c-.5-(d-1)/2,q=c-.5+(d-1)/2,r=0;r<e.height;++r){i=j;for(var s=0;s<e.width;++s)p>=i?m=o:i>q?m=n:(m=((i-(c-.5))/(d-1)+.5)*(n-o)+o,m=parseInt(m,10)),b=4*(s+r*e.width),h.data[b]=g.red[m],h.data[b+1]=g.green[m],h.data[b+2]=g.blue[m],h.data[b+3]=255,i+=l}f.putImageData(h,0,0)},dwv.info.createPlot=function(){$.plot($("#plot"),[app.getImage().getHistogram()],{bars:{show:!0},grid:{backgroundColor:null},xaxis:{show:!0},yaxis:{show:!1}})},dwv.info.updatePlotMarkings=function(a){var b=a.wc,c=a.ww,d=parseInt((c-1)/2,10),e=parseInt(b-.5,10),f=e-d,g=e+d,h=[{color:"#faa",lineWidth:1,xaxis:{from:f,to:f}},{color:"#aaf",lineWidth:1,xaxis:{from:g,to:g}}];$.plot($("#plot"),[app.getImage().getHistogram()],{bars:{show:!0},grid:{markings:h,backgroundColor:null},xaxis:{show:!1},yaxis:{show:!1}})};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.LineFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.LineFactory.prototype.create=function(a,b,c){var d=new dwv.math.Line(a[0],a[1]),e=new Kinetic.Line({points:[d.getBegin().getX(),d.getBegin().getY(),d.getEnd().getX(),d.getEnd().getY()],stroke:b.getLineColor(),strokeWidth:2,name:"shape"}),f=c.quantifyLine(d),g=f.length.toPrecision(4)+" mm",h=new Kinetic.Text({x:d.getEnd().getX(),y:d.getEnd().getY()-15,text:g,fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"});return{shape:e,text:h}},dwv.tool.UpdateLine=function(a,b,c){var d=b.getParent(),e=d.getChildren(function(a){return"begin"===a.id()})[0],f=d.getChildren(function(a){return"end"===a.id()})[0];switch(b.id()){case"begin":e.x(b.x()),e.y(b.y());break;case"end":f.x(b.x()),f.y(b.y())}var g=e.x()-a.x(),h=e.y()-a.y(),i=f.x()-a.x(),j=f.y()-a.y();a.points([g,h,i,j]);var k=d.getChildren(function(a){return"text"===a.name()})[0];if(k){var l=new dwv.math.Point2D(e.x(),e.y()),m=new dwv.math.Point2D(f.x(),f.y()),n=new dwv.math.Line(l,m),o=c.quantifyLine(n),p=o.length.toPrecision(4)+" mm",q={x:n.getEnd().getX(),y:n.getEnd().getY()-15};k.position(q),k.text(p)}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.Livewire=function(a){function b(){for(var b=0;b<a.getImage().getSize().getNumberOfRows();++b)k[b]=[]}function c(){i=new dwv.math.Path,j=new dwv.math.Path}var d=this;this.started=!1;var e=!0,f=null,g=null,h=null;this.style=new dwv.html.Style;var i=new dwv.math.Path,j=new dwv.math.Path,k=[],l=5,m=new dwv.math.Scissors;this.mousedown=function(g){if(d.started)if(Math.abs(g._x-d.x0)<l&&Math.abs(g._y-d.y0)<l)d.mousemove(g),console.log("Done."),a.getUndoStack().add(f),d.started=!1,e=!0;else{i=j,b();var k=new dwv.math.FastPoint2D(g._x,g._y);m.doTraining(k),i.addControlPoint(j.getPoint(0))}else{d.started=!0,h=new Kinetic.Group,d.x0=g._x,d.y0=g._y,c(),b();var n=new dwv.math.FastPoint2D(g._x,g._y);m.doTraining(n);var o=new dwv.math.Point2D(g._x,g._y);i.addPoint(o),i.addControlPoint(o)}},this.mousemove=function(b){if(d.started){var c=new dwv.math.FastPoint2D(b._x,b._y);m.setPoint(c);for(var l=0,n=!1;!k[c.y][c.x]&&!n;)if(console.log("Getting ready..."),l=m.doWork(),0===l.length)n=!0;else for(var o=0;o<l.length-1;o+=2){var p=l[o],q=l[o+1];k[p.y][p.x]=q}for(console.log("Ready!"),j=new dwv.math.Path,n=!1;c&&!n;)j.addPoint(new dwv.math.Point2D(c.x,c.y)),k[c.y]&&k[c.y][c.x]?c=k[c.y][c.x]:n=!0;j.appenPath(i),g&&!e&&g.destroy(),e&&(e=!1),g=new dwv.tool.RoiCreator(j.pointArray,d.style),h.add(g),f=new dwv.tool.DrawShapeCommand(g,"livewire",a),f.execute()}},this.mouseup=function(){},this.mouseout=function(a){d.mouseup(a)},this.touchstart=function(a){d.mousedown(a)},this.touchmove=function(a){d.mousemove(a)},this.touchend=function(a){d.mouseup(a)},this.keydown=function(b){a.onKeydown(b)},this.display=function(a){dwv.gui.displayLivewireHtml(a),this.init()},this.init=function(){this.setLineColour(dwv.tool.colors[0]),dwv.gui.initLivewireHtml(),m.setDimensions(a.getImage().getSize().getNumberOfColumns(),a.getImage().getSize().getNumberOfRows()),m.setData(a.getImageData().data)}},dwv.tool.Livewire.prototype.getHelp=function(){return{title:"Livewire",brief:"The Livewire tool is a semi-automatic segmentation tool that proposes to the user paths that follow intensity edges.Click once to initialise and then move the mouse to see the proposed paths. Click again to build your contour. The process stops when you click on the first root point. BEWARE: the process can take time!"}},dwv.tool.Livewire.prototype.setLineColour=function(a){this.style.setLineColor(a)};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.ProtractorFactory=function(){this.getNPoints=function(){return 3},this.getTimeout=function(){return 500}},dwv.tool.ProtractorFactory.prototype.create=function(a,b){for(var c=new dwv.math.Line(a[0],a[1]),d=[],e=0;e<a.length;++e)d.push(a[e].getX()),d.push(a[e].getY());var f,g=new Kinetic.Line({points:d,stroke:b.getLineColor(),strokeWidth:2,name:"shape"});if(3==a.length){var h=new dwv.math.Line(a[1],a[2]),i=dwv.math.getAngle(c,h),j=i.toPrecision(4)+" deg";f=new Kinetic.Text({x:c.getEnd().getX(),y:c.getEnd().getY()-15,text:j,fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"})}else f=new Kinetic.Text({x:0,y:0,text:"",fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"});return{shape:g,text:f}},dwv.tool.UpdateProtractor=function(a,b){var c=b.getParent(),d=c.getChildren(function(a){return"begin"===a.id()})[0],e=c.getChildren(function(a){return"mid"===a.id()})[0],f=c.getChildren(function(a){return"end"===a.id()})[0];switch(b.id()){case"begin":d.x(b.x()),d.y(b.y());break;case"mid":e.x(b.x()),e.y(b.y());break;case"end":f.x(b.x()),f.y(b.y())}var g=d.x()-a.x(),h=d.y()-a.y(),i=e.x()-a.x(),j=e.y()-a.y(),k=f.x()-a.x(),l=f.y()-a.y();a.points([g,h,i,j,k,l]);var m=c.getChildren(function(a){return"text"===a.name()})[0];if(m){var n=new dwv.math.Point2D(d.x(),d.y()),o=new dwv.math.Point2D(e.x(),e.y()),p=new dwv.math.Point2D(f.x(),f.y()),q=new dwv.math.Line(n,o),r=new dwv.math.Line(o,p),s=dwv.math.getAngle(q,r),t=s.toPrecision(4)+" deg",u={x:q.getEnd().getX(),y:q.getEnd().getY()-15};m.position(u),m.text(t)}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.RectangleFactory=function(){this.getNPoints=function(){return 2},this.getTimeout=function(){return 0}},dwv.tool.RectangleFactory.prototype.create=function(a,b,c){var d=new dwv.math.Rectangle(a[0],a[1]),e=new Kinetic.Rect({x:d.getBegin().getX(),y:d.getBegin().getY(),width:d.getWidth(),height:d.getHeight(),stroke:b.getLineColor(),strokeWidth:2,name:"shape"}),f=c.quantifyRect(d),g=f.surface/100,h=g.toPrecision(4)+" cm2",i=new Kinetic.Text({x:d.getBegin().getX(),y:d.getEnd().getY()+10,text:h,fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"});return{shape:e,text:i}},dwv.tool.UpdateRect=function(a,b,c){var d=b.getParent(),e=d.getChildren(function(a){return"topLeft"===a.id()})[0],f=d.getChildren(function(a){return"topRight"===a.id()})[0],g=d.getChildren(function(a){return"bottomRight"===a.id()})[0],h=d.getChildren(function(a){return"bottomLeft"===a.id()})[0];switch(b.id()){case"topLeft":e.x(b.x()),e.y(b.y()),f.y(b.y()),h.x(b.x());break;case"topRight":f.x(b.x()),f.y(b.y()),e.y(b.y()),g.x(b.x());break;case"bottomRight":g.x(b.x()),g.y(b.y()),h.y(b.y()),f.x(b.x());break;case"bottomLeft":h.x(b.x()),h.y(b.y()),g.y(b.y()),e.x(b.x());break;default:console.error("Unhandled anchor id: "+b.id())}a.position(e.position());var i=f.x()-e.x(),j=h.y()-e.y();i&&j&&a.size({width:i,height:j});var k=d.getChildren(function(a){return"text"===a.name()})[0];if(k){var l=new dwv.math.Point2D(e.x(),e.y()),m=new dwv.math.Point2D(g.x(),g.y()),n=new dwv.math.Rectangle(l,m),o=c.quantifyRect(n),p=o.surface/100,q=p.toPrecision(4)+" cm2",r={x:n.getBegin().getX(),y:n.getEnd().getY()+10};k.position(r),k.text(q)}};var dwv=dwv||{};dwv.tool=dwv.tool||{};var Kinetic=Kinetic||{};dwv.tool.RoiFactory=function(){this.getNPoints=function(){return 50},this.getTimeout=function(){return 100}},dwv.tool.RoiFactory.prototype.create=function(a,b){var c=new dwv.math.ROI;c.addPoints(a);for(var d=[],e=0;e<c.getLength();++e)d.push(c.getPoint(e).getX()),d.push(c.getPoint(e).getY());var f=new Kinetic.Line({points:d,stroke:b.getLineColor(),strokeWidth:2,name:"shape",closed:!0}),g=new Kinetic.Text({x:0,y:0,text:"",fontSize:b.getFontSize(),fontFamily:"Verdana",fill:b.getLineColor(),name:"text"});return{shape:f,text:g}},dwv.tool.UpdateRoi=function(a,b){var c=b.getParent(),d=c.getChildren(function(a){return a.id()===b.id()})[0];d.x(b.x()),d.y(b.y());var e=a.points();e[b.id()]=b.x()-a.x(),e[b.id()+1]=b.y()-a.y(),a.points(e)};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.Scroll=function(a){var b=this;this.started=!1,this.mousedown=function(a){b.started=!0,b.x0=a._x,b.y0=a._y},this.mousemove=function(c){if(b.started){var d=c._y-b.y0;Math.abs(d)<15||(d>0?a.getView().incrementSliceNb():a.getView().decrementSliceNb(),b.x0=c._x,b.y0=c._y)}},this.mouseup=function(){b.started&&(b.started=!1)},this.mouseout=function(a){b.mouseup(a)},this.touchstart=function(a){b.mousedown(a)},this.touchmove=function(a){b.mousemove(a)},this.touchend=function(a){b.mouseup(a)},this.keydown=function(b){a.onKeydown(b)},this.display=function(a){dwv.gui.displayScrollHtml(a)}},dwv.tool.Scroll.prototype.getHelp=function(){return{title:"Scroll",brief:"The scroll tool allows to scroll through slices.",mouse:{mouse_drag:"A single vertical mouse drag changes the current slice."},touch:{touch_drag:"A single vertical touch drag changes the current slice."}}},dwv.tool.Scroll.prototype.init=function(){};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.ToolBox=function(){this.selectedTool=0,this.defaultToolName=0},dwv.tool.ToolBox.prototype.display=function(a){dwv.gui.displayToolboxHtml(a)},dwv.tool.ToolBox.prototype.getSelectedTool=function(){return this.selectedTool},dwv.tool.ToolBox.prototype.setSelectedTool=function(a){if(!this.hasTool(a))throw new Error("Unknown tool: '"+a+"'");this.selectedTool&&this.selectedTool.display(!1),this.selectedTool=dwv.tool.tools[a],this.selectedTool.display(!0)},dwv.tool.ToolBox.prototype.hasTool=function(a){return dwv.tool.tools[a]},dwv.tool.ToolBox.prototype.init=function(){for(var a in dwv.tool.tools){this.defaultToolName=a;break}this.setSelectedTool(this.defaultToolName);for(a in dwv.tool.tools)dwv.tool.tools[a].init();dwv.gui.initToolboxHtml()},dwv.tool.ToolBox.prototype.reset=function(){this.selectedTool&&this.selectedTool.display(!1),this.selectedTool=0,this.defaultToolName=0};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.UndoStack=function(){var a=[],b=0;this.add=function(c){a=a.slice(0,b),a.push(c),++b,dwv.gui.addCommandToUndoHtml(c.getName())},this.undo=function(){b>0&&(--b,a[b].undo(),dwv.gui.enableInUndoHtml(!1))},this.redo=function(){b<a.length&&(a[b].execute(),++b,dwv.gui.enableInUndoHtml(!0))}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.updatePostionValue=function(a,b){app.getView().setCurrentPosition({i:a,j:b,k:app.getView().getCurrentPosition().k})},dwv.tool.updateWindowingData=function(a,b){app.getView().setWindowLevel(a,b)},dwv.tool.updateWindowingDataFromName=function(a){if(!dwv.tool.presets[a])throw new Error("Unknown window level preset: '"+a+"'");dwv.tool.updateWindowingData(dwv.tool.presets[a].center,dwv.tool.presets[a].width)},dwv.tool.updateColourMap=function(a){app.getView().setColorMap(a)},dwv.tool.updateColourMapFromName=function(a){if(!dwv.tool.colourMaps[a])throw new Error("Unknown colour map: '"+a+"'");dwv.tool.updateColourMap(dwv.tool.colourMaps[a])},dwv.tool.colourMaps={plain:dwv.image.lut.plain,invplain:dwv.image.lut.invPlain,rainbow:dwv.image.lut.rainbow,hot:dwv.image.lut.hot,test:dwv.image.lut.test},dwv.tool.presets={},dwv.tool.defaultpresets={},dwv.tool.defaultpresets.CT={mediastinum:{center:40,width:400},lung:{center:-500,width:1500},bone:{center:500,width:2e3}},dwv.tool.defaultpresets.CTextra={brain:{center:40,width:80},head:{center:90,width:350}},dwv.tool.updatePresets=function(a){var b=dwv.tool.presets.manual;dwv.tool.presets={};var c=app.getView().getWindowPresets();if(c)if(a)for(var d=0;d<c.length;++d)dwv.tool.presets[c[d].name.toLowerCase()]=c[d];else dwv.tool.presets["default"]=c[0];var e=app.getImage().getMeta().Modality;for(var f in dwv.tool.defaultpresets[e])dwv.tool.presets[f]=dwv.tool.defaultpresets[e][f];if(a)for(var g in dwv.tool.defaultpresets[e+"extra"])dwv.tool.presets[g]=dwv.tool.defaultpresets[e+"extra"][g];var h=app.getImage().getRescaledDataRange(),i=h.max-h.min,j=h.min+i/2;dwv.tool.presets["min/max"]={center:j,width:i},b&&(dwv.tool.presets.manual=b)},dwv.tool.WindowLevel=function(a){var b=this;this.started=!1,this.mousedown=function(a){b.started=!0,b.x0=a._x,b.y0=a._y,dwv.tool.updatePostionValue(a._x,a._y)},this.mousemove=function(c){if(b.started){var d=c._x-b.x0,e=b.y0-c._y,f=parseInt(a.getView().getWindowLut().getCenter(),10)+e,g=parseInt(a.getView().getWindowLut().getWidth(),10)+d;dwv.tool.updateWindowingData(f,g),b.x0=c._x,b.y0=c._y}},this.mouseup=function(){if(b.started){b.started=!1;var c=parseInt(a.getView().getWindowLut().getCenter(),10),d=parseInt(a.getView().getWindowLut().getWidth(),10);dwv.tool.presets.manual={center:c,width:d},dwv.gui.initWindowLevelHtml(),dwv.gui.setSelected("presetSelect","Manual")}},this.mouseout=function(a){b.mouseup(a)},this.touchstart=function(a){b.mousedown(a)},this.touchmove=function(a){b.mousemove(a)},this.touchend=function(a){b.mouseup(a)},this.dblclick=function(b){dwv.tool.updateWindowingData(parseInt(a.getImage().getRescaledValue(b._x,b._y,a.getView().getCurrentPosition().k),10),parseInt(a.getView().getWindowLut().getWidth(),10))},this.keydown=function(b){a.onKeydown(b)},this.display=function(b){dwv.gui.displayWindowLevelHtml(null!==a.getImage().getPhotometricInterpretation().match(/MONOCHROME/)?b:!1)},this.init=function(){dwv.tool.updatePresets(!0),dwv.gui.initWindowLevelHtml()}},dwv.tool.WindowLevel.prototype.getHelp=function(){return{title:"Window/Level",brief:"Changes the Window and Level of the image.",mouse:{mouse_drag:"A single mouse drag changes the window in the horizontal direction and the level in the vertical one.",double_click:"A double click will center the window and level on the clicked intensity."},touch:{touch_drag:"A single touch drag changes the window in the horizontal direction and the level in the vertical one."}}};var dwv=dwv||{};dwv.tool=dwv.tool||{},dwv.tool.ZoomAndPan=function(a){function b(b,c,d,e,f){if(a.getImageLayer()){var g=a.getImageLayer().getZoom(),h={x:g.x+b,y:g.y+b};a.getImageLayer().zoom(h.x,h.y,e,f),a.getImageLayer().draw()}if(a.getDrawStage()){var i=a.getDrawStage(),j=i.scale(),k={x:j.x+b,y:j.y+b},l=i.offset(),m=e/j.x+l.x-e/k.x,n=f/j.y+l.y-f/k.y,o={x:m,y:n};i.offset(o),i.scale(k),i.draw()}}function c(b,c){if(a.getImageLayer()){var d=a.getImageLayer(),e=d.getZoom(),f=b/e.x,g=c/e.y;d.translate(f,g),d.draw()}if(a.getDrawStage()){var h=a.getDrawStage(),i=h.offset(),j=h.scale();i.x-=b/j.x,i.y-=c/j.y,h.offset(i),h.draw()}}var d=this;this.started=!1,this.mousedown=function(a){d.started=!0,d.x0=a._xs,d.y0=a._ys},this.twotouchdown=function(a){d.started=!0,d.x0=a._x,d.y0=a._y;var b=new dwv.math.Point2D(a._x,a._y),c=new dwv.math.Point2D(a._x1,a._y1);d.line0=new dwv.math.Line(b,c),d.midPoint=d.line0.getMidpoint()},this.mousemove=function(a){if(d.started){var b=a._xs-d.x0,e=a._ys-d.y0;c(b,e),d.x0=a._xs,d.y0=a._ys}},this.twotouchmove=function(c){if(d.started){var e=new dwv.math.Point2D(c._x,c._y),f=new dwv.math.Point2D(c._x1,c._y1),g=new dwv.math.Line(e,f),h=g.getLength()/d.line0.getLength();if(1===h){var i=c._y-d.y0;if(Math.abs(i)<15)return;i>0?a.getView().incrementSliceNb():a.getView().decrementSliceNb()}else{var j=(h-1)/2;Math.abs(j)%.1<=.05&&b(j,d.midPoint.getX(),d.midPoint.getY(),c._xs,c._ys)}}},this.mouseup=function(){d.started&&(d.started=!1)},this.mouseout=function(a){d.mouseup(a)},this.touchstart=function(a){var b=a.targetTouches;1===b.length?d.mousedown(a):2===b.length&&d.twotouchdown(a)},this.touchmove=function(a){var b=a.targetTouches;1===b.length?d.mousemove(a):2===b.length&&d.twotouchmove(a)},this.touchend=function(a){d.mouseup(a)},this.DOMMouseScroll=function(a){var c=-a.detail/30;b(c,a._x,a._y,a._xs,a._ys)},this.mousewheel=function(a){var c=a.wheelDelta/1200;b(c,a._x,a._y,a._xs,a._ys)},this.keydown=function(b){a.onKeydown(b)},this.display=function(a){dwv.gui.displayZoomAndPanHtml(a)}},dwv.tool.ZoomAndPan.prototype.getHelp=function(){return{title:"Zoom/Pan",brief:"The Zoom/Pan tool allows to zoom and pan the image.",mouse:{mouse_wheel:"The mouse wheel is used to zoom the image.",mouse_drag:"A single mouse drag drags the image in the desired direction."},touch:{twotouch_pinch:"A pinch in or out allows to zoom the image.",touch_drag:"A single touch drag drags the image in the desired direction."}}},dwv.tool.ZoomAndPan.prototype.init=function(){};var dwv=dwv||{};dwv.utils=dwv.utils||{},dwv.utils.capitaliseFirstLetter=function(a){var b=a;return a&&(b=a.charAt(0).toUpperCase()+a.slice(1)),b},dwv.utils.cleanString=function(a){var b=a;return a&&(b=a.trim(),b[b.length-1]===String.fromCharCode("u200B")&&(b=b.substring(0,b.length-1))),b},dwv.utils.splitQueryString=function(a){var b={},c=null;if(a&&-1!==(c=a.indexOf("?"))){b.base=a.substr(0,c);var d=a.substr(c+1);b.query=dwv.utils.splitKeyValueString(d)}return b},dwv.utils.splitKeyValueString=function(a){var b={};if(a)for(var c=a.split("&"),d=0;d<c.length;++d){var e=c[d].split("=");b[e[0]]?(b[e[0]]instanceof Array||(b[e[0]]=[b[e[0]]]),b[e[0]].push(e[1])):b[e[0]]=e[1]}return b};