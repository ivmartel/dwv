class LabelingWorker{#t;#n;#i;constructor(){}#e(t){if(t<0)return t;let n=t;for(;this.#n[n]!==n;)n=this.#n[n];let i=t;for(;this.#n[i]!==i;){const t=this.#n[i];this.#n[i]=n,i=t}return n}#s(t,n){this.#n[this.#e(t)]=this.#e(n)}regenerateLabels(t,n,i,e){void 0!==this.#t&&this.#t===e||(this.#t=e,this.#n=new Int32Array(e),this.#i=new Int32Array(e));for(let e=0;e<i[0];e++)for(let s=0;s<i[1];s++)for(let l=0;l<i[2];l++){const i=n[0]*e+n[1]*s+n[2]*l;this.#n[i]=i,this.#i[i]=-1;const o=t[i];if(o>0){const a=i-n[0],r=i-n[1],h=i-n[2];let u=0;e>0&&(u=t[a]);let d=0;s>0&&(d=t[r]);let f=0;l>0&&(f=t[h]);let b=0;e>0&&(b=this.#i[a]);let c=0;s>0&&(c=this.#i[r]);let g=0;l>0&&(g=this.#i[h]),u!==o&&d!==o&&f!==o?this.#i[i]=i:u===o&&d!==o&&f!==o?this.#i[i]=this.#e(b):u!==o&&d===o&&f!==o?this.#i[i]=this.#e(c):u!==o&&d!==o&&f===o?this.#i[i]=this.#e(g):u!==o&&d===o&&f===o?(this.#s(c,g),this.#i[i]=this.#e(c)):u===o&&d!==o&&f===o?(this.#s(b,g),this.#i[i]=this.#e(b)):u===o&&d===o&&f!==o?(this.#s(b,c),this.#i[i]=this.#e(b)):u===o&&d===o&&f===o&&(this.#s(b,c),this.#s(b,g),this.#i[i]=this.#e(b))}}}#l(t,n){const i=new Array(n.length);let e=t,s=0;for(let t=n.length-1;t>0;--t)s=n[t],i[t]=Math.floor(e/s),e-=i[t]*s;return i[0]=e,i}#o(t,n){const i={};for(let e=0;e<this.#i.length;e++){const s=this.#e(this.#i[e]);if(s>=0){const l=this.#l(e,n),o=i[s];void 0===o?i[s]={id:t[e],sum:l,count:1}:(o.sum[0]+=l[0],o.sum[1]+=l[1],o.sum[2]+=l[2],o.count++)}}return Object.values(i).map((t=>{const n=Array(t.sum.length).fill(0);for(let i=0;i<t.sum.length;i++)n[i]=t.sum[i]/t.count;return{id:t.id,centroidIndex:n,count:t.count}}))}calculateFromEvent(t){const n=t.imageBuffer,i=t.unitVectors,e=t.sizes,s=t.totalSize;return this.regenerateLabels(n,i,e,s),this.#o(n,i)}}const labelingWorker=new LabelingWorker;"undefined"==typeof window||window!==window.window?self.addEventListener("message",(function(t){self.postMessage({labels:labelingWorker.calculateFromEvent(t.data)})})):self.labelingWorker=labelingWorker;