<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/tools/windowLevel.js - dwv</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="dwv"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.0beta</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/dwv.App.html">dwv.App</a></li>
                                <li><a href="../classes/dwv.browser.html">dwv.browser</a></li>
                                <li><a href="../classes/dwv.dicom.DataReader.html">dwv.dicom.DataReader</a></li>
                                <li><a href="../classes/dwv.dicom.DicomParser.html">dwv.dicom.DicomParser</a></li>
                                <li><a href="../classes/dwv.gui.html">dwv.gui</a></li>
                                <li><a href="../classes/dwv.gui.base.Draw.html">dwv.gui.base.Draw</a></li>
                                <li><a href="../classes/dwv.gui.base.Filter.html">dwv.gui.base.Filter</a></li>
                                <li><a href="../classes/dwv.gui.base.Livewire.html">dwv.gui.base.Livewire</a></li>
                                <li><a href="../classes/dwv.gui.base.Scroll.html">dwv.gui.base.Scroll</a></li>
                                <li><a href="../classes/dwv.gui.base.Sharpen.html">dwv.gui.base.Sharpen</a></li>
                                <li><a href="../classes/dwv.gui.base.Slider.html">dwv.gui.base.Slider</a></li>
                                <li><a href="../classes/dwv.gui.base.Sobel.html">dwv.gui.base.Sobel</a></li>
                                <li><a href="../classes/dwv.gui.base.Threshold.html">dwv.gui.base.Threshold</a></li>
                                <li><a href="../classes/dwv.gui.base.Toolbox.html">dwv.gui.base.Toolbox</a></li>
                                <li><a href="../classes/dwv.gui.base.WindowLevel.html">dwv.gui.base.WindowLevel</a></li>
                                <li><a href="../classes/dwv.gui.base.ZoomAndPan.html">dwv.gui.base.ZoomAndPan</a></li>
                                <li><a href="../classes/dwv.html.html">dwv.html</a></li>
                                <li><a href="../classes/dwv.html.Layer.html">dwv.html.Layer</a></li>
                                <li><a href="../classes/dwv.html.Style.html">dwv.html.Style</a></li>
                                <li><a href="../classes/dwv.image.html">dwv.image</a></li>
                                <li><a href="../classes/dwv.image.filter.Sharpen.html">dwv.image.filter.Sharpen</a></li>
                                <li><a href="../classes/dwv.image.filter.Sobel.html">dwv.image.filter.Sobel</a></li>
                                <li><a href="../classes/dwv.image.filter.Threshold.html">dwv.image.filter.Threshold</a></li>
                                <li><a href="../classes/dwv.image.Image.html">dwv.image.Image</a></li>
                                <li><a href="../classes/dwv.image.lut.Rescale.html">dwv.image.lut.Rescale</a></li>
                                <li><a href="../classes/dwv.image.lut.Window.html">dwv.image.lut.Window</a></li>
                                <li><a href="../classes/dwv.image.Size.html">dwv.image.Size</a></li>
                                <li><a href="../classes/dwv.image.Spacing.html">dwv.image.Spacing</a></li>
                                <li><a href="../classes/dwv.image.View.html">dwv.image.View</a></li>
                                <li><a href="../classes/dwv.info.html">dwv.info</a></li>
                                <li><a href="../classes/dwv.io.File.html">dwv.io.File</a></li>
                                <li><a href="../classes/dwv.io.Url.html">dwv.io.Url</a></li>
                                <li><a href="../classes/dwv.math.BucketQueue.html">dwv.math.BucketQueue</a></li>
                                <li><a href="../classes/dwv.math.Circle.html">dwv.math.Circle</a></li>
                                <li><a href="../classes/dwv.math.Ellipse.html">dwv.math.Ellipse</a></li>
                                <li><a href="../classes/dwv.math.FastPoint2D.html">dwv.math.FastPoint2D</a></li>
                                <li><a href="../classes/dwv.math.IdGenerator.html">dwv.math.IdGenerator</a></li>
                                <li><a href="../classes/dwv.math.Line.html">dwv.math.Line</a></li>
                                <li><a href="../classes/dwv.math.Path.html">dwv.math.Path</a></li>
                                <li><a href="../classes/dwv.math.Point2D.html">dwv.math.Point2D</a></li>
                                <li><a href="../classes/dwv.math.Rectangle.html">dwv.math.Rectangle</a></li>
                                <li><a href="../classes/dwv.math.ROI.html">dwv.math.ROI</a></li>
                                <li><a href="../classes/dwv.math.Scissors.html">dwv.math.Scissors</a></li>
                                <li><a href="../classes/dwv.tool.html">dwv.tool</a></li>
                                <li><a href="../classes/dwv.tool.ChangeGroupCommand.html">dwv.tool.ChangeGroupCommand</a></li>
                                <li><a href="../classes/dwv.tool.DeleteGroupCommand.html">dwv.tool.DeleteGroupCommand</a></li>
                                <li><a href="../classes/dwv.tool.Draw.html">dwv.tool.Draw</a></li>
                                <li><a href="../classes/dwv.tool.DrawGroupCommand.html">dwv.tool.DrawGroupCommand</a></li>
                                <li><a href="../classes/dwv.tool.EllipseFactory.html">dwv.tool.EllipseFactory</a></li>
                                <li><a href="../classes/dwv.tool.Filter.html">dwv.tool.Filter</a></li>
                                <li><a href="../classes/dwv.tool.filter.Sharpen.html">dwv.tool.filter.Sharpen</a></li>
                                <li><a href="../classes/dwv.tool.filter.Sobel.html">dwv.tool.filter.Sobel</a></li>
                                <li><a href="../classes/dwv.tool.filter.Threshold.html">dwv.tool.filter.Threshold</a></li>
                                <li><a href="../classes/dwv.tool.LineFactory.html">dwv.tool.LineFactory</a></li>
                                <li><a href="../classes/dwv.tool.Livewire.html">dwv.tool.Livewire</a></li>
                                <li><a href="../classes/dwv.tool.MoveGroupCommand.html">dwv.tool.MoveGroupCommand</a></li>
                                <li><a href="../classes/dwv.tool.ProtractorFactory.html">dwv.tool.ProtractorFactory</a></li>
                                <li><a href="../classes/dwv.tool.RectangleFactory.html">dwv.tool.RectangleFactory</a></li>
                                <li><a href="../classes/dwv.tool.RoiFactory.html">dwv.tool.RoiFactory</a></li>
                                <li><a href="../classes/dwv.tool.RunFilterCommand.html">dwv.tool.RunFilterCommand</a></li>
                                <li><a href="../classes/dwv.tool.Scroll.html">dwv.tool.Scroll</a></li>
                                <li><a href="../classes/dwv.tool.ShapeEditor.html">dwv.tool.ShapeEditor</a></li>
                                <li><a href="../classes/dwv.tool.ToolBox.html">dwv.tool.ToolBox</a></li>
                                <li><a href="../classes/dwv.tool.UndoStack.html">dwv.tool.UndoStack</a></li>
                                <li><a href="../classes/dwv.tool.WindowLevel.html">dwv.tool.WindowLevel</a></li>
                                <li><a href="../classes/dwv.tool.ZoomAndPan.html">dwv.tool.ZoomAndPan</a></li>
                                <li><a href="../classes/dwv.ToolBoxController.html">dwv.ToolBoxController</a></li>
                                <li><a href="../classes/dwv.utils.html">dwv.utils</a></li>
                                <li><a href="../classes/dwv.ViewController.html">dwv.ViewController</a></li>
                                <li><a href="../classes/image.ImageFactory.html">image.ImageFactory</a></li>
                                <li><a href="../classes/image.ViewFactory.html">image.ViewFactory</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/browser.html">browser</a></li>
                                <li><a href="../modules/dicom.html">dicom</a></li>
                                <li><a href="../modules/gui.html">gui</a></li>
                                <li><a href="../modules/html.html">html</a></li>
                                <li><a href="../modules/image.html">image</a></li>
                                <li><a href="../modules/info.html">info</a></li>
                                <li><a href="../modules/io.html">io</a></li>
                                <li><a href="../modules/math.html">math</a></li>
                                <li><a href="../modules/tool.html">tool</a></li>
                                <li><a href="../modules/utils.html">utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/tools/windowLevel.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /** 
                         * Tool module.
                         * @module tool
                         */
                        var dwv = dwv || {};
                        /**
                         * Namespace for tool functions.
                         * @class tool
                         * @namespace dwv
                         * @static
                         */
                        dwv.tool = dwv.tool || {};
                        
                        // Default colour maps.
                        dwv.tool.colourMaps = {
                            &quot;plain&quot;: dwv.image.lut.plain,
                            &quot;invplain&quot;: dwv.image.lut.invPlain,
                            &quot;rainbow&quot;: dwv.image.lut.rainbow,
                            &quot;hot&quot;: dwv.image.lut.hot,
                            &quot;test&quot;: dwv.image.lut.test
                        };
                        // Default window level presets.
                        dwv.tool.defaultpresets = {};
                        dwv.tool.defaultpresets.CT = {
                            &quot;mediastinum&quot;: {&quot;center&quot;: 40, &quot;width&quot;: 400},
                            &quot;lung&quot;: {&quot;center&quot;: -500, &quot;width&quot;: 1500},
                            &quot;bone&quot;: {&quot;center&quot;: 500, &quot;width&quot;: 2000},
                        };
                        dwv.tool.defaultpresets.CTextra = {
                            &quot;brain&quot;: {&quot;center&quot;: 40, &quot;width&quot;: 80},
                            &quot;head&quot;: {&quot;center&quot;: 90, &quot;width&quot;: 350}
                        };
                        
                        /**
                         * WindowLevel tool: handle window/level related events.
                         * @class WindowLevel
                         * @namespace dwv.tool
                         * @constructor
                         * @param {Object} app The associated application.
                         */
                        dwv.tool.WindowLevel = function(app)
                        {
                            /**
                             * Closure to self: to be used by event handlers.
                             * @property self
                             * @private
                             * @type WindowLevel
                             */
                            var self = this;
                            /**
                             * WindowLevel GUI.
                             * @property gui
                             * @type Object
                             */
                            var gui = new dwv.gui.WindowLevel(app);
                            /**
                             * Interaction start flag.
                             * @property started
                             * @type Boolean
                             */
                            this.started = false;
                            
                            /**
                             * Handle mouse down event.
                             * @method mousedown
                             * @param {Object} event The mouse down event.
                             */
                            this.mousedown = function(event){
                                // set start flag
                                self.started = true;
                                // store initial position
                                self.x0 = event._x;
                                self.y0 = event._y;
                                // update GUI
                                app.setCurrentPostion(event._x, event._y);
                            };
                            
                            /**
                             * Handle mouse move event.
                             * @method mousemove
                             * @param {Object} event The mouse move event.
                             */
                            this.mousemove = function(event){
                                // check start flag
                                if( !self.started ) {
                                    return;
                                }
                                // difference to last position
                                var diffX = event._x - self.x0;
                                var diffY = self.y0 - event._y;
                                // calculate new window level
                                var windowCenter = parseInt(app.getView().getWindowLut().getCenter(), 10) + diffY;
                                var windowWidth = parseInt(app.getView().getWindowLut().getWidth(), 10) + diffX;
                                // update GUI
                                app.getViewController().setWindowLevel(windowCenter,windowWidth);
                                // store position
                                self.x0 = event._x;
                                self.y0 = event._y;
                            };
                            
                            /**
                             * Handle mouse up event.
                             * @method mouseup
                             * @param {Object} event The mouse up event.
                             */
                            this.mouseup = function(/*event*/){
                                // set start flag
                                if( self.started ) {
                                    self.started = false;
                                    // store the manual preset
                                    var windowCenter = parseInt(app.getView().getWindowLut().getCenter(), 10);
                                    var windowWidth = parseInt(app.getView().getWindowLut().getWidth(), 10);
                                    app.getPresets().manual = {&quot;center&quot;: windowCenter, &quot;width&quot;: windowWidth};
                                    // update gui
                                    gui.initialise();
                                    // set selected
                                    dwv.gui.setSelected(&quot;presetSelect&quot;, &quot;Manual&quot;);
                                }
                            };
                            
                            /**
                             * Handle mouse out event.
                             * @method mouseout
                             * @param {Object} event The mouse out event.
                             */
                            this.mouseout = function(event){
                                // treat as mouse up
                                self.mouseup(event);
                            };
                            
                            /**
                             * Handle touch start event.
                             * @method touchstart
                             * @param {Object} event The touch start event.
                             */
                            this.touchstart = function(event){
                                self.mousedown(event);
                            };
                            
                            /**
                             * Handle touch move event.
                             * @method touchmove
                             * @param {Object} event The touch move event.
                             */
                            this.touchmove = function(event){
                                self.mousemove(event);
                            };
                            
                            /**
                             * Handle touch end event.
                             * @method touchend
                             * @param {Object} event The touch end event.
                             */
                            this.touchend = function(event){
                                self.mouseup(event);
                            };
                            
                            /**
                             * Handle double click event.
                             * @method dblclick
                             * @param {Object} event The double click event.
                             */
                            this.dblclick = function(event){
                                // update GUI
                                app.getViewController().setWindowLevel(
                                    parseInt(app.getImage().getRescaledValue(event._x, event._y, app.getView().getCurrentPosition().k), 10),
                                    parseInt(app.getView().getWindowLut().getWidth(), 10) );    
                            };
                            
                            /**
                             * Handle key down event.
                             * @method keydown
                             * @param {Object} event The key down event.
                             */
                            this.keydown = function(event){
                                // let the app handle it
                                app.onKeydown(event);
                            };
                            
                            /**
                             * Setup the tool GUI.
                             * @method setup
                             */
                            this.setup = function ()
                            {
                                gui.setup();
                            };
                            
                            /**
                             * Display the tool.
                             * @method display
                             * @param {Boolean} bool The flag to display or not.
                             */
                            this.display = function (bool)
                            {
                                if( app.getImage().getPhotometricInterpretation().match(/MONOCHROME/) !== null ) {
                                    gui.display(bool);
                                }
                                else {
                                    gui.display(false);
                                }
                            };
                            
                            /**
                             * Initialise the tool.
                             * @method init
                             */
                            this.init = function() {
                                app.updatePresets(true);
                                gui.initialise();
                            };
                        }; // WindowLevel class
                        
                        /**
                         * Help for this tool.
                         * @method getHelp
                         * @returns {Object} The help content.
                         */
                        dwv.tool.WindowLevel.prototype.getHelp = function()
                        {
                            return {
                                &#x27;title&#x27;: &quot;Window/Level&quot;,
                                &#x27;brief&#x27;: &quot;Changes the Window and Level of the image.&quot;,
                                &#x27;mouse&#x27;: {
                                    &#x27;mouse_drag&#x27;: &quot;A single mouse drag changes the window in the horizontal direction and the level in the vertical one.&quot;,
                                    &#x27;double_click&#x27;: &quot;A double click will center the window and level on the clicked intensity.&quot;,
                                },
                                &#x27;touch&#x27;: {
                                    &#x27;touch_drag&#x27;: &quot;A single touch drag changes the window in the horizontal direction and the level in the vertical one.&quot;,
                                }
                            };
                        };
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
