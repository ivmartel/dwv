{"version":3,"file":"assets/workers/jpegloss.worker.min.js","mappings":"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","sources":["webpack://dwv/./src/decoders/rii-mango/lossless.js","webpack://dwv/./src/decoders/rii-mango/jpegloss.worker.js"],"sourcesContent":["/* eslint-disable */\n\nexport var jpeg = jpeg || {};\njpeg.lossless = jpeg.lossless || {};\n\n/**\n * Modified for dwv:\n * - export root var,\n * - remove old style import/export and\n *   related (for ex 'use strict').\n */\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n\n\n/*** Constructor ***/\njpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || function () {\n    this.hSamp = 0; // Horizontal sampling factor\n    this.quantTableSel = 0; // Quantization table destination selector\n    this.vSamp = 0; // Vertical\n};\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n\n\n/*** Constructor ***/\njpeg.lossless.DataStream = jpeg.lossless.DataStream || function (data, offset, length) {\n    // Note: DataView is much slower than Int8Array\n    // this.buffer = new DataView(data, offset, length);\n    this.buffer = new Uint8Array(data, offset, length);\n    this.index = 0;\n};\n\n\n\njpeg.lossless.DataStream.prototype.get16 = function () {\n    // var value = this.buffer.getUint16(this.index, false);\n    var value = (this.buffer[this.index] << 8) + this.buffer[this.index + 1]; // DataView is big-endian by default\n    this.index += 2;\n    return value;\n};\n\n\n\njpeg.lossless.DataStream.prototype.get8 = function () {\n    // var value = this.buffer.getUint8(this.index);\n    var value = this.buffer[this.index];\n    this.index += 1;\n    return value;\n};\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n// \"use strict\";\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n// jpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || ((typeof require !== 'undefined') ? require('./huffman-table.js') : null);\n// jpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || ((typeof require !== 'undefined') ? require('./quantization-table.js') : null);\n// jpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || ((typeof require !== 'undefined') ? require('./scan-header.js') : null);\n// jpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || ((typeof require !== 'undefined') ? require('./frame-header.js') : null);\n// jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\n\n\n/*** Constructor ***/\n\n/**\n * The Decoder constructor.\n * @property {number} xDim - size of x dimension\n * @property {number} yDim - size of y dimension\n * @property {number} numComp - number of components\n * @property {number} numBytes - number of bytes per component\n * @type {Function}\n */\njpeg.lossless.Decoder = jpeg.lossless.Decoder || function (buffer, numBytes) {\n    this.buffer = buffer;\n    this.frame = new jpeg.lossless.FrameHeader();\n    this.huffTable = new jpeg.lossless.HuffmanTable();\n    this.quantTable = new jpeg.lossless.QuantizationTable();\n    this.scan = new jpeg.lossless.ScanHeader();\n    this.DU = jpeg.lossless.Utils.createArray(10, 4, 64); // at most 10 data units in a MCU, at most 4 data units in one component\n    this.HuffTab = jpeg.lossless.Utils.createArray(4, 2, 50 * 256);\n    this.IDCT_Source = [];\n    this.nBlock = []; // number of blocks in the i-th Comp in a scan\n    this.acTab = jpeg.lossless.Utils.createArray(10, 1); // ac HuffTab for the i-th Comp in a scan\n    this.dcTab = jpeg.lossless.Utils.createArray(10, 1); // dc HuffTab for the i-th Comp in a scan\n    this.qTab = jpeg.lossless.Utils.createArray(10, 1); // quantization table for the i-th Comp in a scan\n    this.marker = 0;\n    this.markerIndex = 0;\n    this.numComp = 0;\n    this.restartInterval = 0;\n    this.selection = 0;\n    this.xDim = 0;\n    this.yDim = 0;\n    this.xLoc = 0;\n    this.yLoc = 0;\n    this.numBytes = 0;\n    this.outputData = null;\n    this.restarting = false;\n    this.mask = 0;\n\n    if (typeof numBytes !== \"undefined\") {\n        this.numBytes = numBytes;\n    }\n};\n\n\n/*** Static Pseudo-constants ***/\n\njpeg.lossless.Decoder.IDCT_P = [0, 5, 40, 16, 45, 2, 7, 42, 21, 56, 8, 61, 18, 47, 1, 4, 41, 23, 58, 13, 32, 24, 37, 10, 63, 17, 44, 3, 6, 43, 20,\n    57, 15, 34, 29, 48, 53, 26, 39, 9, 60, 19, 46, 22, 59, 12, 33, 31, 50, 55, 25, 36, 11, 62, 14, 35, 28, 49, 52, 27, 38, 30, 51, 54];\njpeg.lossless.Decoder.TABLE = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53,\n    10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63];\njpeg.lossless.Decoder.MAX_HUFFMAN_SUBTREE = 50;\njpeg.lossless.Decoder.MSB = 0x80000000;\njpeg.lossless.Decoder.RESTART_MARKER_BEGIN = 0xFFD0;\njpeg.lossless.Decoder.RESTART_MARKER_END = 0xFFD7;\n\n/*** Prototype Methods ***/\n\n/**\n * Returns decompressed data.\n * @param {ArrayBuffer} buffer\n * @param {number} [offset]\n * @param {number} [length]\n * @returns {ArrayBufer}\n */\njpeg.lossless.Decoder.prototype.decompress = function (buffer, offset, length) {\n    return this.decode(buffer, offset, length).buffer;\n};\n\n\n\njpeg.lossless.Decoder.prototype.decode = function (buffer, offset, length, numBytes) {\n    /*jslint bitwise: true */\n\n    var current, scanNum = 0, pred = [], i, compN, temp = [], index = [], mcuNum;\n\n    if (typeof buffer !== \"undefined\") {\n        this.buffer = buffer;\n    }\n\n    if (typeof numBytes !== \"undefined\") {\n        this.numBytes = numBytes;\n    }\n\n    this.stream = new jpeg.lossless.DataStream(this.buffer, offset, length);\n    this.buffer = null;\n\n    this.xLoc = 0;\n    this.yLoc = 0;\n    current = this.stream.get16();\n\n    if (current !== 0xFFD8) { // SOI\n        throw new Error(\"Not a JPEG file\");\n    }\n\n    current = this.stream.get16();\n\n    while ((((current >> 4) !== 0x0FFC) || (current === 0xFFC4))) { // SOF 0~15\n        switch (current) {\n            case 0xFFC4: // DHT\n                this.huffTable.read(this.stream, this.HuffTab);\n                break;\n            case 0xFFCC: // DAC\n                throw new Error(\"Program doesn't support arithmetic coding. (format throw new IOException)\");\n            case 0xFFDB:\n                this.quantTable.read(this.stream, jpeg.lossless.Decoder.TABLE);\n                break;\n            case 0xFFDD:\n                this.restartInterval = this.readNumber();\n                break;\n            case 0xFFE0:\n            case 0xFFE1:\n            case 0xFFE2:\n            case 0xFFE3:\n            case 0xFFE4:\n            case 0xFFE5:\n            case 0xFFE6:\n            case 0xFFE7:\n            case 0xFFE8:\n            case 0xFFE9:\n            case 0xFFEA:\n            case 0xFFEB:\n            case 0xFFEC:\n            case 0xFFED:\n            case 0xFFEE:\n            case 0xFFEF:\n                this.readApp();\n                break;\n            case 0xFFFE:\n                this.readComment();\n                break;\n            default:\n                if ((current >> 8) !== 0xFF) {\n                    throw new Error(\"ERROR: format throw new IOException! (decode)\");\n                }\n        }\n\n        current = this.stream.get16();\n    }\n\n    if ((current < 0xFFC0) || (current > 0xFFC7)) {\n        throw new Error(\"ERROR: could not handle arithmetic code!\");\n    }\n\n    this.frame.read(this.stream);\n    current = this.stream.get16();\n\n    do {\n        while (current !== 0x0FFDA) { // SOS\n            switch (current) {\n                case 0xFFC4: // DHT\n                    this.huffTable.read(this.stream, this.HuffTab);\n                    break;\n                case 0xFFCC: // DAC\n                    throw new Error(\"Program doesn't support arithmetic coding. (format throw new IOException)\");\n                case 0xFFDB:\n                    this.quantTable.read(this.stream, jpeg.lossless.Decoder.TABLE);\n                    break;\n                case 0xFFDD:\n                    this.restartInterval = this.readNumber();\n                    break;\n                case 0xFFE0:\n                case 0xFFE1:\n                case 0xFFE2:\n                case 0xFFE3:\n                case 0xFFE4:\n                case 0xFFE5:\n                case 0xFFE6:\n                case 0xFFE7:\n                case 0xFFE8:\n                case 0xFFE9:\n                case 0xFFEA:\n                case 0xFFEB:\n                case 0xFFEC:\n                case 0xFFED:\n                case 0xFFEE:\n                case 0xFFEF:\n                    this.readApp();\n                    break;\n                case 0xFFFE:\n                    this.readComment();\n                    break;\n                default:\n                    if ((current >> 8) !== 0xFF) {\n                        throw new Error(\"ERROR: format throw new IOException! (Parser.decode)\");\n                    }\n            }\n\n            current = this.stream.get16();\n        }\n\n        this.precision = this.frame.precision;\n        this.components = this.frame.components;\n\n        if (!this.numBytes) {\n            this.numBytes = parseInt(Math.ceil(this.precision / 8));\n        }\n\n        if (this.numBytes == 1) {\n            this.mask = 0xFF;\n        } else {\n            this.mask = 0xFFFF;\n        }\n\n        this.scan.read(this.stream);\n        this.numComp = this.scan.numComp;\n        this.selection = this.scan.selection;\n\n        if (this.numBytes === 1) {\n            if (this.numComp === 3) {\n                this.getter = this.getValueRGB;\n                this.setter = this.setValueRGB;\n                this.output = this.outputRGB;\n            } else {\n                this.getter = this.getValue8;\n                this.setter = this.setValue8;\n                this.output = this.outputSingle;\n            }\n        } else {\n            this.getter = this.getValue16;\n            this.setter = this.setValue16;\n            this.output = this.outputSingle;\n        }\n\n        switch (this.selection) {\n            case 2:\n                this.selector = this.select2;\n                break;\n            case 3:\n                this.selector = this.select3;\n                break;\n            case 4:\n                this.selector = this.select4;\n                break;\n            case 5:\n                this.selector = this.select5;\n                break;\n            case 6:\n                this.selector = this.select6;\n                break;\n            case 7:\n                this.selector = this.select7;\n                break;\n            default:\n                this.selector = this.select1;\n                break;\n        }\n\n        this.scanComps = this.scan.components;\n        this.quantTables = this.quantTable.quantTables;\n\n        for (i = 0; i < this.numComp; i+=1) {\n            compN = this.scanComps[i].scanCompSel;\n            this.qTab[i] = this.quantTables[this.components[compN].quantTableSel];\n            this.nBlock[i] = this.components[compN].vSamp * this.components[compN].hSamp;\n            this.dcTab[i] = this.HuffTab[this.scanComps[i].dcTabSel][0];\n            this.acTab[i] = this.HuffTab[this.scanComps[i].acTabSel][1];\n        }\n\n        this.xDim = this.frame.dimX;\n        this.yDim = this.frame.dimY;\n        if (this.numBytes == 1) {\n            this.outputData = new Uint8Array(new ArrayBuffer(this.xDim * this.yDim * this.numBytes * this.numComp));\n        } else {\n            this.outputData = new Uint16Array(new ArrayBuffer(this.xDim * this.yDim * this.numBytes * this.numComp));\n        }\n\n        scanNum+=1;\n\n        while (true) { // Decode one scan\n            temp[0] = 0;\n            index[0] = 0;\n\n            for (i = 0; i < 10; i+=1) {\n                pred[i] = (1 << (this.precision - 1));\n            }\n\n            if (this.restartInterval === 0) {\n                current = this.decodeUnit(pred, temp, index);\n\n                while ((current === 0) && ((this.xLoc < this.xDim) && (this.yLoc < this.yDim))) {\n                    this.output(pred);\n                    current = this.decodeUnit(pred, temp, index);\n                }\n\n                break; //current=MARKER\n            }\n\n            for (mcuNum = 0; mcuNum < this.restartInterval; mcuNum+=1) {\n                this.restarting = (mcuNum == 0);\n                current = this.decodeUnit(pred, temp, index);\n                this.output(pred);\n\n                if (current !== 0) {\n                    break;\n                }\n            }\n\n            if (current === 0) {\n                if (this.markerIndex !== 0) {\n                    current = (0xFF00 | this.marker);\n                    this.markerIndex = 0;\n                } else {\n                    current = this.stream.get16();\n                }\n            }\n\n            if (!((current >= jpeg.lossless.Decoder.RESTART_MARKER_BEGIN) &&\n                (current <= jpeg.lossless.Decoder.RESTART_MARKER_END))) {\n                break; //current=MARKER\n            }\n        }\n\n        if ((current === 0xFFDC) && (scanNum === 1)) { //DNL\n            this.readNumber();\n            current = this.stream.get16();\n        }\n    } while ((current !== 0xFFD9) && ((this.xLoc < this.xDim) && (this.yLoc < this.yDim)) && (scanNum === 0));\n\n    return this.outputData;\n};\n\n\n\njpeg.lossless.Decoder.prototype.decodeUnit = function (prev, temp, index) {\n    if (this.numComp == 1) {\n        return this.decodeSingle(prev, temp, index);\n    } else if (this.numComp == 3) {\n        return this.decodeRGB(prev, temp, index);\n    } else {\n        return -1;\n    }\n};\n\n\n\njpeg.lossless.Decoder.prototype.select1 = function (compOffset) {\n    return this.getPreviousX(compOffset);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select2 = function (compOffset) {\n    return this.getPreviousY(compOffset);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select3 = function (compOffset) {\n    return this.getPreviousXY(compOffset);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select4 = function (compOffset) {\n    return (this.getPreviousX(compOffset) + this.getPreviousY(compOffset)) - this.getPreviousXY(compOffset);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select5 = function (compOffset) {\n    return this.getPreviousX(compOffset) + ((this.getPreviousY(compOffset) - this.getPreviousXY(compOffset)) >> 1);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select6 = function (compOffset) {\n    return this.getPreviousY(compOffset) + ((this.getPreviousX(compOffset) - this.getPreviousXY(compOffset)) >> 1);\n};\n\n\n\njpeg.lossless.Decoder.prototype.select7 = function (compOffset) {\n    return ((this.getPreviousX(compOffset) + this.getPreviousY(compOffset)) / 2);\n};\n\n\n\njpeg.lossless.Decoder.prototype.decodeRGB = function (prev, temp, index) {\n    /*jslint bitwise: true */\n\n    var value, actab, dctab, qtab, ctrC, i, k, j;\n\n    prev[0] = this.selector(0);\n    prev[1] = this.selector(1);\n    prev[2] = this.selector(2);\n\n    for (ctrC = 0; ctrC < this.numComp; ctrC+=1) {\n        qtab = this.qTab[ctrC];\n        actab = this.acTab[ctrC];\n        dctab = this.dcTab[ctrC];\n        for (i = 0; i < this.nBlock[ctrC]; i+=1) {\n            for (k = 0; k < this.IDCT_Source.length; k+=1) {\n                this.IDCT_Source[k] = 0;\n            }\n\n            value = this.getHuffmanValue(dctab, temp, index);\n\n            if (value >= 0xFF00) {\n                return value;\n            }\n\n            prev[ctrC] = this.IDCT_Source[0] = prev[ctrC] + this.getn(index, value, temp, index);\n            this.IDCT_Source[0] *= qtab[0];\n\n            for (j = 1; j < 64; j+=1) {\n                value = this.getHuffmanValue(actab, temp, index);\n\n                if (value >= 0xFF00) {\n                    return value;\n                }\n\n                j += (value >> 4);\n\n                if ((value & 0x0F) === 0) {\n                    if ((value >> 4) === 0) {\n                        break;\n                    }\n                } else {\n                    this.IDCT_Source[jpeg.lossless.Decoder.IDCT_P[j]] = this.getn(index, value & 0x0F, temp, index) * qtab[j];\n                }\n            }\n        }\n    }\n\n    return 0;\n};\n\n\n\njpeg.lossless.Decoder.prototype.decodeSingle = function (prev, temp, index) {\n    /*jslint bitwise: true */\n\n    var value, i, n, nRestart;\n\n    if (this.restarting) {\n        this.restarting = false;\n        prev[0] = (1 << (this.frame.precision - 1));\n    } else {\n        prev[0] = this.selector();\n    }\n\n    for (i = 0; i < this.nBlock[0]; i+=1) {\n        value = this.getHuffmanValue(this.dcTab[0], temp, index);\n        if (value >= 0xFF00) {\n            return value;\n        }\n\n        n = this.getn(prev, value, temp, index);\n        nRestart = (n >> 8);\n\n        if ((nRestart >= jpeg.lossless.Decoder.RESTART_MARKER_BEGIN) && (nRestart <= jpeg.lossless.Decoder.RESTART_MARKER_END)) {\n            return nRestart;\n        }\n\n        prev[0] += n;\n    }\n\n    return 0;\n};\n\n\n\n//\tHuffman table for fast search: (HuffTab) 8-bit Look up table 2-layer search architecture, 1st-layer represent 256 node (8 bits) if codeword-length > 8\n//\tbits, then the entry of 1st-layer = (# of 2nd-layer table) | MSB and it is stored in the 2nd-layer Size of tables in each layer are 256.\n//\tHuffTab[*][*][0-256] is always the only 1st-layer table.\n//\n//\tAn entry can be: (1) (# of 2nd-layer table) | MSB , for code length > 8 in 1st-layer (2) (Code length) << 8 | HuffVal\n//\n//\tHuffmanValue(table   HuffTab[x][y] (ex) HuffmanValue(HuffTab[1][0],...)\n//\t                ):\n//\t    return: Huffman Value of table\n//\t            0xFF?? if it receives a MARKER\n//\t    Parameter:  table   HuffTab[x][y] (ex) HuffmanValue(HuffTab[1][0],...)\n//\t                temp    temp storage for remainded bits\n//\t                index   index to bit of temp\n//\t                in      FILE pointer\n//\t    Effect:\n//\t        temp  store new remainded bits\n//\t        index change to new index\n//\t        in    change to new position\n//\t    NOTE:\n//\t      Initial by   temp=0; index=0;\n//\t    NOTE: (explain temp and index)\n//\t      temp: is always in the form at calling time or returning time\n//\t       |  byte 4  |  byte 3  |  byte 2  |  byte 1  |\n//\t       |     0    |     0    | 00000000 | 00000??? |  if not a MARKER\n//\t                                               ^index=3 (from 0 to 15)\n//\t                                               321\n//\t    NOTE (marker and marker_index):\n//\t      If get a MARKER from 'in', marker=the low-byte of the MARKER\n//\t        and marker_index=9\n//\t      If marker_index=9 then index is always > 8, or HuffmanValue()\n//\t        will not be called\njpeg.lossless.Decoder.prototype.getHuffmanValue = function (table, temp, index) {\n    /*jslint bitwise: true */\n\n    var code, input, mask;\n    mask = 0xFFFF;\n\n    if (index[0] < 8) {\n        temp[0] <<= 8;\n        input = this.stream.get8();\n        if (input === 0xFF) {\n            this.marker = this.stream.get8();\n            if (this.marker !== 0) {\n                this.markerIndex = 9;\n            }\n        }\n        temp[0] |= input;\n    } else {\n        index[0] -= 8;\n    }\n\n    code = table[temp[0] >> index[0]];\n\n    if ((code & jpeg.lossless.Decoder.MSB) !== 0) {\n        if (this.markerIndex !== 0) {\n            this.markerIndex = 0;\n            return 0xFF00 | this.marker;\n        }\n\n        temp[0] &= (mask >> (16 - index[0]));\n        temp[0] <<= 8;\n        input = this.stream.get8();\n\n        if (input === 0xFF) {\n            this.marker = this.stream.get8();\n            if (this.marker !== 0) {\n                this.markerIndex = 9;\n            }\n        }\n\n        temp[0] |= input;\n        code = table[((code & 0xFF) * 256) + (temp[0] >> index[0])];\n        index[0] += 8;\n    }\n\n    index[0] += 8 - (code >> 8);\n\n    if (index[0] < 0) {\n        throw new Error(\"index=\" + index[0] + \" temp=\" + temp[0] + \" code=\" + code + \" in HuffmanValue()\");\n    }\n\n    if (index[0] < this.markerIndex) {\n        this.markerIndex = 0;\n        return 0xFF00 | this.marker;\n    }\n\n    temp[0] &= (mask >> (16 - index[0]));\n    return code & 0xFF;\n};\n\n\n\njpeg.lossless.Decoder.prototype.getn = function (PRED, n, temp, index) {\n    /*jslint bitwise: true */\n\n    var result, one, n_one, mask, input;\n    one = 1;\n    n_one = -1;\n    mask = 0xFFFF;\n\n    if (n === 0) {\n        return 0;\n    }\n\n    if (n === 16) {\n        if (PRED[0] >= 0) {\n            return -32768;\n        } else {\n            return 32768;\n        }\n    }\n\n    index[0] -= n;\n\n    if (index[0] >= 0) {\n        if ((index[0] < this.markerIndex) && !this.isLastPixel()) { // this was corrupting the last pixel in some cases\n            this.markerIndex = 0;\n            return (0xFF00 | this.marker) << 8;\n        }\n\n        result = temp[0] >> index[0];\n        temp[0] &= (mask >> (16 - index[0]));\n    } else {\n        temp[0] <<= 8;\n        input = this.stream.get8();\n\n        if (input === 0xFF) {\n            this.marker = this.stream.get8();\n            if (this.marker !== 0) {\n                this.markerIndex = 9;\n            }\n        }\n\n        temp[0] |= input;\n        index[0] += 8;\n\n        if (index[0] < 0) {\n            if (this.markerIndex !== 0) {\n                this.markerIndex = 0;\n                return (0xFF00 | this.marker) << 8;\n            }\n\n            temp[0] <<= 8;\n            input = this.stream.get8();\n\n            if (input === 0xFF) {\n                this.marker = this.stream.get8();\n                if (this.marker !== 0) {\n                    this.markerIndex = 9;\n                }\n            }\n\n            temp[0] |= input;\n            index[0] += 8;\n        }\n\n        if (index[0] < 0) {\n            throw new Error(\"index=\" + index[0] + \" in getn()\");\n        }\n\n        if (index[0] < this.markerIndex) {\n            this.markerIndex = 0;\n            return (0xFF00 | this.marker) << 8;\n        }\n\n        result = temp[0] >> index[0];\n        temp[0] &= (mask >> (16 - index[0]));\n    }\n\n    if (result < (one << (n - 1))) {\n        result += (n_one << n) + 1;\n    }\n\n    return result;\n};\n\n\n\njpeg.lossless.Decoder.prototype.getPreviousX = function (compOffset) {\n    /*jslint bitwise: true */\n\n    if (this.xLoc > 0) {\n        return this.getter((((this.yLoc * this.xDim) + this.xLoc) - 1), compOffset);\n    } else if (this.yLoc > 0) {\n        return this.getPreviousY(compOffset);\n    } else {\n        return (1 << (this.frame.precision - 1));\n    }\n};\n\n\n\njpeg.lossless.Decoder.prototype.getPreviousXY = function (compOffset) {\n    /*jslint bitwise: true */\n\n    if ((this.xLoc > 0) && (this.yLoc > 0)) {\n        return this.getter(((((this.yLoc - 1) * this.xDim) + this.xLoc) - 1), compOffset);\n    } else {\n        return this.getPreviousY(compOffset);\n    }\n};\n\n\n\njpeg.lossless.Decoder.prototype.getPreviousY = function (compOffset) {\n    /*jslint bitwise: true */\n\n    if (this.yLoc > 0) {\n        return this.getter((((this.yLoc - 1) * this.xDim) + this.xLoc), compOffset);\n    } else {\n        return this.getPreviousX(compOffset);\n    }\n};\n\n\n\njpeg.lossless.Decoder.prototype.isLastPixel = function () {\n    return (this.xLoc === (this.xDim - 1)) && (this.yLoc === (this.yDim - 1));\n};\n\n\n\njpeg.lossless.Decoder.prototype.outputSingle = function (PRED) {\n    if ((this.xLoc < this.xDim) && (this.yLoc < this.yDim)) {\n        this.setter((((this.yLoc * this.xDim) + this.xLoc)), this.mask & PRED[0]);\n\n        this.xLoc+=1;\n\n        if (this.xLoc >= this.xDim) {\n            this.yLoc+=1;\n            this.xLoc = 0;\n        }\n    }\n};\n\n\n\njpeg.lossless.Decoder.prototype.outputRGB = function (PRED) {\n    var offset = ((this.yLoc * this.xDim) + this.xLoc);\n\n    if ((this.xLoc < this.xDim) && (this.yLoc < this.yDim)) {\n        this.setter(offset, PRED[0], 0);\n        this.setter(offset, PRED[1], 1);\n        this.setter(offset, PRED[2], 2);\n\n        this.xLoc+=1;\n\n        if (this.xLoc >= this.xDim) {\n            this.yLoc+=1;\n            this.xLoc = 0;\n        }\n    }\n};\n\njpeg.lossless.Decoder.prototype.setValue8 = function (index, val) {\n    this.outputData[index] = val;\n};\n\njpeg.lossless.Decoder.prototype.getValue8 = function (index) {\n    return this.outputData[index]; // mask should not be necessary because outputData is either Int8Array or Int16Array\n};\n\nvar littleEndian = (function() {\n    var buffer = new ArrayBuffer(2);\n    new DataView(buffer).setInt16(0, 256, true /* littleEndian */);\n    // Int16Array uses the platform's endianness.\n    return new Int16Array(buffer)[0] === 256;\n})();\n\nif (littleEndian) {\n    // just reading from an array is fine then. Int16Array will use platform endianness.\n    jpeg.lossless.Decoder.prototype.setValue16 = jpeg.lossless.Decoder.prototype.setValue8;\n    jpeg.lossless.Decoder.prototype.getValue16 = jpeg.lossless.Decoder.prototype.getValue8;\n}\nelse {\n    // If platform is big-endian, we will need to convert to little-endian\n    jpeg.lossless.Decoder.prototype.setValue16 = function (index, val) {\n        this.outputData[index] = ((val & 0xFF) << 8) | ((val >> 8) & 0xFF);\n    };\n\n    jpeg.lossless.Decoder.prototype.getValue16 = function (index) {\n        var val = this.outputData[index];\n        return ((val & 0xFF) << 8) | ((val >> 8) & 0xFF);\n    };\n}\n\njpeg.lossless.Decoder.prototype.setValueRGB = function (index, val, compOffset) {\n    // this.outputData.setUint8(index * 3 + compOffset, val);\n    this.outputData[index * 3 + compOffset] = val;\n};\n\njpeg.lossless.Decoder.prototype.getValueRGB = function (index, compOffset) {\n    // return this.outputData.getUint8(index * 3 + compOffset);\n    return this.outputData[index * 3 + compOffset];\n};\n\n\n\njpeg.lossless.Decoder.prototype.readApp = function() {\n    var count = 0, length = this.stream.get16();\n    count += 2;\n\n    while (count < length) {\n        this.stream.get8();\n        count+=1;\n    }\n\n    return length;\n};\n\n\n\njpeg.lossless.Decoder.prototype.readComment = function () {\n    var sb = \"\", count = 0, length;\n\n    length = this.stream.get16();\n    count += 2;\n\n    while (count < length) {\n        sb += this.stream.get8();\n        count+=1;\n    }\n\n    return sb;\n};\n\n\n\njpeg.lossless.Decoder.prototype.readNumber = function() {\n    var Ld = this.stream.get16();\n\n    if (Ld !== 4) {\n        throw new Error(\"ERROR: Define number format throw new IOException [Ld!=4]\");\n    }\n\n    return this.stream.get16();\n};\n\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n// jpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || ((typeof require !== 'undefined') ? require('./component-spec.js') : null);\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n\n\n/*** Constructor ***/\njpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || function () {\n    this.components = []; // Components\n    this.dimX = 0; // Number of samples per line\n    this.dimY = 0; // Number of lines\n    this.numComp = 0; // Number of component in the frame\n    this.precision = 0; // Sample Precision (from the original image)\n};\n\n\n\n/*** Prototype Methods ***/\n\njpeg.lossless.FrameHeader.prototype.read = function (data) {\n    /*jslint bitwise: true */\n\n    var count = 0, length, i, c, temp;\n\n    length = data.get16();\n    count += 2;\n\n    this.precision = data.get8();\n    count+=1;\n\n    this.dimY = data.get16();\n    count += 2;\n\n    this.dimX = data.get16();\n    count += 2;\n\n    this.numComp = data.get8();\n    count+=1;\n    for (i = 1; i <= this.numComp; i+=1) {\n        if (count > length) {\n            throw new Error(\"ERROR: frame format error\");\n        }\n\n        c = data.get8();\n        count+=1;\n\n        if (count >= length) {\n            throw new Error(\"ERROR: frame format error [c>=Lf]\");\n        }\n\n        temp = data.get8();\n        count+=1;\n\n        if (!this.components[c]) {\n            this.components[c] = new jpeg.lossless.ComponentSpec();\n        }\n\n        this.components[c].hSamp = temp >> 4;\n        this.components[c].vSamp = temp & 0x0F;\n        this.components[c].quantTableSel = data.get8();\n        count+=1;\n    }\n\n    if (count !== length) {\n        throw new Error(\"ERROR: frame format error [Lf!=count]\");\n    }\n\n    return 1;\n};\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n// jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\n\n\n/*** Constructor ***/\njpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || function () {\n    this.l = jpeg.lossless.Utils.createArray(4, 2, 16);\n    this.th = [];\n    this.v = jpeg.lossless.Utils.createArray(4, 2, 16, 200);\n    this.tc = jpeg.lossless.Utils.createArray(4, 2);\n\n    this.tc[0][0] = 0;\n    this.tc[1][0] = 0;\n    this.tc[2][0] = 0;\n    this.tc[3][0] = 0;\n    this.tc[0][1] = 0;\n    this.tc[1][1] = 0;\n    this.tc[2][1] = 0;\n    this.tc[3][1] = 0;\n    this.th[0] = 0;\n    this.th[1] = 0;\n    this.th[2] = 0;\n    this.th[3] = 0;\n};\n\n\n\n/*** Static Pseudo-constants ***/\n\njpeg.lossless.HuffmanTable.MSB = 0x80000000;\n\n\n/*** Prototype Methods ***/\n\njpeg.lossless.HuffmanTable.prototype.read = function(data, HuffTab) {\n    /*jslint bitwise: true */\n\n    var count = 0, length, temp, t, c, i, j;\n\n    length = data.get16();\n    count += 2;\n\n    while (count < length) {\n        temp = data.get8();\n        count+=1;\n        t = temp & 0x0F;\n        if (t > 3) {\n            throw new Error(\"ERROR: Huffman table ID > 3\");\n        }\n\n        c = temp >> 4;\n        if (c > 2) {\n            throw new Error(\"ERROR: Huffman table [Table class > 2 ]\");\n        }\n\n        this.th[t] = 1;\n        this.tc[t][c] = 1;\n\n        for (i = 0; i < 16; i+=1) {\n            this.l[t][c][i] = data.get8();\n            count+=1;\n        }\n\n        for (i = 0; i < 16; i+=1) {\n            for (j = 0; j < this.l[t][c][i]; j+=1) {\n                if (count > length) {\n                    throw new Error(\"ERROR: Huffman table format error [count>Lh]\");\n                }\n\n                this.v[t][c][i][j] = data.get8();\n                count+=1;\n            }\n        }\n    }\n\n    if (count !== length) {\n        throw new Error(\"ERROR: Huffman table format error [count!=Lf]\");\n    }\n\n    for (i = 0; i < 4; i+=1) {\n        for (j = 0; j < 2; j+=1) {\n            if (this.tc[i][j] !== 0) {\n                this.buildHuffTable(HuffTab[i][j], this.l[i][j], this.v[i][j]);\n            }\n        }\n    }\n\n    return 1;\n};\n\n\n\n//\tBuild_HuffTab()\n//\tParameter:  t       table ID\n//\t            c       table class ( 0 for DC, 1 for AC )\n//\t            L[i]    # of codewords which length is i\n//\t            V[i][j] Huffman Value (length=i)\n//\tEffect:\n//\t    build up HuffTab[t][c] using L and V.\njpeg.lossless.HuffmanTable.prototype.buildHuffTable = function(tab, L, V) {\n    /*jslint bitwise: true */\n\n    var currentTable, temp, k, i, j, n;\n    temp = 256;\n    k = 0;\n\n    for (i = 0; i < 8; i+=1) { // i+1 is Code length\n        for (j = 0; j < L[i]; j+=1) {\n            for (n = 0; n < (temp >> (i + 1)); n+=1) {\n                tab[k] = V[i][j] | ((i + 1) << 8);\n                k+=1;\n            }\n        }\n    }\n\n    for (i = 1; k < 256; i+=1, k+=1) {\n        tab[k] = i | jpeg.lossless.HuffmanTable.MSB;\n    }\n\n    currentTable = 1;\n    k = 0;\n\n    for (i = 8; i < 16; i+=1) { // i+1 is Code length\n        for (j = 0; j < L[i]; j+=1) {\n            for (n = 0; n < (temp >> (i - 7)); n+=1) {\n                tab[(currentTable * 256) + k] = V[i][j] | ((i + 1) << 8);\n                k+=1;\n            }\n\n            if (k >= 256) {\n                if (k > 256) {\n                    throw new Error(\"ERROR: Huffman table error(1)!\");\n                }\n\n                k = 0;\n                currentTable+=1;\n            }\n        }\n    }\n};\n\n\n/*jslint browser: true, node: true */\n\n/*** Imports ****/\n\n/**\n * jpeg\n  * @type {*|{}}\n */\n// var jpeg = jpeg || {};\n\n/**\n * jpeg.lossless\n * @type {*|{}}\n */\n// jpeg.lossless = jpeg.lossless || {};\n\n\n// jpeg.lossless.ComponentSpec = jpeg.lossless.ComponentSpec || ((typeof require !== 'undefined') ? require('./component-spec.js') : null);\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n// jpeg.lossless.Decoder = jpeg.lossless.Decoder || ((typeof require !== 'undefined') ? require('./decoder.js') : null);\n// jpeg.lossless.FrameHeader = jpeg.lossless.FrameHeader || ((typeof require !== 'undefined') ? require('./frame-header.js') : null);\n// jpeg.lossless.HuffmanTable = jpeg.lossless.HuffmanTable || ((typeof require !== 'undefined') ? require('./huffman-table.js') : null);\n// jpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || ((typeof require !== 'undefined') ? require('./quantization-table.js') : null);\n// jpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || ((typeof require !== 'undefined') ? require('./scan-component.js') : null);\n// jpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || ((typeof require !== 'undefined') ? require('./scan-header.js') : null);\n// jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n// jpeg.lossless.Utils = jpeg.lossless.Utils || ((typeof require !== 'undefined') ? require('./utils.js') : null);\n\n\n/*** Constructor ***/\njpeg.lossless.QuantizationTable = jpeg.lossless.QuantizationTable || function () {\n    this.precision = []; // Quantization precision 8 or 16\n    this.tq = []; // 1: this table is presented\n    this.quantTables = jpeg.lossless.Utils.createArray(4, 64); // Tables\n\n    this.tq[0] = 0;\n    this.tq[1] = 0;\n    this.tq[2] = 0;\n    this.tq[3] = 0;\n};\n\n\n\n/*** Static Methods ***/\n\njpeg.lossless.QuantizationTable.enhanceQuantizationTable = function(qtab, table) {\n    /*jslint bitwise: true */\n\n    var i;\n\n    for (i = 0; i < 8; i+=1) {\n        qtab[table[(0 * 8) + i]] *= 90;\n        qtab[table[(4 * 8) + i]] *= 90;\n        qtab[table[(2 * 8) + i]] *= 118;\n        qtab[table[(6 * 8) + i]] *= 49;\n        qtab[table[(5 * 8) + i]] *= 71;\n        qtab[table[(1 * 8) + i]] *= 126;\n        qtab[table[(7 * 8) + i]] *= 25;\n        qtab[table[(3 * 8) + i]] *= 106;\n    }\n\n    for (i = 0; i < 8; i+=1) {\n        qtab[table[0 + (8 * i)]] *= 90;\n        qtab[table[4 + (8 * i)]] *= 90;\n        qtab[table[2 + (8 * i)]] *= 118;\n        qtab[table[6 + (8 * i)]] *= 49;\n        qtab[table[5 + (8 * i)]] *= 71;\n        qtab[table[1 + (8 * i)]] *= 126;\n        qtab[table[7 + (8 * i)]] *= 25;\n        qtab[table[3 + (8 * i)]] *= 106;\n    }\n\n    for (i = 0; i < 64; i+=1) {\n        qtab[i] >>= 6;\n    }\n};\n\n\n/*** Prototype Methods ***/\n\njpeg.lossless.QuantizationTable.prototype.read = function (data, table) {\n    /*jslint bitwise: true */\n\n    var count = 0, length, temp, t, i;\n\n    length = data.get16();\n    count += 2;\n\n    while (count < length) {\n        temp = data.get8();\n        count+=1;\n        t = temp & 0x0F;\n\n        if (t > 3) {\n            throw new Error(\"ERROR: Quantization table ID > 3\");\n        }\n\n        this.precision[t] = temp >> 4;\n\n        if (this.precision[t] === 0) {\n            this.precision[t] = 8;\n        } else if (this.precision[t] === 1) {\n            this.precision[t] = 16;\n        } else {\n            throw new Error(\"ERROR: Quantization table precision error\");\n        }\n\n        this.tq[t] = 1;\n\n        if (this.precision[t] === 8) {\n            for (i = 0; i < 64; i+=1) {\n                if (count > length) {\n                    throw new Error(\"ERROR: Quantization table format error\");\n                }\n\n                this.quantTables[t][i] = data.get8();\n                count+=1;\n            }\n\n            jpeg.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[t], table);\n        } else {\n            for (i = 0; i < 64; i+=1) {\n                if (count > length) {\n                    throw new Error(\"ERROR: Quantization table format error\");\n                }\n\n                this.quantTables[t][i] = data.get16();\n                count += 2;\n            }\n\n            jpeg.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[t], table);\n        }\n    }\n\n    if (count !== length) {\n        throw new Error(\"ERROR: Quantization table error [count!=Lq]\");\n    }\n\n    return 1;\n};\n\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n\n\n/*** Constructor ***/\njpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || function () {\n    this.acTabSel = 0; // AC table selector\n    this.dcTabSel = 0; // DC table selector\n    this.scanCompSel = 0; // Scan component selector\n};\n\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n// jpeg.lossless.DataStream = jpeg.lossless.DataStream || ((typeof require !== 'undefined') ? require('./data-stream.js') : null);\n// jpeg.lossless.ScanComponent = jpeg.lossless.ScanComponent || ((typeof require !== 'undefined') ? require('./scan-component.js') : null);\n\n\n/*** Constructor ***/\njpeg.lossless.ScanHeader = jpeg.lossless.ScanHeader || function () {\n    this.ah = 0;\n    this.al = 0;\n    this.numComp = 0; // Number of components in the scan\n    this.selection = 0; // Start of spectral or predictor selection\n    this.spectralEnd = 0; // End of spectral selection\n    this.components = [];\n};\n\n\n/*** Prototype Methods ***/\n\njpeg.lossless.ScanHeader.prototype.read = function(data) {\n    /*jslint bitwise: true */\n\n    var count = 0, length, i, temp;\n\n    length = data.get16();\n    count += 2;\n\n    this.numComp = data.get8();\n    count+=1;\n\n    for (i = 0; i < this.numComp; i+=1) {\n        this.components[i] = new jpeg.lossless.ScanComponent();\n\n        if (count > length) {\n            throw new Error(\"ERROR: scan header format error\");\n        }\n\n        this.components[i].scanCompSel = data.get8();\n        count+=1;\n\n        temp = data.get8();\n        count+=1;\n\n        this.components[i].dcTabSel = (temp >> 4);\n        this.components[i].acTabSel = (temp & 0x0F);\n    }\n\n    this.selection = data.get8();\n    count+=1;\n\n    this.spectralEnd = data.get8();\n    count+=1;\n\n    temp = data.get8();\n    this.ah = (temp >> 4);\n    this.al = (temp & 0x0F);\n    count+=1;\n\n    if (count !== length) {\n        throw new Error(\"ERROR: scan header format error [count!=Ns]\");\n    }\n\n    return 1;\n};\n\n\n\n/*\n * Copyright (C) 2015 Michael Martinez\n * Changes: Added support for selection values 2-7, fixed minor bugs &\n * warnings, split into multiple class files, and general clean up.\n *\n * 08-25-2015: Helmut Dersch agreed to a license change from LGPL to MIT.\n */\n\n/*\n * Copyright (C) Helmut Dersch\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/*jslint browser: true, node: true */\n\n/*** Imports ***/\n// var jpeg = jpeg || {};\n// jpeg.lossless = jpeg.lossless || {};\n\n\n/*** Constructor ***/\njpeg.lossless.Utils = jpeg.lossless.Utils || {};\n\n\n/*** Static methods ***/\n\n// http://stackoverflow.com/questions/966225/how-can-i-create-a-two-dimensional-array-in-javascript\njpeg.lossless.Utils.createArray = function (length) {\n    var arr = new Array(length || 0),\n        i = length;\n\n    if (arguments.length > 1) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        while(i--) arr[length-1 - i] = jpeg.lossless.Utils.createArray.apply(this, args);\n    }\n\n    return arr;\n};\n\n\n// http://stackoverflow.com/questions/18638900/javascript-crc32\njpeg.lossless.Utils.makeCRCTable = function(){\n    var c;\n    var crcTable = [];\n    for(var n =0; n < 256; n++){\n        c = n;\n        for(var k =0; k < 8; k++){\n            c = ((c&1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n        }\n        crcTable[n] = c;\n    }\n    return crcTable;\n};\n\njpeg.lossless.Utils.crc32 = function(dataView) {\n    var uint8view = new Uint8Array(dataView.buffer);\n    var crcTable = jpeg.lossless.Utils.crcTable || (jpeg.lossless.Utils.crcTable = jpeg.lossless.Utils.makeCRCTable());\n    var crc = 0 ^ (-1);\n\n    for (var i = 0; i < uint8view.length; i++ ) {\n        crc = (crc >>> 8) ^ crcTable[(crc ^ uint8view[i]) & 0xFF];\n    }\n\n    return (crc ^ (-1)) >>> 0;\n};\n","/**\n * JPEG Lossless decoder worker.\n */\n\nimport {jpeg} from './lossless.js';\n\nself.addEventListener('message', function (event) {\n\n  // bytes per element\n  const bpe = event.data.meta.bitsAllocated / 8;\n  // decode DICOM buffer\n  const buf = new Uint8Array(event.data.buffer);\n  const decoder = new jpeg.lossless.Decoder();\n  const decoded = decoder.decode(buf.buffer, 0, buf.buffer.byteLength, bpe);\n  // post decoded data\n  let res = null;\n  if (event.data.meta.bitsAllocated === 8) {\n    if (event.data.meta.isSigned) {\n      res = new Int8Array(decoded.buffer);\n    } else {\n      res = new Uint8Array(decoded.buffer);\n    }\n  } else if (event.data.meta.bitsAllocated === 16) {\n    if (event.data.meta.isSigned) {\n      res = new Int16Array(decoded.buffer);\n    } else {\n      res = new Uint16Array(decoded.buffer);\n    }\n  }\n  self.postMessage([res]);\n\n}, false);\n"],"names":["buffer","jpeg","lossless","ComponentSpec","this","hSamp","quantTableSel","vSamp","DataStream","data","offset","length","Uint8Array","index","prototype","get16","value","get8","Decoder","numBytes","frame","FrameHeader","huffTable","HuffmanTable","quantTable","QuantizationTable","scan","ScanHeader","DU","Utils","createArray","HuffTab","IDCT_Source","nBlock","acTab","dcTab","qTab","marker","markerIndex","numComp","restartInterval","selection","xDim","yDim","xLoc","yLoc","outputData","restarting","mask","IDCT_P","TABLE","MAX_HUFFMAN_SUBTREE","MSB","RESTART_MARKER_BEGIN","RESTART_MARKER_END","decompress","decode","current","i","compN","mcuNum","scanNum","pred","temp","stream","Error","read","readNumber","readApp","readComment","precision","components","parseInt","Math","ceil","getter","getValueRGB","setter","setValueRGB","output","outputRGB","getValue8","setValue8","outputSingle","getValue16","setValue16","selector","select2","select3","select4","select5","select6","select7","select1","scanComps","quantTables","scanCompSel","dcTabSel","acTabSel","dimX","dimY","ArrayBuffer","Uint16Array","decodeUnit","prev","decodeSingle","decodeRGB","compOffset","getPreviousX","getPreviousY","getPreviousXY","actab","dctab","qtab","ctrC","k","j","getHuffmanValue","getn","n","nRestart","table","code","input","PRED","result","isLastPixel","val","DataView","setInt16","Int16Array","count","sb","c","l","th","v","tc","t","buildHuffTable","tab","L","V","currentTable","tq","enhanceQuantizationTable","ScanComponent","ah","al","spectralEnd","arr","Array","arguments","args","slice","call","apply","makeCRCTable","crcTable","crc32","dataView","uint8view","crc","self","addEventListener","event","bpe","meta","bitsAllocated","buf","decoded","byteLength","res","isSigned","Int8Array","postMessage"],"sourceRoot":""}